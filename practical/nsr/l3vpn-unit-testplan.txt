$Id: l3vpn-unit-testplan.txt,v 1.7 2007/08/07 20:44:32 rex Exp $ 
 
       NSR: pre-release testing of L3VPN stateful replication 
                               
                           RLI 3170 
                               
                    Unit test plan and results 
 
Author: Bruno Rijsman <brijsman@juniper.net> 
 
Copyright (C) 2006, Juniper Networks, Inc. 
 
NOTICE: This document contains the proprietary and confidential 
information of Juniper Networks, Inc., and must not be distributed 
outside of the company without the permission of Juniper Engineering. 
 
1. INTRODUCTION 
 
This document contains the unit test plan and unit test results for RLI 
3170: "NRS: pre-release testing of L3VPN stateful replication".

The following list summarizes the features tested in this plan:

Feature                                           Result      
------------------------------------------------  ----------------
IPv4 VPN-unicast routes (ingress or egress)       OK
IPv6 VPN-unicast routes (ingress or egress)       OK
IPv4 labeled-unicast routes (ingress or egress)   OK
IPv6 labeled-unicast routes (ingress or egress)   OK
Import (vrf-import)                               OK
Export (vrf-export)                               OK
Vrf-target                                        OK 
Overlapping VPNs                                  OK
Multiple CEs per VRF                              OK
Multiple routes per CE                            OK
Per-prefix-label                                  OK
Auto export                                       OK
Inter-AS option A                                 OK
Route target filtering                            OK (fixed by PR 76302)
VRF-table label                                   OK (fixed by PR 76062)
Label aggregation based on site-of-origin (SOO)   OK (fixed by PR 76407)
VPN route-reflectors (without next-hop-self)      OK
LDP base tunnels                                  OK
Independent domains                               OK
Automatic route distinguishers (RDs)              OK
Hub-and-spoke topologies using no-vrf-advertise   OK
L3VPNs over dynamic GRE base tunnels              FAIL - PR 76429
The following PE-CE routing protocols:                          
- RIP                                             OK
- OSPF                                            OK
- RIPng                                           FAIL - PR 76259
- OSPFv3                                          FAIL - PR 76261
- IPv4 static routes                              OK
- IPv6 static routes                              OK
- IPv4 EBGP (unique AS per CE)                    OK
- IPv4 EBGP (same AS per CE + as-override)        OK
- IPv4 IBGP + independent-domain                  OK
- IPv6 EBGP (unique AS per CE)                    OK
- IPv6 EBGP (same AS per CE + as-override)        OK
- IPv6 IBGP + independent-domain                  OK (fixed by PR 76280)
Multipath                                         OK
6PE                                               OK
Internet access from a VPN                        OK

The following list summarizes the issues found while executing the unit
test plan (including issues unrelated to the feature being tested):

PR     Description
-----  ----------------------------------------------------------------------
76007  L3VPN NSR: [cosmetic] "show route detail" should report mpls.0 routes 
       as "Fictitious" 
76062  RPD asserts if you configure vrf-table-label in a routing-instance in 
       a logical router. 
76259  Add "protocol ripng" to "routing-instances" hierarchy
76261  OSPFv3 in VRF as PE-CE protocol looses route to CE after NSR 
       switch-over
76266  Segmentation fault in ldp_delete_ingress_kernel_node
76280  CE to CE forwarding does not work for IPv6 VPNs over IPv4 core with 
       IBGP as the PE-CE protocol
76302  Route Target Filtering (RTF) does not work in combination with NSR.
76326  IPv6 explicit null label missing in "traceroute" output
76407  If aggregate-label is configured, RPD crashes after NSR switch-over.
76429  Add NSR support for dynamic-tunnels
76436  L3VPN NSR: If NSR is enabled, don't allow two VRFs with same RD on PE.
 
2. SETUP 
 
The hardware required for this unit test plan is two routers (we used 
M10i routers), each with at least one ethernet PIC. The physical 
topology is fixed for all test cases and is described in appendix A.1. 
Logical routes are used extensively to create different logical 
topologies for the various test cases; these logical topologies are 
described in the rest of appendix A. 
 
3. FUNCTIONAL TEST CASES 
 
3.1. TEST-CASE: BASIC IPV4 VPNS WITH VARIOUS IGPS AS THE PE-CE PROTOCOL 
 
Goals: 
 
   1. IPv4 VPN-unicast routes (ingress and egress) 
      
   2. LDP base tunnels 
      
   3. PE-CE routing protocol: IPv4 static routes 
      
   4. PE-CE routing protocol: OSPF 
      
   5. PE-CE routing protocol: RIP 
 
Test Steps: 
 
   1. Configure routers dommelsch and fosters according to topology 
     "VPNV4-IGP" (see appendix A.2). 
      
   2. Let everything converge. 
      
   3. Ce11 and ce12 both use ipv4 static routes as the PE-CE routing 
     protocol. On fosters, start a continuous ping from ce11 to ce21: 
      
     [fosters]
     set cli logical-router ce11 
     ping 99.99.99.7 source 99.99.99.1 count 1000000 
      
   4. Ce21 and ce22 both use OSPF as the PE-CE routing protocol. On 
     fosters, in another telnet window, start a continuous ping from 
     ce21 to ce22: 
      
     [fosters] 
     set cli logical-router ce21 
     ping 99.99.99.8 source 99.99.99.2 count 1000000 
      
   5. Ce31 and ce32 both use RIP as the PE-CE routing protocol. On 
     fosters, in another telnet window, start a continuous ping from 
     ce31 to ce32: 
      
     [fosters] 
     set cli logical-router ce31 
     ping 99.99.99.9 source 99.99.99.3 count 1000000 
      
   6. On dommelsch, switch-over from the master RE to the standby RE: 
      
     [dommelsch] 
     request chassis routing-engine mastership switch 
      
   7. On fosters, observe all the pings and verify that there is no 
     dropped traffic. 
      
   8. Wait 2 minutes for everything to re-converge after each switch-
     over. [See observation 1] 
      
   9. Repeat steps 6, 7, and 8 several times, switching back and forth 
     between RE0 and RE1 on dommelsch. 
 
Success criteria:  
 
   1. No traffic loss on any switch-over. 
 
Observations:  
 
   1. You must be careful that you wait long enough to give all 
     protocols on the new stanby enough time to re-synchronize with 
     the master. To verify this, do a "show route" on the standby and 
     check that you see all routes. BGP and LDP have some variability 
     in how long it takes for the new standby to resync. Often, the 
     resync happens very quickly. This may tempt the tester to start 
     doing switch-overs faster and faster (i.e. not wait a couple of 
     minutes between each switch-over). If you don't wait long enough, 
     you will see a brief period of traffic loss after a switch-over. 
     It has been suggested to create a single "show" command to report 
     the overall NSR state (ready to switch-over or not, and possibly 
     also one single line per protocol to report whether it is ready 
     to switch or not). 
 
PRs: 
 
   PR 76007  L3VPN NSR: [cosmetic] "show route detail" should report 
            mpls.0 routes as "Fictitious"
 
Results: pass 
 
3.2. TEST-CASE: AUTOMATIC ROUTE DISTINGUISHERS (RDS) 
 
Goals: 
 
   1. Automatic route distinguishers (RDs) 
 
Test Steps: 
 
   1. Configure routers dommelsch and fosters according to topology 
     "VPNV4-IGP" (see appendix A.2). 
      
   2. Modify the configuration of dommelsch to use automatic route 
     distinguishers as follows: 
      
     [dommelsch] 
     delete routing-instances pe11 route-distinguisher  
     delete routing-instances pe12 route-distinguisher     
     delete routing-instances pe13 route-distinguisher 
     set routing-options route-distinguisher-id 100  
      
   3. Let everything converge. 
      
   4. Start pings: ce11->ce21, ce12->ce22, and ce13->ce23: 
      
     [fosters] 
     set cli logical-router ce11 
     ping 99.99.99.7 source 99.99.99.1 count 1000000 
      
     [fosters] 
     set cli logical-router ce21 
     ping 99.99.99.8 source 99.99.99.2 count 1000000 
      
     [fosters] 
     set cli logical-router ce31 
     ping 99.99.99.9 source 99.99.99.3 count 1000000 
      
   5. On dommelsch, switch-over from the master RE to the standby RE: 
      
     [dommelsch] 
     request chassis routing-engine mastership switch 
      
   6. On fosters, observe all the pings and verify that there is no 
     dropped traffic. 
      
   7. Wait 2 minutes for everything to re-converge after each switch-
     over. [See observation 1] 
      
   8. Repeat steps 5, 6, and 7 several times, switching back and forth 
     between RE0 and RE1 on dommelsch. 
 
Success criteria:  
 
   1. No traffic loss on any switch-over. 

Results: pass 
 
3.3. TEST-CASE: BASIC IPV4 VPNS WITH BGP AS THE PE-CE PROTOCOL 
 
Goals: 
 
   1. PE-CE routing protocol: IPv4 EBGP - each site unique AS 
      
   2. PE-CE routing protocol: IPv4 EBGP - sites have same AS, as-
     override 
      
   3. PE-CE routing protocol: IPv4 IBGP 
      
   4. Idependent domains 
 
Test Steps: 
 
   1. Configure routers dommelsch and fosters according to topology 
     "VPNV4-BGP" (see appendix A.3). 
      
   2. Let everything converge. 
      
   3. Ce11 and ce12 both use IPv4 EBGP as the PE-CE routing protocol. 
     Ce11 and ce12 are in different ASs. On fosters, start a 
     continuous ping from ce11 to ce21: 
      
     [fosters] 
     set cli logical-router ce11 
     ping 99.99.99.7 source 99.99.99.1 count 1000000 
      
   4. Ce11 and ce12 both use IPv4 EBGP as the PE-CE routing protocol. 
     Ce21 and ce22 are in the same AS. VRFs pe12 and pe22 have as-
     override configured. On fosters, in another telnet window, start 
     a continuous ping from ce21 to ce22: 
      
     [fosters] 
     set cli logical-router ce21 
     ping 99.99.99.8 source 99.99.99.2 count 1000000 
      
   5. Ce31 and ce32 both use IPv4 IBGP as the PE-CE routing protocol. 
     Ce31 and ce32 are in the same AS. VRFs pe13 and pe23 have 
     independent-domain configured. On fosters, in another telnet 
     window, start a continuous ping from ce31 to ce32: 
      
     [fosters] 
     set cli logical-router ce31 
     ping 99.99.99.9 source 99.99.99.3 count 1000000 
      
   6. On dommelsch, switch-over from the master RE to the standby RE: 
      
     [dommelsch] 
     request chassis routing-engine mastership switch 
      
   7. On fosters, observe all the pings and verify that there is no 
     dropped traffic. 

   8. Wait 2 minutes for everything to re-converge after each switch-
     over. 
      
   9. Repeat steps 6, 7, and 8 several times, switching back and forth 
     between RE0 and RE1 on dommelsch. 
 
Success criteria:  
 
   1. No traffic loss on any switch-over. 
 
Results: pass 
 
3.4. TEST-CASE: MULTIPLE CES PER VRF 
 
Goals: 
 
   1. Multiple CEs per VRF 
      
   2. Multiple routes per CE 
      
   3. Per-prefix-label 
 
Test Steps: 
 
   1.  Configure routers dommelsch and fosters according to topology 
       "MULTI-CE" (see appendix A.11). 
        
   2.  Let everything converge. 
        
   3.  On fosters, start a continuous ping from ce11 to one of the 
       routes advertised by ce21: 
        
       [fosters] 
       set cli logical-router ce11 
       ping 88.88.21.7 source 99.99.99.1 count 1000000 
        
   4.  On fosters, start a continuous ping from ce11 to one of the 
       routes advertised by ce23: 
        
       [fosters] 
       set cli logical-router ce11 
       ping 88.88.23.4 source 99.99.99.1 count 1000000 
        
   5.  On fosters, start a continuous ping from ce11 to one of the 
       routes advertised by ce13: 
        
       [fosters] 
       set cli logical-router ce11 
       ping 88.88.13.1 source 99.99.99.1 count 1000000 
        
   6.  On dommelsch, switch-over from the master RE to the standby RE: 
        
       [dommelsch] 
       request chassis routing-engine mastership switch 

   7.  On fosters, observe all the pings and verify that there is no 
       dropped traffic. 
        
   8.  Wait 2 minutes for everything to re-converge after each switch-
       over. 
        
   9.  Repeat steps 6, 7, and 8 several times, switching back and forth 
       between RE0 and RE1 on dommelsch. 
        
   10. Configure per prefix label allocation using the following 
       (hidden) configuration statement: 
        
       [dommelsch] 
       set protocols bgp group int family inet-vpn unicast per-prefix-
       label 
        
       You need to clear the BGP sessions to make this command take 
       effect. 
        
   11. Repeat steps 6, 7, and 8 several times, switching back and forth 
       between RE0 and RE1 on dommelsch. 
 
Success criteria:  
 
   1. No traffic loss on any switch-over. 
 
Results: pass 
 
3.5. TEST-CASE: OVERLAPPING VPNS 
 
Goals: 
 
   1. vrf-export 
      
   2. vrf-import 
      
   3. auto-export 
 
Test Steps: 
 
   1. Configure routers dommelsch and fosters according to topology 
     "VPNV4-OVERLAP" (see appendix A.14). 
      
   2. Let everything converge. 
      
   3. On fosters, start a continuous ping from ce11 to ce21: 
      
     [fosters] 
     set cli logical-router ce11 
     ping 99.99.99.7 source 99.99.99.1 count 1000000 
      
   4. On fosters, start a continuous ping from ce11 to ce23: 
      
     [fosters] 
     set cli logical-router ce11 
     ping 99.99.99.9 source 99.99.99.1 count 1000000 

   5. On fosters, start a continuous ping from ce11 to ce13: 
      
     [fosters] 
     set cli logical-router ce11 
     ping 99.99.99.3 source 99.99.99.1 count 1000000 
      
   6. On dommelsch, switch-over from the master RE to the standby RE: 
      
     [dommelsch] 
     request chassis routing-engine mastership switch 
      
   7. On fosters, observe all the pings and verify that there is no 
     dropped traffic. 
      
   8. Wait 2 minutes for everything to re-converge after each switch-
     over. 
      
   9. Repeat steps 6, 7, and 8 several times, switching back and forth 
     between RE0 and RE1 on dommelsch. 
      
Success criteria:  
 
   1. No traffic loss on any switch-over. 
 
Results: pass 
 
3.6. TEST-CASE: MULTIPATH 
 
Goals: 
 
   1. Multipath 
      
Test Steps: 
 
   1. Configure routers dommelsch and fosters according to topology 
     "MULTI-PATH" (see appendix A.12). 
      
   2. Let everything converge. 
      
   3. Verify that dommelsch has a multipath route to 99.99.99.7/32 in 
     table vrf.inet.0 on both the master RE and the standby RE. 
      
   4. On fosters, start a continuous ping from ce1 to ce7: 
      
     [fosters] 
     set cli logical-router ce1 
     ping 99.99.99.7 source 99.99.99.1 count 1000000 
      
   5. On dommelsch, switch-over from the master RE to the standby RE: 
      
     [dommelsch] 
     request chassis routing-engine mastership switch 
      
   6. On fosters, observe all the pings and verify that there is no 
     dropped traffic. 

   7. Wait 2 minutes for everything to re-converge after each switch-
     over. 
      
   8. Repeat steps 5, 6, and 7 several times, switching back and forth 
     between RE0 and RE1 on dommelsch. 
      
Success criteria:  
 
   1. The multipath route is present on both the master and the standby 
     RE. 
      
   2. No traffic loss on any switch-over. 
 
Results: pass 
 
3.7. TEST-CASE: LABEL AGGREGATION 
 
Goals: 
 
   1. Label aggregation 
      
Test Steps: 
 
   1. Configure routers dommelsch and fosters according to topology 
     "LABEL-AGG" (see appendix A.13). 
      
   2. Let everything converge. 
      
   3. Verify that pe5 and pe6 advertise the routes to ce7 with a 
     different label for each route: 
      
     [fosters] 
     set cli logical-router pe5 
     show route advertising-protocol bgp 99.99.99.2 detail 
     set cli logical-router pe6 
     show route advertising-protocol bgp 99.99.99.2 detail 
      
      
   4. Verify that pe2 stored the routes to ce7 in the RIB with a the 
     same label for all routes: 
      
     [dommelsch] 
     show route table bgp.l3vpn.0 
      
   5. On fosters, start a continuous ping from ce1 to one of the routes 
     originated by ce7: 
      
     [fosters] 
     set cli logical-router ce1 
     ping 88.88.7.4 source 99.99.99.1 count 1000000 
      
   6. On dommelsch, switch-over from the master RE to the standby RE: 
      
     [dommelsch] 
     request chassis routing-engine mastership switch 

   7. On fosters, observe all the pings and verify that there is no 
     dropped traffic. 
      
   8. Wait 2 minutes for everything to re-converge after each switch-
     over. 
      
   9. Repeat steps 6, 7, and 8 several times, switching back and forth 
     between RE0 and RE1 on dommelsch. 
      
Success criteria:  
 
   1. The labels in the RIBs are as expected. 
      
   2. No traffic loss on any switch-over. 
 
Results: fail 
 
PRs: 
 
   PR 76407  If aggregate-label is configured, RPD crashes after NSR 
            switch-over. 
 
3.8. TEST-CASE: BASIC IPV6 VPNS WITH VARIOUS IGPS AS THE PE-CE PROTOCOL 
 
Goals: 
 
   1. IPv6 VPN-unicast routes (ingress and egress) 
      
   2. PE-CE routing protocol: IPv6 static routes 
      
   3. PE-CE routing protocol: OSPFv3 
      
   4. PE-CE routing protocol: RIPng 
 
Test Steps: 
 
   1. Configure routers dommelsch and fosters according to topology 
     "VPNV6-IGP" (see appendix A.4). 
      
   2. Let everything converge. 
      
   3. Ce11 and ce12 both use ipv6 static routes as the PE-CE routing 
     protocol. On fosters, start a continuous ping from ce11 to ce21: 
      
     [fosters] 
     set cli logical-router ce11 
     ping inet6 ::99:99:99:7 source ::99:99:99:1 count 1000000 
      
   4. Ce21 and ce22 both use OSPFv3 as the PE-CE routing protocol. On 
     fosters, in another telnet window, start a continuous ping from 
     ce21 to ce22: 
      
     [fosters] 
     set cli logical-router ce21 
     ping inet6 ::99:99:99:8 source ::99:99:99:2 count 1000000 

   5. On dommelsch, switch-over from the master RE to the standby RE: 
      
     [dommelsch] 
     request chassis routing-engine mastership switch 
      
   6. On fosters, observe all the pings and verify that there is no 
     dropped traffic. 
      
   7. Wait 2 minutes for everything to re-converge after each switch-
     over. [See observation 1] 
      
   8. Repeat steps 5, 6, and 7 several times, switching back and forth 
     between RE0 and RE1 on dommelsch. 
 
Success criteria:  
 
   1. No traffic loss on any switch-over. 
 
Results: 
 
   1. Static routes: pass 
      
   2. OSPFv3: fail 
      
   3. Note: RIPng is was not tested because it is not supported as a 
     PE-CE protocol. 
 
PRs: 
 
   PR 76259  Add "protocol ripng" to "routing-instances" hierarchy 
    
   PR 76261  OSPFv3 in VRF as PE-CE protocol looses route to CE after 
            NSR switch-over 
 
3.9. TEST-CASE: BASIC IPV6 VPNS WITH BGP AS THE PE-CE PROTOCOL 
 
Goals: 
 
   1. PE-CE routing protocol: IPv6 EBGP - each site unique AS 
      
   2. PE-CE routing protocol: IPv6 EBGP - sites have same AS, as-
     override 
      
   3. PE-CE routing protocol: IPv6 IBGP 
      
   4. Idependent domains 
 
Test Steps: 
 
   1. Configure routers dommelsch and fosters according to topology 
     "VPNV6-BGP" (see appendix A.5). 
      
   2. Let everything converge. 
      
   3. Ce11 and ce12 both use IPv6 EBGP as the PE-CE routing protocol. 
     Ce11 and ce12 are in different ASs. On fosters, start a 
     continuous ping from ce11 to ce21:
      
     [fosters] 
     set cli logical-router ce11 
     ping ::99:99:99:7 source ::99:99:99:1 count 1000000 
      
   4. Ce11 and ce12 both use IPv6 EBGP as the PE-CE routing protocol. 
     Ce21 and ce22 are in the same AS. VRFs pe12 and pe22 have as-
     override configured. On fosters, in another telnet window, start 
     a continuous ping from ce21 to ce22: 
      
     [fosters] 
     set cli logical-router ce21 
     ping ::99:99:99:8 source ::99:99:99:2 count 1000000 
      
   5. Ce31 and ce32 both use IPv6 IBGP as the PE-CE routing protocol. 
     Ce31 and ce32 are in the same AS. VRFs pe13 and pe23 have 
     independent-domain configured. On fosters, in another telnet 
     window, start a continuous ping from ce31 to ce32: 
      
     [fosters] 
     set cli logical-router ce31 
     ping 99.99.99.9 source 99.99.99.3 count 1000000 
      
   6. On dommelsch, switch-over from the master RE to the standby RE: 
      
     [dommelsch] 
     request chassis routing-engine mastership switch 
      
   7. On fosters, observe all the pings and verify that there is no 
     dropped traffic. 
      
   8. Wait 2 minutes for everything to re-converge after each switch-
     over. 
      
   9. Repeat steps 6, 7, and 8 several times, switching back and forth 
     between RE0 and RE1 on dommelsch. 
 
Success criteria:  
 
   1. No traffic loss on any switch-over. 
 
Result: pass 
 
PRs: 
 
   PR 76266  Segmentation fault in ldp_delete_ingress_kernel_node 
    
   PR 76280  CE to CE forwarding does not work for IPv6 VPNs over IPv4 
            core with IBGP as the PE-CE protocol 
 
3.10. TEST-CASE: IPV4 VPNS WITH ROUTE REFLECTOR 
 
Goals: 
 
   1. VPN route-reflectors (without next-hop-self) 

Test Steps: 
 
   1. Configure routers dommelsch and fosters according to topology 
     "VPNV4-RR" (see appendix A.6). 
      
   2. Let everything converge. 
      
   3. Ce11 and ce12 both use ipv4 static routes as the PE-CE routing 
     protocol. On fosters, start a continuous ping from ce11 to ce21: 
      
     [fosters] 
     set cli logical-router ce11 
     ping 99.99.99.5 source 99.99.99.1 count 1000000 
      
   4. On dommelsch, switch-over from the master RE to the standby RE: 
      
     [dommelsch] 
     request chassis routing-engine mastership switch 
      
   5. On fosters, observe all the pings and verify that there is no 
     dropped traffic. 
      
   6. Wait 2 minutes for everything to re-converge after each switch-
     over. [See observation 1] 
      
   7. Repeat steps 4, 5, and 6 several times, switching back and forth 
     between RE0 and RE1 on dommelsch. 
 
Success criteria:  
 
   1. No traffic loss on any switch-over. 
 
Results: pass 
 
3.11. TEST-CASE: ROUTE TARGET FILTERING 
 
Goals: 
 
   1. Route target filtering 
      
Test Steps: 
 
   1. Configure routers dommelsch and fosters according to topology 
     "VPNV4-RTF" (see appendix A.7). 
      
   2. Let everything converge. 
      
   3. Ce11 and ce12 both use ipv4 static routes as the PE-CE routing 
     protocol. On fosters, start a continuous ping from ce11 to ce21: 
      
     [fosters] 
     set cli logical-router ce11 
     ping 99.99.99.5 source 99.99.99.1 count 1000000 
      
   4. On dommelsch, switch-over from the master RE to the standby RE: 
      
     [dommelsch] 
     request chassis routing-engine mastership switch 
      
   5. On fosters, observe all the pings and verify that there is no 
     dropped traffic. 
      
   6. Wait 2 minutes for everything to re-converge after each switch-
     over. [See observation 1] 
      
   7. Repeat steps 4, 5, and 6 several times, switching back and forth 
     between RE0 and RE1 on dommelsch. 
 
Success criteria:  
 
   1. No traffic loss on any switch-over. 
 
Results: fail 
 
PRs: 
 
   PR 76302  Route Target Filtering (RTF) does not work in combination 
            with NSR. 
 
3.12. TEST-CASE: INTER-AS OPTION A 
 
Goals: 
 
   1. Inter-AS option A 
      
Test Steps: 
 
   1. Configure routers dommelsch and fosters according to topology 
     "VPNV4-IAA" (see appendix A.8). 
      
   2. Let everything converge. 
      
   3. On fosters, start a continuous ping from ce11 to ce21: 
      
     [fosters] 
     set cli logical-router ce11 
     ping 99.99.99.6 source 99.99.99.1 count 1000000 
      
   4. On dommelsch, switch-over from the master RE to the standby RE: 
      
     [dommelsch] 
     request chassis routing-engine mastership switch 
      
   5. On fosters, observe all the pings and verify that there is no 
     dropped traffic. 
      
   6. Wait 2 minutes for everything to re-converge after each switch-
     over. [See observation 1] 
      
   7. Repeat steps 4, 5, and 6 several times, switching back and forth 
     between RE0 and RE1 on dommelsch. 
 
Success criteria:  

   1. No traffic loss on any switch-over. 
 
Results: Pass 
 
3.13. TEST-CASE: IPV4 LABELED-UNICAST ROUTES (INGRESS OR EGRESS) 
 
Goals: 
 
   1. IPv4 labeled-unicast routs (ingress or egress) 
      
Test Steps: 
 
   1. Configure routers dommelsch and fosters according to topology 
     "LU4" (see appendix A.9). 
      
   2. Let everything converge. 
      
   3. On fosters, start a continuous ping from r1 to r4: 
      
     [fosters] 
     set cli logical-router r1 
     ping 99.99.99.4 source 99.99.99.1 count 1000000 
      
   4. On dommelsch, switch-over from the master RE to the standby RE: 
      
     [dommelsch] 
     request chassis routing-engine mastership switch 
      
   5. On fosters, observe all the pings and verify that there is no 
     dropped traffic. 
      
   6. Wait 2 minutes for everything to re-converge after each switch-
     over. [See observation 1] 
      
   7. Repeat steps 4, 5, and 6 several times, switching back and forth 
     between RE0 and RE1 on dommelsch. 
 
Success criteria:  
 
   1. No traffic loss on any switch-over. 
 
Results: Pass 
 
3.14. TEST-CASE: IPV6 LABELED-UNICAST ROUTES (INGRESS OR EGRESS) 
 
Goals: 
 
   1. IPv6 labeled-unicast routs (ingress or egress) 
      
Test Steps: 
 
   1. Configure routers dommelsch and fosters according to topology 
     "LU6" (see appendix A.10). 
      
   2. Let everything converge. 

   3. On fosters, start a continuous ping from r1 to r4: 
      
     [fosters] 
     set cli logical-router r1 
     ping ::99:99:99:4 source ::99:99:99:1 count 1000000 
      
   4. On dommelsch, switch-over from the master RE to the standby RE: 
      
     [dommelsch] 
     request chassis routing-engine mastership switch 
      
   5. On fosters, observe all the pings and verify that there is no 
     dropped traffic. 
      
   6. Wait 2 minutes for everything to re-converge after each switch-
     over. [See observation 1] 
      
   7. Repeat steps 4, 5, and 6 several times, switching back and forth 
     between RE0 and RE1 on dommelsch. 
 
Success criteria:  
 
   1. No traffic loss on any switch-over. 
 
Results: Pass 
 
PRs: 
 
   PR 76326  IPv6 explicit null label missing in "traceroute" output 
 
3.15. TEST-CASE: 6PE 
 
Goals: 
 
   1. IPv6 labeled-unicast routs (ingress or egress) 
      
Test Steps: 
 
   1. Configure routers dommelsch and fosters according to topology 
     "6PE" (see appendix A.15). 
      
   2. Let everything converge. 
      
   3. On fosters, start a continuous ping from r1 to r5: 
      
     [fosters] 
     set cli logical-router r1 
     ping ::99:99:99:5 source ::99:99:99:1 count 1000000 
      
   4. On dommelsch, switch-over from the master RE to the standby RE: 
      
     [dommelsch] 
     request chassis routing-engine mastership switch 
      
   5. On fosters, observe all the pings and verify that there is no 
     dropped traffic. 

   6. Wait 2 minutes for everything to re-converge after each switch-
     over. [See observation 1] 
      
   7. Repeat steps 4, 5, and 6 several times, switching back and forth 
     between RE0 and RE1 on dommelsch. 
 
Success criteria:  
 
   1. No traffic loss on any switch-over. 
 
Results: Pass 
 
3.16. TEST-CASE: IPV4 VPN OVER DYNAMIC GRE BASE TUNNELS 
 
Goals: 
 
   1. L3VPN over dynamic GRE base tunnels 
      
Test Steps: 
 
   1. Configure routers dommelsch and fosters according to topology 
     "VPNV4-GRE-DYN" (see appendix A.16). This configuration uses 
     dynamic GRE base tunnels. 
      
   2. Let everything converge. 
      
   3. On fosters, start a continuous ping from ce11 to ce21: 
      
     [fosters] 
     set cli logical-router ce11 
     ping 99.99.99.5 source 99.99.99.1 count 1000000 
      
   4. On dommelsch, switch-over from the master RE to the standby RE: 
      
     [dommelsch] 
     request chassis routing-engine mastership switch 
      
   5. On fosters, observe all the pings and verify that there is no 
     dropped traffic. 
      
   6. Wait 2 minutes for everything to re-converge after each switch-
     over. [See observation 1] 
      
   7. Repeat steps 4, 5, and 6 several times, switching back and forth 
     between RE0 and RE1 on dommelsch. 
 
Success criteria:  
 
   1. No traffic loss on any switch-over. 
 
Results: fail 
 
PRs: 
 
   PR 76429  Add NSR support for dynamic-tunnels 

3.17. TEST-CASE: VRF-TABLE LABEL 
 
Goals: 
 
   1. IPv4 VPN-unicast routes (ingress and egress) 
 
Test Steps: 
 
   1. Configure routers dommelsch and fosters according to topology 
     "VPNV4-IGP" (see appendix A.2). 
      
   2. On dommelsch, configure vrf-table-label for instance pe11 
      
     [dommelsch] 
     set routing-instances pe11 vrf-table-label 
      
   3. On fosters, configure vrf-table-label for instance pe21 
      
     [fosters] 
     set logical-routers pe2 routing-instances pe21 vrf-table-label 
      
   4. Let everything converge. 
      
   5. On fosters, start a continuous ping from ce11 to ce21: 
      
     [fosters] 
     set cli logical-router ce11 
     ping 99.99.99.7 source 99.99.99.1 count 1000000 
        
   6. On dommelsch, switch-over from the master RE to the standby RE: 
      
     [dommelsch] 
     request chassis routing-engine mastership switch 
      
   7. On fosters, observe the ping and verify that there is no dropped 
     traffic. 
      
   8. Wait 2 minutes for everything to re-converge after each switch-
     over. 
      
   9. Repeat steps 6, 7, and 8 several times, switching back and forth 
     between RE0 and RE1 on dommelsch. 
 
Success criteria:  
 
   1. No traffic loss on any switch-over. 
 
Results: fail 
 
PRs: 
 
   PR 76062  RPD asserts if you configure vrf-table-label in a 
            routing-instance in a logical router.  
 
3.18. TEST-CASE: HUB-AND-SPOKE 
 
Goals: 
 
   1. Hub-and-spoke topologies

   2. no-vrf-advertise
 
Test Steps: 
 
   1. Configure routers dommelsch and fosters according to topology 
     "HUB-AND-SPOKE" (see appendix A.17). 
      
   2. Let everything converge. 

   3. On fosters, verify that the traceroute from ce5 to ce6 goes
      through ce1:

      [fosters]
      set cli logical-router ce5
      traceroute 99.99.99.6 source 99.99.99.5
      
   4. On fosters, start a continuous ping from ce5 to ce6: 
      
     [fosters] 
     set cli logical-router ce5
     ping 99.99.99.6 source 99.99.99.5 count 1000000 
        
   5. On dommelsch, switch-over from the master RE to the standby RE: 
      
     [dommelsch] 
     request chassis routing-engine mastership switch 
      
   6. On fosters, observe the ping and verify that there is no dropped 
     traffic. 
      
   7. Wait 2 minutes for everything to re-converge after each switch-
     over. 
      
   8. Repeat steps 5, 6, and 7 several times, switching back and forth 
     between RE0 and RE1 on dommelsch. 
 
Success criteria:  
 
   1. No traffic loss on any switch-over. 
 
Results: pass
 
3.19. TEST-CASE: INTERNET-ACCESS FROM A VPN 
 
Goals: 
 
   1. Internet access from a VPN 
 
Test Steps: 
 
   1. Configure routers dommelsch and fosters according to topology 
     "INETNET" (see appendix A.18). 
      
   2. Let everything converge. 
      
   3. On fosters, verify that ce11 can traceroute to ce21: 
      
     [fosters] 
     set cli logical-router ce11  
     traceroute 99.99.99.5 source 99.99.99.1     
      
   4. On fosters, verify that ce11 can traceroute to internet: 
      
     [fosters] 
     set cli logical-router ce11  
     traceroute 66.66.66.6 source 99.99.99.1 
      
   5. On fosters, start a continuous ping from ce11 to ce21: 
      
     [fosters] 
     set cli logical-router ce11 
     ping 99.99.99.5 source 99.99.99.1 count 1000000 
      
   6. On fosters, start a continuous ping from ce11 to internet: 
      
     [fosters] 
     set cli logical-router ce11 
     ping 99.99.99.9 source 99.99.99.1 count 1000000 
      
   7. On dommelsch, switch-over from the master RE to the standby RE: 
      
     [dommelsch] 
     request chassis routing-engine mastership switch 
      
   8. On fosters, observe all the pings and verify that there is no 
     dropped traffic. 
      
   9. Wait 2 minutes for everything to re-converge after each switch-
     over. 
      
   10. Repeat steps 7, 8, and 9 several times, switching back and forth 
     between RE0 and RE1 on dommelsch. 
      
Success criteria:  
 
   1. No traffic loss on any switch-over. 
 
Results: pass 

 
4. BOUNDARY TEST CASES 
 
None. 
 
5. REGRESSION TEST CASES 
 
None. 
 
6. INTEROP TEST CASES 
 
None. 
 
7. MIGRATION & COMPATIBILITY TEST CASES 
 
None. 
 
8. TEST COVERAGE REMAINING 
 
None. 
 
9. DEFECTS REMAINING 
 
See list of PRs for each test case. 
 
Additional PRs: 
 
PR 76436  L3VPN NSR: If NSR is enabled, don't allow two VRFs with same 
          RD on PE. 

PR 76691  Add a single command that summarizes the current state of NSR 
          for all protocols

10. REVIEWS

10.1. REVIEW 28-AUG-2006

Attendees:

  Nischal Sheth
  Shiv Gurunathan
  Latha Vemulapalli
  Jeffrey Zhang
  VJ Shah

Comments:

- Add test cases for hub and spoke, including no-vrf-advertise. [done]

- Add test cases for internet access from VPN. [done]

- More complicated test cases for OSPF as the PE-CE protocol (e.g. domain-id
  and sham-link) should be covered in the OSPF NSR unit test plan. [no-change]

- Clarify that "there should be no traffic loss" only in the absence of
  churn in the network.

- Add test cases to do a switch-over while there is churn in the network.
  In these cases there may be transient but not permanent traffic loss.

- Create a PR to ask for a single show command to report the NSR status
  for all protocols (e.g. one line per protocol). [done - PR 76691]

- Add test cases to the "multiple CEs per VRF" section to have multiple
  parallel links between a CE and a VRF.

- Add multiple-as and vpn-unequal-cost to multipath test cases.

- Add tests cases for multipath with different RDs.

- Add test cases for BGP session to IPv6 link-local addresses.

- Add tests cases for multiple route reflectors: in same cluster,
  in different clusters, redundant RRs, hierarchical RRs, router
  which is both RR and PE.

- Add test cases for VPN over static GRE.

- Do more testing for vrf-table-label which avoids the crash reported
  in PR76062 (e.g. by only configuring vrf-table-label on the DUT).

- Review of PRs:
  76007: already fixed
  76062: not an NSR bug; needs to be fixed asap
  76259: change into a change request; will need an RLI
  76261: already fixed; needs to be verified
  76266: marked as dup of a PR which was already fixed
  76280: fixed but verification blocked by another TCP issue (PR 76603)
  76302: L3VPN NSR bug: needs to be fixed in 8.2
  76326: nice to have: fix if possible, kill if difficult to fix
  76407: fixed but verification blocked by another TCP issue (PR 76603)
  76429: change into a change request; will need an RLI
  76436: L3VPN NSR bug: needs to be fixed in 8.2 but is not very urgent

10.2. REVIEW 29-AUG-2006

Comments by e-mail from Serpil Bayraktar:

1.  vpn-apply-export
    We can change some of the attributes of the vpn routes as they are 
    advertised to other PE routers using this knob.  Mostly the customers 
    use this to modify target community.  

2.  import policy as applied to PE-PE sessions
    Pedro added support for modifying target communities as the vpn routes 
    are received from other PEs in 7.5.  Before 7.5 we couldn't do that.  
    There is a script that actually covers this.

3.  no_nexthop_change knob
    Some customers needed nexthop to be passed along when doing inter-as 
    vpns, DT being one.  You can see Pedro's notes on this in 
    http://www-in/%7eroque/bgp_no_nexthop_change.html
    [no change - inter-as option C is not supported as part of this RLI]

4.  rib-groups
    There are some cases, especially multicast over l3vpns, where 
    rib-groups are used for importing routes across tables.  We used to do 
    overlapping vpns mostly with rib-groups before Pedro implemented 
    auto-export.  I am pretty sure multicast scripts will cover this but I 
    wanted to mention that anyway. [done - part of internet access from 
    VPN testcase]
 
APPENDIX A: CONFIGURATIONS 
 
A.1. PHYSICAL TOPOLOGY 
 
  fe-0/3/0 +-----------+ 
+----------|           | 
|          | dommelsch | 
+----------| M10i      | 
  fe-0/3/1 |           | 
           +-----------+ 
                 | fe-0/3/2 
                 | 
                 | fe-0/0/2 
  fe-0/0/0 +-----------+ 
+----------|           | 
|          | fosters   | 
+----------| M10i      | 
  fe-0/0/1 |           | 
           +-----------+ 
 
A.2. TOPOLOGY "VPNV4-IGP" 
 
This topology is used to test IPv4 VPNs with various IGPs as the PE-CE 
protocol. 
 
A.2.1. LOGICAL TOPOLOGY 
 
+----+ Static +-----+           +-----+ Static +----+ 
|ce11|--------|     |           |     |--------|ce21| 
+----+        |     |           |     |        +----+ 
              |     |           |     | 
+----+ OSPF   |     |   +---+   |     | OSPF   +----+ 
|ce12|--------| pe1 |---| p |---| pe2 |--------|ce22| 
+----+        |     |   +---+   |     |        +----+ 
              |     |           |     | 
+----+ RIP    |     |           |     | RIP    +----+ 
|ce13|--------|     |           |     |--------|ce23| 
+----+        +-----+           +-----+        +----+ 
 
      <------>       <--------->       <------> 
       IPv4           IPv4              IPv4 
 
Pe1 is the default logical router on physical router "dommelsch". It is 
the device under test. 
 
Ce11, ce12, ce13, p, pe2, ce21, ce22, and ce23 are logical routers on 
physical router "fosters". 
 
Ce11 and ce21 use static routes as the PE-CE protocol. 
 
Ce21 and ce22 use OSPF as the PE-CE protocol. 
 
Ce31 and ce32 use RIP as the PE-CE protocol. 
 
A.2.2. CONFIGURATION FOR DOMMELSCH 
 
chassis { 
    redundancy { 
        graceful-switchover { 
            enable; 
        } 
    } 
} 
routing-options { 
    nonstop-routing; 
    router-id 99.99.99.4; 
    autonomous-system 100; 
} 
policy-options { 
    policy-statement bgp-routes {  
        from protocol bgp; 
        then accept; 
    } 
} 
interfaces { 
    lo0 { 
        unit 0 { 
            family inet { 
                address 99.99.99.4/32; 
            } 
        } 
    } 
    fe-0/3/2 { 
        vlan-tagging; 
        unit 14 { 
            vlan-id 14; 
            family inet { 
                address 14.14.14.4/24; 
            } 
        } 
        unit 24 { 
            vlan-id 24; 
            family inet { 
                address 24.24.24.4/24; 
            } 
        } 
        unit 34 { 
            vlan-id 34; 
            family inet { 
                address 34.34.34.4/24; 
            } 
        } 
        unit 45 { 
            vlan-id 45; 
            family inet { 
                address 45.45.45.4/24; 
            } 
            family mpls; 
        } 
    } 
} 
protocols { 
    ospf { 
        area 0 { 
            interface lo0.0; 
            interface fe-0/3/2.45; 
        } 
    } 
    mpls { 
        interface fe-0/3/2.45; 
    } 
    ldp { 
        interface fe-0/3/2.45; 
    } 
    bgp { 
        group int { 
            type internal; 
            local-address 99.99.99.4; 
            family inet-vpn { 
                unicast; 
            } 
            neighbor 99.99.99.6; 
        } 
    } 
} 
routing-instances { 
    pe11 { 
        instance-type vrf; 
        route-distinguisher 100:11; 
        vrf-target target:100:1; 
        interface fe-0/3/2.14; 
        routing-options { 
            static { 
                route 99.99.99.1/32 { 
                    next-hop 14.14.14.1; 
                } 
            } 
        } 
    } 
    pe12 { 
        instance-type vrf; 
        route-distinguisher 100:12; 
        vrf-target target:100:2; 
        interface fe-0/3/2.24; 
        protocols { 
            ospf { 
                export bgp-routes; 
                area 0 { 
                        interface fe-0/3/2.24; 
                } 
            } 
        } 
    } 
    pe13 { 
        instance-type vrf; 
        route-distinguisher 100:13; 
        vrf-target target:100:3; 
        interface fe-0/3/2.34; 
        protocols { 
            rip { 
                group ces { 
                   export bgp-routes; 
                   neighbor fe-0/3/2.34; 
                } 
            } 
        } 
    } 
} 
 
A.2.2. CONFIGURATION FOR FOSTERS 
 
interfaces { 
    fe-0/0/0 { 
        vlan-tagging; 
    } 
    fe-0/0/1 { 
        vlan-tagging; 
    } 
    fe-0/0/2 { 
        vlan-tagging; 
    } 
} 
logical-routers { 
    ce11 { 
        routing-options { 
            router-id 99.99.99.1; 
            static { 
                route 0.0.0.0/0 { 
                    next-hop 14.14.14.4; 
                    retain; 
                } 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 1 { 
                    family inet { 
                        address 99.99.99.1/32; 
                    } 
                } 
            } 
            fe-0/0/2 { 
                unit 14 { 
                    vlan-tag 14; 
                    family inet { 
                        address 14.14.14.1/24; 
                    } 
                } 
            } 
        } 
    } 
    ce12 { 
        routing-options { 
            router-id 99.99.99.2; 
        } 
        interfaces { 
            lo0 { 
                unit 2 { 
                    family inet { 
                        address 99.99.99.2/32; 
                    } 
                } 
            } 
            fe-0/0/2 { 
                unit 24 { 
                    vlan-tag 24; 
                    family inet { 
                        address 24.24.24.2/24; 
                    } 
                } 
            } 
        } 
        protocols { 
            ospf { 
                area 0 { 
                   interface lo0.2; 
                   interface fe-0/0/2.24; 
                } 
            } 
        } 
    } 
    ce13 { 
        routing-options { 
            router-id 99.99.99.3; 
        } 
        interfaces { 
            lo0 { 
                unit 3 { 
                    family inet { 
                        address 99.99.99.3/32; 
                    } 
                } 
            } 
            fe-0/0/2 { 
                unit 34 { 
                    vlan-tag 34; 
                    family inet { 
                        address 34.34.34.3/24; 
                    } 
                } 
            } 
        } 
        policy-options { 
            policy-statement direct-routes {  
                from protocol direct; 
                then accept; 
            } 
        } 
        protocols { 
            rip { 
                group pe { 
                   export direct-routes; 
                   neighbor fe-0/0/2.34; 
                } 
            } 
        } 
    } 
    p { 
        routing-options { 
            router-id 99.99.99.5; 
        } 
        interfaces { 
            lo0 { 
                unit 5 { 
                    family inet { 
                        address 99.99.99.5/32; 
                    } 
                } 
            } 
            fe-0/0/2 { 
                unit 45 { 
                    vlan-tag 45; 
                    family inet { 
                        address 45.45.45.5/24; 
                    } 
                    family mpls; 
                } 
            } 
            fe-0/0/0 { 
                unit 56 { 
                    vlan-tag 56; 
                    family inet { 
                        address 56.56.56.5/24; 
                    } 
                    family mpls; 
                } 
            } 
        } 
        protocols { 
            ospf { 
                area 0 { 
                    interface lo0.5; 
                    interface fe-0/0/2.45; 
                    interface fe-0/0/0.56; 
                } 
            } 
            mpls { 
               interface fe-0/0/2.45; 
               interface fe-0/0/0.56; 
            } 
            ldp { 
               interface fe-0/0/2.45; 
               interface fe-0/0/0.56; 
            } 
        } 
    } 
    pe2 { 
        routing-options { 
            router-id 99.99.99.6; 
            autonomous-system 100; 
        } 
        policy-options { 
            policy-statement bgp-routes {  
                from protocol bgp; 
                then accept; 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 6 { 
                    family inet { 
                        address 99.99.99.6/32; 
                    } 
                } 
            } 
            fe-0/0/1 { 
                unit 56 { 
                    vlan-tag 56; 
                    family inet { 
                        address 56.56.56.6/24; 
                    } 
                    family mpls; 
                } 
            } 
            fe-0/0/0 { 
                unit 67 { 
                    vlan-tag 67; 
                    family inet { 
                        address 67.67.67.6/24; 
                    } 
                } 
            } 
            fe-0/0/0 { 
                unit 68 { 
                    vlan-tag 68; 
                    family inet { 
                        address 68.68.68.6/24; 
                    } 
                } 
            } 
            fe-0/0/0 { 
                unit 69 { 
                    vlan-tag 69; 
                    family inet { 
                        address 69.69.69.6/24; 
                    } 
                } 
            } 
        } 
        protocols { 
            ospf { 
                area 0 { 
                    interface lo0.6; 
                    interface fe-0/0/1.56; 
                } 
            } 
            mpls { 
               interface fe-0/0/1.56; 
            } 
            ldp { 
               interface fe-0/0/1.56; 
            } 
            bgp { 
                group int { 
                    type internal; 
                    local-address 99.99.99.6; 
                    family inet-vpn { 
                        unicast; 
                    } 
                    neighbor 99.99.99.4; 
                } 
            } 
        } 
        routing-instances { 
            pe21 { 
                instance-type vrf; 
                route-distinguisher 100:21; 
                vrf-target target:100:1; 
                interface fe-0/0/0.67; 
                routing-options { 
                    static { 
                        route 99.99.99.7/32 { 
                            next-hop 67.67.67.7; 
                        } 
                    } 
                } 
            } 
            pe22 { 
                instance-type vrf; 
                route-distinguisher 100:22; 
                vrf-target target:100:2; 
                interface fe-0/0/0.68; 
                protocols { 
                    ospf { 
                        export bgp-routes; 
                        area 0 { 
                           interface fe-0/0/0.68; 
                        } 
                    } 
                } 
            } 
            pe23 { 
                instance-type vrf; 
                route-distinguisher 100:23; 
                vrf-target target:100:3; 
                interface fe-0/0/0.69; 
                protocols { 
                    rip { 
                        group ces { 
                           export bgp-routes; 
                           neighbor fe-0/0/0.69; 
                        } 
                    } 
                } 
            } 
        } 
    } 
    ce21 { 
        routing-options { 
            router-id 99.99.99.7; 
            static { 
                route 0.0.0.0/0 { 
                    next-hop 67.67.67.6; 
                    retain; 
                } 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 7 { 
                    family inet { 
                        address 99.99.99.7/32; 
                    } 
                } 
            } 
            fe-0/0/1 { 
                unit 67 { 
                    vlan-tag 67; 
                    family inet { 
                        address 67.67.67.7/24; 
                    } 
                } 
            } 
        } 
    } 
    ce22 { 
        routing-options { 
            router-id 99.99.99.8; 
        } 
        interfaces { 
            lo0 { 
                unit 8 { 
                    family inet { 
                        address 99.99.99.8/32; 
                    } 
                } 
            } 
            fe-0/0/1 { 
                unit 68 { 
                    vlan-tag 68; 
                    family inet { 
                        address 68.68.68.8/24; 
                    } 
                } 
            } 
        } 
        protocols { 
            ospf { 
                area 0 { 
                   interface lo0.8; 
                   interface fe-0/0/1.68; 
                } 
            } 
        } 
    } 
    ce23 { 
        routing-options { 
            router-id 99.99.99.9; 
        } 
        interfaces { 
            lo0 { 
                unit 9 { 
                    family inet { 
                        address 99.99.99.9/32; 
                    } 
                } 
            } 
            fe-0/0/1 { 
                unit 69 { 
                    vlan-tag 69; 
                    family inet { 
                        address 69.69.69.9/24; 
                    } 
                } 
            } 
        } 
        policy-options { 
            policy-statement direct-routes {  
                from protocol direct; 
                then accept; 
            } 
        } 
        protocols { 
            rip { 
                group pe { 
                   export direct-routes; 
                   neighbor fe-0/0/1.69; 
                } 
            } 
        } 
    } 
} 
 
A.3. TOPOLOGY "VPNV4-BGP 
 
This topology is used to test IPv4 VPNs with variations of BGP as the 
PE-CE protocol. 
 
A.3.1. LOGICAL TOPOLOGY 
 
+----+ EBGP   +-----+           +-----+ EBGP   +----+ 
|ce11|--------|     |           |     |--------|ce21| 
+----+        |     |           |     |        +----+ 
AS65011       |     |           |     |       AS65021 
              |     |           |     | 
+----+ EBGP   |     |   +---+   |     | EBGP   +----+ 
|ce12|--------| pe1 |---| p |---| pe2 |--------|ce22| 
+----+        |     |   +---+   |     |        +----+ 
AS200         |     |           |     |         AS200 
              |     |           |     | 
+----+ IBGP   |     |           |     | IBGP   +----+ 
|ce13|--------|     |           |     |--------|ce23| 
+----+        +-----+           +-----+        +----+ 
AS300                                           AS300 
 
      <------>       <--------->       <------> 
       IPv4           IPv4              IPv4 
 
Pe1 is the default logical router on physical router "dommelsch". It is 
the device under test. 
 
Ce11, ce12, ce13, p, pe2, ce21, ce22, and ce23 are logical routers on 
physical router "fosters". 
 
ce11 and ce21 use EBGP as the PE-CE protocol. Each site has a unique AS 
number. 
 
ce21 and ce22 use EBGP as the PE-CE protocol. Both sites have the same 
AS number and as-override is used to prevent loops in the AS-path. 
 
ce31 and ce32 use IBGP as the PE-CE protocol. Independent domains as 
used to hide the core AS. 
 
A.3.2. CONFIGURATION FOR DOMMELSCH 
 
chassis { 
    redundancy { 
        graceful-switchover { 
            enable; 
        } 
    } 
} 
routing-options { 
    nonstop-routing; 
    router-id 99.99.99.4; 
    autonomous-system 100; 
} 
interfaces { 
    lo0 { 
        unit 0 { 
            family inet { 
                address 99.99.99.4/32; 
            } 
        } 
    } 
    fe-0/3/2 { 
        vlan-tagging; 
        unit 14 { 
            vlan-id 14; 
            family inet { 
                address 14.14.14.4/24; 
            } 
        } 
        unit 24 { 
            vlan-id 24; 
            family inet { 
                address 24.24.24.4/24; 
            } 
        } 
        unit 34 { 
            vlan-id 34; 
            family inet { 
                address 34.34.34.4/24; 
            } 
        } 
        unit 45 { 
            vlan-id 45; 
            family inet { 
                address 45.45.45.4/24; 
            } 
            family mpls; 
        } 
    } 
} 
protocols { 
    ospf { 
        area 0 { 
            interface lo0.0; 
            interface fe-0/3/2.45; 
        } 
    } 
    mpls { 
        interface fe-0/3/2.45; 
    } 
    ldp { 
        interface fe-0/3/2.45; 
    } 
    bgp { 
        group int { 
            type internal; 
            local-address 99.99.99.4; 
            family inet-vpn { 
                unicast; 
            } 
            neighbor 99.99.99.6; 
        } 
    } 
} 
routing-instances { 
    pe11 { 
        instance-type vrf; 
        route-distinguisher 100:11; 
        vrf-target target:100:1; 
        interface fe-0/3/2.14; 
        protocols { 
            bgp { 
                group ext { 
                    type external; 
                    neighbor 14.14.14.1 { 
                        peer-as 65011; 
                    } 
                } 
            } 
        } 
    } 
    pe12 { 
        instance-type vrf; 
        route-distinguisher 100:12; 
        vrf-target target:100:2; 
        interface fe-0/3/2.24; 
        protocols { 
            bgp { 
                group ext { 
                    type external; 
                    as-override; 
                    neighbor 24.24.24.2 { 
                        peer-as 200; 
                    } 
                } 
            } 
        } 
    } 
    pe13 { 
        instance-type vrf; 
        route-distinguisher 100:13; 
        vrf-target target:100:3; 
        interface fe-0/3/2.34; 
        routing-options { 
            autonomous-system 300 independent-domain; 
        } 
        protocols { 
            bgp { 
                group int { 
                    type internal; 
                    neighbor 34.34.34.3;                 } 
            } 
        } 
    } 
} 
 
A.3.2. CONFIGURATION FOR FOSTERS 
 
interfaces { 
    fe-0/0/0 { 
        vlan-tagging; 
    } 
    fe-0/0/1 { 
        vlan-tagging; 
    } 
    fe-0/0/2 { 
        vlan-tagging; 
    } 
} 
logical-routers { 
    ce11 { 
        routing-options { 
            router-id 99.99.99.1; 
            autonomous-system 65011; 
        } 
        policy-options { 
            policy-statement loopback { 
                from route-filter 99.99.99.1/32 exact; 
                then accept; 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 1 { 
                    family inet { 
                        address 99.99.99.1/32; 
                    } 
                } 
            } 
            fe-0/0/2 { 
                unit 14 { 
                    vlan-tag 14; 
                    family inet { 
                        address 14.14.14.1/24; 
                    } 
                } 
            } 
        } 
        protocols { 
            bgp { 
                group ext { 
                    type external; 
                    export loopback; 
                    neighbor 14.14.14.4 { 
                        peer-as 100; 
                    } 
                } 
            } 
        } 
    } 
    ce12 { 
        routing-options { 
            router-id 99.99.99.2; 
            autonomous-system 200; 
        } 
        policy-options { 
            policy-statement loopback { 
                from route-filter 99.99.99.2/32 exact; 
                then accept; 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 2 { 
                    family inet { 
                        address 99.99.99.2/32; 
                    } 
                } 
            } 
            fe-0/0/2 { 
                unit 24 { 
                    vlan-tag 24; 
                    family inet { 
                        address 24.24.24.2/24; 
                    } 
                } 
            } 
        } 
        protocols { 
            bgp { 
                group ext { 
                    type external; 
                    export loopback; 
                    neighbor 24.24.24.4 { 
                        peer-as 100; 
                    } 
                } 
            } 
        } 
    } 
    ce13 { 
        routing-options { 
            router-id 99.99.99.3; 
            autonomous-system 300; 
        } 
        policy-options { 
            policy-statement loopback { 
                from route-filter 99.99.99.3/32 exact; 
                then accept; 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 3 { 
                    family inet { 
                        address 99.99.99.3/32; 
                    } 
                } 
            } 
            fe-0/0/2 { 
                unit 34 { 
                    vlan-tag 34; 
                    family inet { 
                        address 34.34.34.3/24; 
                    } 
                } 
            } 
        } 
        protocols { 
            bgp { 
                group int { 
                    type internal; 
                    export loopback; 
                    neighbor 34.34.34.4; 
                } 
            } 
        } 
    } 
    p { 
        routing-options { 
            router-id 99.99.99.5; 
        } 
        interfaces { 
            lo0 { 
                unit 5 { 
                    family inet { 
                        address 99.99.99.5/32; 
                    } 
                } 
            } 
            fe-0/0/2 { 
                unit 45 { 
                    vlan-tag 45; 
                    family inet { 
                        address 45.45.45.5/24; 
                    } 
                    family mpls; 
                } 
            } 
            fe-0/0/0 { 
                unit 56 { 
                    vlan-tag 56; 
                    family inet { 
                        address 56.56.56.5/24; 
                    } 
                    family mpls; 
                } 
            } 
        } 
        protocols { 
            ospf { 
                area 0 { 
                    interface lo0.5; 
                    interface fe-0/0/2.45; 
                    interface fe-0/0/0.56; 
                } 
            } 
            mpls { 
               interface fe-0/0/2.45; 
               interface fe-0/0/0.56; 
            } 
            ldp { 
               interface fe-0/0/2.45; 
               interface fe-0/0/0.56; 
            } 
        } 
    } 
    pe2 { 
        routing-options { 
            router-id 99.99.99.6; 
            autonomous-system 100; 
        } 
        policy-options { 
            policy-statement bgp-routes {  
                from protocol bgp; 
                then accept; 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 6 { 
                    family inet { 
                        address 99.99.99.6/32; 
                    } 
                } 
            } 
            fe-0/0/1 { 
                unit 56 { 
                    vlan-tag 56; 
                    family inet { 
                        address 56.56.56.6/24; 
                    } 
                    family mpls; 
                } 
            } 
            fe-0/0/0 { 
                unit 67 { 
                    vlan-tag 67; 
                    family inet { 
                        address 67.67.67.6/24; 
                    } 
                } 
            } 
            fe-0/0/0 { 
                unit 68 { 
                    vlan-tag 68; 
                    family inet { 
                        address 68.68.68.6/24; 
                    } 
                } 
            } 
            fe-0/0/0 { 
                unit 69 { 
                    vlan-tag 69; 
                    family inet { 
                        address 69.69.69.6/24; 
                    } 
                } 
            } 
        } 
        protocols { 
            ospf { 
                area 0 { 
                    interface lo0.6; 
                    interface fe-0/0/1.56; 
                } 
            } 
            mpls { 
               interface fe-0/0/1.56; 
            } 
            ldp { 
               interface fe-0/0/1.56; 
            } 
            bgp { 
                group int { 
                    type internal; 
                    local-address 99.99.99.6; 
                    family inet-vpn { 
                        unicast; 
                    } 
                    neighbor 99.99.99.4; 
                } 
            } 
        } 
        routing-instances { 
            pe21 { 
                instance-type vrf; 
                route-distinguisher 100:21; 
                vrf-target target:100:1; 
                interface fe-0/0/0.67; 
                protocols { 
                    bgp { 
                        group ext { 
                            type external; 
                            neighbor 67.67.67.7 { 
                                peer-as 65021; 
                            } 
                        } 
                    } 
                } 
            } 
            pe22 { 
                instance-type vrf; 
                route-distinguisher 100:22; 
                vrf-target target:100:2; 
                interface fe-0/0/0.68; 
                protocols { 
                    bgp { 
                        group ext { 
                            type external; 
                            as-override; 
                            neighbor 68.68.68.8 { 
                                peer-as 200; 
                            } 
                        } 
                    } 
                } 
            } 
            pe23 { 
                instance-type vrf; 
                route-distinguisher 100:23; 
                vrf-target target:100:3; 
                interface fe-0/0/0.69; 
                routing-options { 
                    autonomous-system 300 independent-domain; 
                } 
                protocols { 
                    bgp { 
                        group int { 
                            type internal; 
                            neighbor 69.69.69.9; 
                        } 
                    } 
                } 
            } 
        } 
    } 
    ce21 { 
        routing-options { 
            router-id 99.99.99.7; 
            autonomous-system 65021; 
        } 
        policy-options { 
            policy-statement loopback { 
                from route-filter 99.99.99.7/32 exact; 
                then accept; 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 7 { 
                    family inet { 
                        address 99.99.99.7/32; 
                    } 
                } 
            } 
            fe-0/0/1 { 
                unit 67 { 
                    vlan-tag 67; 
                    family inet { 
                        address 67.67.67.7/24; 
                    } 
                } 
            } 
        } 
        protocols { 
            bgp { 
                group ext { 
                    type external; 
                    export loopback; 
                    neighbor 67.67.67.6 { 
                        peer-as 100; 
                    } 
                } 
            } 
        } 
    } 
    ce22 { 
        routing-options { 
            router-id 99.99.99.8; 
            autonomous-system 200; 
        } 
        policy-options { 
            policy-statement loopback { 
                from route-filter 99.99.99.8/32 exact; 
                then accept; 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 8 { 
                    family inet { 
                        address 99.99.99.8/32; 
                    } 
                } 
            } 
            fe-0/0/1 { 
                unit 68 { 
                    vlan-tag 68; 
                    family inet { 
                        address 68.68.68.8/24; 
                    } 
                } 
            } 
        } 
        protocols { 
            bgp { 
                group ext { 
                    type external; 
                    export loopback; 
                    neighbor 68.68.68.6 { 
                        peer-as 100; 
                    } 
                } 
            } 
        } 
    } 
    ce23 { 
        routing-options { 
            router-id 99.99.99.9; 
            autonomous-system 300; 
        } 
        policy-options { 
            policy-statement loopback { 
                from route-filter 99.99.99.9/32 exact; 
                then accept; 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 9 { 
                    family inet { 
                        address 99.99.99.9/32; 
                    } 
                } 
            } 
            fe-0/0/1 { 
                unit 69 { 
                    vlan-tag 69; 
                    family inet { 
                        address 69.69.69.9/24; 
                    } 
                } 
            } 
        } 
        protocols { 
            bgp { 
                group int { 
                    type internal; 
                    export loopback; 
                    neighbor 69.69.69.6; 
                } 
            } 
        } 
    } 
} 
 
A.4. TOPOLOGY "VPNV6-IGP" 
 
This topology is used to test IPv6 VPN over an IPv4 core with various 
IGPs as the PE-CE protocol. 
 
A.4.1. LOGICAL TOPOLOGY 
 
+----+ Static +-----+           +-----+ Static +----+ 
|ce11|--------|     |           |     |--------|ce21| 
+----+        |     |           |     |        +----+ 
              |     |           |     | 
+----+ OSPF   |     |   +---+   |     | OSPF   +----+ 
|ce12|--------| pe1 |---| p |---| pe2 |--------|ce22| 
+----+        |     |   +---+   |     |        +----+ 
              |     |           |     | 
              |     |           |     | 
              |     |           |     | 
              +-----+           +-----+ 

      <------>       <--------->       <------> 
       IPv6           IPv4              IPv6 
 
Pe1 is the default logical router on physical router "dommelsch". It is 
the device under test. 
 
Ce11, ce12, p, pe2, ce21, and ce22 are logical routers on physical 
router "fosters". 
 
Ce11 and ce21 use IPv6 static routes as the PE-CE protocol. 
 
Ce21 and ce22 use OSPFv3 as the PE-CE protocol. 
 
Note: RIPng is currently not supported as a PE-CE protocol (see PR 
76259). 
 
A.4.2. CONFIGURATION FOR DOMMELSCH 
 
chassis { 
    redundancy { 
        graceful-switchover { 
            enable; 
        } 
    } 
} 
routing-options { 
    nonstop-routing; 
    router-id 99.99.99.4; 
    autonomous-system 100; 
} 
policy-options { 
    policy-statement bgp-routes {  
        from protocol bgp; 
        then accept; 
    } 
} 
interfaces { 
    lo0 { 
        unit 0 { 
            family inet { 
                address 99.99.99.4/32; 
            } 
        } 
    } 
    fe-0/3/2 { 
        vlan-tagging; 
        unit 14 { 
            vlan-id 14; 
            family inet6 { 
                address ::14:14:14:4/120; 
            } 
        } 
        unit 24 { 
            vlan-id 24; 
            family inet6 { 
                address ::24:24:24:4/120; 
            } 
        } 
        unit 45 { 
            vlan-id 45; 
            family inet { 
                address 45.45.45.4/24; 
            } 
            family mpls; 
        } 
    } 
} 
protocols { 
    ospf { 
        area 0 { 
            interface lo0.0; 
            interface fe-0/3/2.45; 
        } 
    } 
    mpls { 
        ipv6-tunneling; 
        interface fe-0/3/2.45; 
    } 
    ldp { 
        interface fe-0/3/2.45; 
    } 
    bgp { 
        group int { 
            type internal; 
            local-address 99.99.99.4; 
            family inet6-vpn { 
                unicast; 
            } 
            neighbor 99.99.99.6; 
        } 
    } 
} 
routing-instances { 
    pe11 { 
        instance-type vrf; 
        route-distinguisher 100:11; 
        vrf-target target:100:1; 
        interface fe-0/3/2.14; 
        routing-options { 
            router-id 99.99.99.11; 
            rib pe11.inet6.0 { 
                static { 
                    route ::99:99:99:1/128 { 
                        next-hop ::14:14:14:1; 
                    } 
                } 
            } 
        } 
    } 
    pe12 { 
        instance-type vrf; 
        route-distinguisher 100:12; 
        vrf-target target:100:2; 
        interface fe-0/3/2.24; 
        routing-options { 
            router-id 99.99.99.12; 
        } 
        protocols { 
            ospf3 { 
                export bgp-routes; 
                area 0 { 
                        interface fe-0/3/2.24; 
                } 
            } 
        } 
    } 
} 
 
A.4.2. CONFIGURATION FOR FOSTERS 
 
interfaces { 
    fe-0/0/0 { 
        vlan-tagging; 
    } 
    fe-0/0/1 { 
        vlan-tagging; 
    } 
    fe-0/0/2 { 
        vlan-tagging; 
    } 
} 
logical-routers { 
    ce11 { 
        routing-options { 
            router-id 99.99.99.1; 
            rib inet6.0 { 
                static { 
                    route 0::/0 { 
                        next-hop ::14:14:14:4; 
                        retain; 
                    } 
                } 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 1 { 
                    family inet6 { 
                        address ::99:99:99:1/128; 
                    } 
                } 
            } 
            fe-0/0/2 { 
                unit 14 { 
                    vlan-tag 14; 
                    family inet6 { 
                        address ::14:14:14:1/120; 
                    } 
                } 
            } 
        } 
    } 
    ce12 { 
        routing-options { 
            router-id 99.99.99.2; 
        } 
        interfaces { 
            lo0 { 
                unit 2 { 
                    family inet6 { 
                        address ::99:99:99:2/128; 
                    } 
                } 
            } 
            fe-0/0/2 { 
                unit 24 { 
                    vlan-tag 24; 
                    family inet6 { 
                        address ::24:24:24:2/120; 
                    } 
                } 
            } 
        } 
        protocols { 
            ospf3 { 
                area 0 { 
                   interface lo0.2; 
                   interface fe-0/0/2.24; 
                } 
            } 
        } 
    } 
    p { 
        routing-options { 
            router-id 99.99.99.5; 
        } 
        interfaces { 
            lo0 { 
                unit 5 { 
                    family inet { 
                        address 99.99.99.5/32; 
                    } 
                } 
            } 
            fe-0/0/2 { 
                unit 45 { 
                    vlan-tag 45; 
                    family inet { 
                        address 45.45.45.5/24; 
                    } 
                    family mpls; 
                } 
            } 
            fe-0/0/0 { 
                unit 56 { 
                    vlan-tag 56; 
                    family inet { 
                        address 56.56.56.5/24; 
                    } 
                    family mpls; 
                } 
            } 
        } 
        protocols { 
            ospf { 
                area 0 { 
                    interface lo0.5; 
                    interface fe-0/0/2.45; 
                    interface fe-0/0/0.56; 
                } 
            } 
            mpls { 
               interface fe-0/0/2.45; 
               interface fe-0/0/0.56; 
            } 
            ldp { 
               interface fe-0/0/2.45; 
               interface fe-0/0/0.56; 
            } 
        } 
    } 
    pe2 { 
        routing-options { 
            router-id 99.99.99.6; 
            autonomous-system 100; 
        } 
        policy-options { 
            policy-statement bgp-routes {  
                from protocol bgp; 
                then accept; 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 6 { 
                    family inet { 
                        address 99.99.99.6/32; 
                    } 
                } 
            } 
            fe-0/0/1 { 
                unit 56 { 
                    vlan-tag 56; 
                    family inet { 
                        address 56.56.56.6/24; 
                    } 
                    family mpls; 
                } 
            } 
            fe-0/0/0 { 
                unit 67 { 
                    vlan-tag 67; 
                    family inet6 { 
                        address ::67:67:67:6/120; 
                    } 
                } 
            } 
            fe-0/0/0 { 
                unit 68 { 
                    vlan-tag 68; 
                    family inet6 { 
                        address ::68:68:68:6/120; 
                    } 
                } 
            } 
        } 
        protocols { 
            ospf { 
                area 0 { 
                    interface lo0.6; 
                    interface fe-0/0/1.56; 
                } 
            } 
            mpls { 
               ipv6-tunneling; 
               interface fe-0/0/1.56; 
            } 
            ldp { 
               interface fe-0/0/1.56; 
            } 
            bgp { 
                group int { 
                    type internal; 
                    local-address 99.99.99.6; 
                    family inet6-vpn { 
                        unicast; 
                    } 
                    neighbor 99.99.99.4; 
                } 
            } 
        } 
        routing-instances { 
            pe21 { 
                instance-type vrf; 
                route-distinguisher 100:21; 
                vrf-target target:100:1; 
                interface fe-0/0/0.67; 
                routing-options { 
                    router-id 99.99.99.21; 
                    rib pe21.inet6.0 { 
                        static { 
                            route ::99:99:99:7/128 { 
                                next-hop ::67:67:67:7; 
                            } 
                        } 
                    } 
                } 
            } 
            pe22 { 
                instance-type vrf; 
                route-distinguisher 100:22; 
                vrf-target target:100:2; 
                interface fe-0/0/0.68; 
                routing-options { 
                    router-id 99.99.99.22; 
                } 
                protocols { 
                    ospf3 { 
                        export bgp-routes; 
                        area 0 { 
                           interface fe-0/0/0.68; 
                        } 
                    } 
                } 
            } 
        } 
    } 
    ce21 { 
        routing-options { 
            router-id 99.99.99.7; 
            rib inet6.0 { 
                static { 
                    route 0::/0 { 
                        next-hop ::67:67:67:6; 
                        retain; 
                    } 
                } 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 7 { 
                    family inet6 { 
                        address ::99:99:99:7/128; 
                    } 
                } 
            } 
            fe-0/0/1 { 
                unit 67 { 
                    vlan-tag 67; 
                    family inet6 { 
                        address ::67:67:67:7/120; 
                    } 
                } 
            } 
        } 
    } 
    ce22 { 
        routing-options { 
            router-id 99.99.99.8; 
        } 
        interfaces { 
            lo0 { 
                unit 8 { 
                    family inet6 { 
                        address ::99:99:99:8/128; 
                    } 
                } 
            } 
            fe-0/0/1 { 
                unit 68 { 
                    vlan-tag 68; 
                    family inet6 { 
                        address ::68:68:68:8/120; 
                    } 
                } 
            } 
        } 
        protocols { 
            ospf3 { 
                area 0 { 
                   interface lo0.8; 
                   interface fe-0/0/1.68; 
                } 
            } 
        } 
    } 
} 
 
A.5. TOPOLOGY "VPNV6-BGP 
 
This topology is used to test IPv6 VPNs with variations of BGP as the 
PE-CE protocol. 
 
A.5.1. LOGICAL TOPOLOGY 
 
+----+ EBGP   +-----+           +-----+ EBGP   +----+ 
|ce11|--------|     |           |     |--------|ce21| 
+----+        |     |           |     |        +----+ 
AS65011       |     |           |     |       AS65021 
              |     |           |     | 
+----+ EBGP   |     |   +---+   |     | EBGP   +----+ 
|ce12|--------| pe1 |---| p |---| pe2 |--------|ce22| 
+----+        |     |   +---+   |     |        +----+ 
AS200         |     |           |     |         AS200 
              |     |           |     | 
+----+ IBGP   |     |           |     | IBGP   +----+ 
|ce13|--------|     |           |     |--------|ce23| 
+----+        +-----+           +-----+        +----+ 
AS300                                           AS300 
 
      <------>       <--------->       <------> 
       IPv6           IPv4              IPv6 
 
Pe1 is the default logical router on physical router "dommelsch". It is 
the device under test. 
 
Ce11, ce12, ce13, p, pe2, ce21, ce22, and ce23 are logical routers on 
physical router "fosters". 
 
ce11 and ce21 use IPv6 EBGP as the PE-CE protocol. Each site has a 
unique AS number. 
 
ce21 and ce22 use IPv6 EBGP as the PE-CE protocol. Both sites have the 
same AS number and as-override is used to prevent loops in the AS-path. 

ce31 and ce32 use IPv6 IBGP as the PE-CE protocol. Independent domains 
as used to hide the core AS. 
 
A.5.2. CONFIGURATION FOR DOMMELSCH 
 
chassis { 
    redundancy { 
        graceful-switchover { 
            enable; 
        } 
    } 
} 
routing-options { 
    nonstop-routing; 
    router-id 99.99.99.4; 
    autonomous-system 100; 
} 
interfaces { 
    lo0 { 
        unit 0 { 
            family inet { 
                address 99.99.99.4/32; 
            } 
        } 
    } 
    fe-0/3/2 { 
        vlan-tagging; 
        unit 14 { 
            vlan-id 14; 
            family inet6 { 
                address ::14:14:14:4/120; 
            } 
        } 
        unit 24 { 
            vlan-id 24; 
            family inet6 { 
                address ::24:24:24:4/120; 
            } 
        } 
        unit 34 { 
            vlan-id 34; 
            family inet6 { 
                address ::34:34:34:4/120; 
            } 
        } 
        unit 45 { 
            vlan-id 45; 
            family inet { 
                address 45.45.45.4/24; 
            } 
            family mpls; 
        } 
    } 
} 
protocols { 
    ospf { 
        area 0 { 
            interface lo0.0; 
            interface fe-0/3/2.45; 
        } 
    } 
    mpls { 
        ipv6-tunneling; 
        interface fe-0/3/2.45; 
    } 
    ldp { 
        interface fe-0/3/2.45; 
    } 
    bgp { 
        group int { 
            type internal; 
            local-address 99.99.99.4; 
            family inet6-vpn { 
                unicast; 
            } 
            neighbor 99.99.99.6; 
        } 
    } 
} 
routing-instances { 
    pe11 { 
        instance-type vrf; 
        route-distinguisher 100:11; 
        vrf-target target:100:1; 
        interface fe-0/3/2.14; 
        routing-options { 
            router-id 99.99.99.11; 
        } 
        protocols { 
            bgp { 
                group ext { 
                    type external; 
                    neighbor ::14:14:14:1 { 
                        peer-as 65011; 
                    } 
                } 
            } 
        } 
    } 
    pe12 { 
        instance-type vrf; 
        route-distinguisher 100:12; 
        vrf-target target:100:2; 
        interface fe-0/3/2.24; 
        routing-options { 
            router-id 99.99.99.11; 
        } 
        protocols { 
            bgp { 
                group ext { 
                    type external; 
                    as-override; 
                    neighbor ::24:24:24:2 { 
                        peer-as 200; 
                    } 
                } 
            } 
        } 
    } 
    pe13 { 
        instance-type vrf; 
        route-distinguisher 100:13; 
        vrf-target target:100:3; 
        interface fe-0/3/2.34; 
        routing-options { 
            router-id 99.99.99.13; 
            autonomous-system 300 independent-domain; 
        } 
        protocols { 
            bgp { 
                group int { 
                    type internal; 
                    neighbor ::34:34:34:3; 
                } 
            } 
        } 
    } 
} 
 
A.5.2. CONFIGURATION FOR FOSTERS 
 
interfaces { 
    fe-0/0/0 { 
        vlan-tagging; 
    } 
    fe-0/0/1 { 
        vlan-tagging; 
    } 
    fe-0/0/2 { 
        vlan-tagging; 
    } 
} 
logical-routers { 
    ce11 { 
        routing-options { 
            router-id 99.99.99.1; 
            autonomous-system 65011; 
        } 
        policy-options { 
            policy-statement loopback { 
                from route-filter ::99:99:99:1/128 exact; 
                then accept; 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 1 { 
                    family inet6 { 
                        address ::99:99:99:1/128; 
                    } 
                } 
            } 
            fe-0/0/2 { 
                unit 14 { 
                    vlan-tag 14; 
                    family inet6 { 
                        address ::14:14:14:1/120; 
                    } 
                } 
            } 
        } 
        protocols { 
            bgp { 
                group ext { 
                    type external; 
                    export loopback; 
                    neighbor ::14:14:14:4 { 
                        peer-as 100; 
                    } 
                } 
            } 
        } 
    } 
    ce12 { 
        routing-options { 
            router-id 99.99.99.2; 
            autonomous-system 200; 
        } 
        policy-options { 
            policy-statement loopback { 
                from route-filter ::99:99:99:2/128 exact; 
                then accept; 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 2 { 
                    family inet6 { 
                        address ::99:99:99:2/128; 
                    } 
                } 
            } 
            fe-0/0/2 { 
                unit 24 { 
                    vlan-tag 24; 
                    family inet6 { 
                        address ::24:24:24:2/120; 
                    } 
                } 
            } 
        } 
        protocols { 
            bgp { 
                group ext { 
                    type external; 
                    export loopback; 
                    neighbor ::24:24:24:4 { 
                        peer-as 100; 
                    } 
                } 
            } 
        } 
    } 
    ce13 { 
        routing-options { 
            router-id 99.99.99.3; 
            autonomous-system 300; 
        } 
        policy-options { 
            policy-statement loopback { 
                from route-filter ::99:99:99:3/128 exact; 
                then accept; 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 3 { 
                    family inet6 { 
                        address ::99:99:99:3/128; 
                    } 
                } 
            } 
            fe-0/0/2 { 
                unit 34 { 
                    vlan-tag 34; 
                    family inet6 { 
                        address ::34:34:34:3/120; 
                    } 
                } 
            } 
        } 
        protocols { 
            bgp { 
                group int { 
                    type internal; 
                    export loopback; 
                    neighbor ::34:34:34:4; 
                } 
            } 
        } 
    } 
    p { 
        routing-options { 
            router-id 99.99.99.5; 
        } 
        interfaces { 
            lo0 { 
                unit 5 { 
                    family inet { 
                        address 99.99.99.5/32; 
                    } 
                } 
            } 
            fe-0/0/2 { 
                unit 45 { 
                    vlan-tag 45; 
                    family inet { 
                        address 45.45.45.5/24; 
                    } 
                    family mpls; 
                } 
            } 
            fe-0/0/0 { 
                unit 56 { 
                    vlan-tag 56; 
                    family inet { 
                        address 56.56.56.5/24; 
                    } 
                    family mpls; 
                } 
            } 
        } 
        protocols { 
            ospf { 
                area 0 { 
                    interface lo0.5; 
                    interface fe-0/0/2.45; 
                    interface fe-0/0/0.56; 
                } 
            } 
            mpls { 
               interface fe-0/0/2.45; 
               interface fe-0/0/0.56; 
            } 
            ldp { 
               interface fe-0/0/2.45; 
               interface fe-0/0/0.56; 
            } 
        } 
    } 
    pe2 { 
        routing-options { 
            router-id 99.99.99.6; 
            autonomous-system 100; 
        } 
        policy-options { 
            policy-statement bgp-routes {  
                from protocol bgp; 
                then accept; 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 6 { 
                    family inet { 
                        address 99.99.99.6/32; 
                    } 
                } 
            } 
            fe-0/0/1 { 
                unit 56 { 
                    vlan-tag 56; 
                    family inet { 
                        address 56.56.56.6/24; 
                    } 
                    family mpls; 
                } 
            } 
            fe-0/0/0 { 
                unit 67 { 
                    vlan-tag 67; 
                    family inet6 { 
                        address ::67:67:67:6/120; 
                    } 
                } 
            } 
            fe-0/0/0 { 
                unit 68 { 
                    vlan-tag 68; 
                    family inet6 { 
                        address ::68:68:68:6/120; 
                    } 
                } 
            } 
            fe-0/0/0 { 
                unit 69 { 
                    vlan-tag 69; 
                    family inet6 { 
                        address ::69:69:69:6/120; 
                    } 
                } 
            } 
        } 
        protocols { 
            ospf { 
                area 0 { 
                    interface lo0.6; 
                    interface fe-0/0/1.56; 
                } 
            } 
            mpls { 
               ipv6-tunneling; 
               interface fe-0/0/1.56; 
            } 
            ldp { 
               interface fe-0/0/1.56; 
            } 
            bgp { 
                group int { 
                    type internal; 
                    local-address 99.99.99.6; 
                    family inet6-vpn { 
                        unicast; 
                    } 
                    neighbor 99.99.99.4; 
                } 
            } 
        } 
        routing-instances { 
            pe21 { 
                instance-type vrf; 
                route-distinguisher 100:21; 
                vrf-target target:100:1; 
                interface fe-0/0/0.67; 
                routing-options { 
                    router-id 99.99.99.21; 
                } 
                protocols { 
                    bgp { 
                        group ext { 
                            type external; 
                            neighbor ::67:67:67:7 { 
                                peer-as 65021; 
                            } 
                        } 
                    } 
                } 
            } 
            pe22 { 
                instance-type vrf; 
                route-distinguisher 100:22; 
                vrf-target target:100:2; 
                interface fe-0/0/0.68; 
                routing-options { 
                    router-id 99.99.99.22; 
                } 
                protocols { 
                    bgp { 
                        group ext { 
                            type external; 
                            as-override; 
                            neighbor ::68:68:68:8 { 
                                peer-as 200; 
                            } 
                        } 
                    } 
                } 
            } 
            pe23 { 
                instance-type vrf; 
                route-distinguisher 100:23; 
                vrf-target target:100:3; 
                interface fe-0/0/0.69; 
                routing-options { 
                    router-id 99.99.99.21; 
                    autonomous-system 300 independent-domain; 
                } 
                protocols { 
                    bgp { 
                        group int { 
                            type internal; 
                            neighbor ::69:69:69:9; 
                        } 
                    } 
                } 
            } 
        } 
    } 
    ce21 { 
        routing-options { 
            router-id 99.99.99.7; 
            autonomous-system 65021; 
        } 
        policy-options { 
            policy-statement loopback { 
                from route-filter ::99:99:99:7/128 exact; 
                then accept; 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 7 { 
                    family inet6 { 
                        address ::99:99:99:7/128; 
                    } 
                } 
            } 
            fe-0/0/1 { 
                unit 67 { 
                    vlan-tag 67; 
                    family inet6 { 
                        address ::67:67:67:7/120; 
                    } 
                } 
            } 
        } 
        protocols { 
            bgp { 
                group ext { 
                    type external; 
                    export loopback; 
                    neighbor ::67:67:67:6 { 
                        peer-as 100; 
                    } 
                } 
            } 
        } 
    } 
    ce22 { 
        routing-options { 
            router-id 99.99.99.8; 
            autonomous-system 200; 
        } 
        policy-options { 
            policy-statement loopback { 
                from route-filter ::99:99:99:8/128 exact; 
                then accept; 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 8 { 
                    family inet6 { 
                        address ::99:99:99:8/128; 
                    } 
                } 
            } 
            fe-0/0/1 { 
                unit 68 { 
                    vlan-tag 68; 
                    family inet6 { 
                        address ::68:68:68:8/120; 
                    } 
                } 
            } 
        } 
        protocols { 
            bgp { 
                group ext { 
                    type external; 
                    export loopback; 
                    neighbor ::68:68:68:6 { 
                        peer-as 100; 
                    } 
                } 
            } 
        } 
    } 
    ce23 { 
        routing-options { 
            router-id 99.99.99.9; 
            autonomous-system 300; 
        } 
        policy-options { 
            policy-statement loopback { 
                from route-filter ::99:99:99:9/128 exact; 
                then accept; 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 9 { 
                    family inet6 { 
                        address ::99:99:99:9/128; 
                    } 
                } 
            } 
            fe-0/0/1 { 
                unit 69 { 
                    vlan-tag 69; 
                    family inet6 { 
                        address ::69:69:69:9/24; 
                    } 
                } 
            } 
        } 
        protocols { 
            bgp { 
                group int { 
                    type internal; 
                    export loopback; 
                    neighbor ::69:69:69:6; 
                } 
            } 
        } 
    } 
} 
 
A.6. TOPOLOGY "VPNV4-RR" 
 
This topology is used to test IPv4 VPNs with a route reflector. 
 
A.6.1. LOGICAL TOPOLOGY 
 
              +-----+    RR     +-----+   
+----+ Static |     |   +---+   |     | Static +----+ 
|ce11|--------| pe1 |---| p |---| pe2 |--------|ce21| 
+----+        |     |   +---+   |     |        +----+ 
              +-----+           +-----+ 
 
      <------>       <--------->       <------> 
       IPv4           IPv4              IPv4 
 
P is the default logical router on physical router "dommelsch". It is 
the device under test. 
 
Ce11, pe1, pe2, p, pe2, and ce21 are logical routers on physical router 
"fosters". 
 
ce11 and ce21 use IPv4 static routes as the PE-CE protocol. 
 
P is a route reflector which has vpn-unicast sessions to pe1 and pe2. 
 
A.6.2. CONFIGURATION FOR DOMMELSCH 
 
chassis { 
    redundancy { 
        graceful-switchover { 
            enable; 
        } 
    } 
} 
routing-options { 
    nonstop-routing; 
    router-id 99.99.99.3; 
    autonomous-system 100; 
} 
interfaces { 
    lo0 { 
        unit 0 { 
            family inet { 
                address 99.99.99.3/32; 
            } 
        } 
    } 
    fe-0/3/2 { 
        vlan-tagging; 
        unit 23 { 
            vlan-id 23; 
            family inet { 
                address 23.23.23.3/24; 
            } 
            family mpls; 
        } 
        unit 34 { 
            vlan-id 34; 
            family inet { 
                address 34.34.34.3/24; 
            } 
            family mpls; 
        } 
    } 
} 
protocols { 
    ospf { 
        area 0 { 
            interface lo0.0; 
            interface fe-0/3/2.23; 
            interface fe-0/3/2.34; 
        } 
    } 
    mpls { 
        interface fe-0/3/2.23; 
        interface fe-0/3/2.34; 
    } 
    ldp { 
        interface fe-0/3/2.23; 
        interface fe-0/3/2.34; 
    } 
    bgp { 
        group int { 
            type internal; 
            local-address 99.99.99.3; 
            family inet-vpn { 
                unicast; 
            } 
            cluster 99.99.99.3; 
            neighbor 99.99.99.2; 
            neighbor 99.99.99.4; 
        } 
    } 
} 
 
A.6.2. CONFIGURATION FOR FOSTERS 
 
interfaces { 
    fe-0/0/0 { 
        vlan-tagging; 
    } 
    fe-0/0/1 { 
        vlan-tagging; 
    } 
    fe-0/0/2 { 
        vlan-tagging; 
    } 
} 
logical-routers { 
    ce11 { 
        routing-options { 
            router-id 99.99.99.1; 
            static { 
                route 0.0.0.0/0 { 
                    next-hop 12.12.12.2; 
                    retain; 
                } 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 1 { 
                    family inet { 
                        address 99.99.99.1/32; 
                    } 
                } 
            } 
            fe-0/0/0 { 
                unit 12 { 
                    vlan-tag 12; 
                    family inet { 
                        address 12.12.12.1/24; 
                    } 
                } 
            } 
        } 
    } 
    pe1 { 
        routing-options { 
            router-id 99.99.99.2; 
            autonomous-system 100; 
        } 
        interfaces { 
            lo0 { 
                unit 2 { 
                    family inet { 
                        address 99.99.99.2/32; 
                    } 
                } 
            } 
            fe-0/0/1 { 
                unit 12 { 
                    vlan-tag 12; 
                    family inet { 
                        address 12.12.12.2/24; 
                    } 
                } 
            } 
            fe-0/0/2 { 
                unit 23 { 
                    vlan-tag 23; 
                    family inet { 
                        address 23.23.23.2/24; 
                    } 
                    family mpls; 
                } 
            } 
        } 
        protocols { 
            ospf { 
                area 0 { 
                    interface lo0.2; 
                    interface fe-0/0/2.23; 
                } 
            } 
            mpls { 
               interface fe-0/0/2.23; 
            } 
            ldp { 
               interface fe-0/0/2.23; 
            } 
            bgp { 
                group int { 
                    type internal; 
                    local-address 99.99.99.2; 
                    family inet-vpn { 
                        unicast; 
                    } 
                    neighbor 99.99.99.3; 
                } 
            } 
        } 
        routing-instances { 
            pe11 { 
                instance-type vrf; 
                route-distinguisher 100:21; 
                vrf-target target:100:1; 
                interface fe-0/0/1.12; 
                routing-options { 
                    static { 
                        route 99.99.99.1/32 { 
                            next-hop 12.12.12.1; 
                        } 
                    } 
                } 
            } 
        } 
    } 
    pe2 { 
        routing-options { 
            router-id 99.99.99.4; 
            autonomous-system 100; 
        } 
        interfaces { 
            lo0 { 
                unit 4 { 
                    family inet { 
                        address 99.99.99.4/32; 
                    } 
                } 
            } 
            fe-0/0/2 { 
                unit 34 { 
                    vlan-tag 34; 
                    family inet { 
                        address 34.34.34.4/24; 
                    } 
                    family mpls; 
                } 
            } 
            fe-0/0/0 { 
                unit 45 { 
                    vlan-tag 45; 
                    family inet { 
                        address 45.45.45.4/24; 
                    } 
                } 
            } 
        } 
        protocols { 
            ospf { 
                area 0 { 
                    interface lo0.4; 
                    interface fe-0/0/2.34; 
                } 
            } 
            mpls { 
               interface fe-0/0/2.34; 
            } 
            ldp { 
               interface fe-0/0/2.34; 
            } 
            bgp { 
                group int { 
                    type internal; 
                    local-address 99.99.99.4; 
                    family inet-vpn { 
                        unicast; 
                    } 
                    neighbor 99.99.99.3; 
                } 
            } 
        } 
        routing-instances { 
            pe21 { 
                instance-type vrf; 
                route-distinguisher 100:21; 
                vrf-target target:100:1; 
                interface fe-0/0/0.45; 
                routing-options { 
                    static { 
                        route 99.99.99.5/32 { 
                            next-hop 45.45.45.5; 
                        } 
                    } 
                } 
            } 
        } 
    } 
    ce21 { 
        routing-options { 
            router-id 99.99.99.5; 
            static { 
                route 0.0.0.0/0 { 
                    next-hop 45.45.45.4; 
                    retain; 
                } 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 5 { 
                    family inet { 
                        address 99.99.99.5/32; 
                    } 
                } 
            } 
            fe-0/0/1 { 
                unit 45 { 
                    vlan-tag 45; 
                    family inet { 
                        address 45.45.45.5/24; 
                    } 
                } 
            } 
        } 
    } 
} 
 
A.7. TOPOLOGY "VPNV4-RTF" 
 
This topology is used to test route target filtering (RTF). 
 
A.7.1. LOGICAL TOPOLOGY 
 
              +-----+    RR     +-----+   
+----+ Static |     |   +---+   |     | Static +----+ 
|ce11|--------| pe1 |---| p |---| pe2 |--------|ce21|     VPN A 
+----+        |     |   +---+   |     |        +----+ 
              +-----+           |     | 
                                |     |        +----+ 
                                |     |--------|ce22|     VPN B 
                                +-----+        +----+ 
 
      <------>       <--------->       <------> 
       IPv4           IPv4              IPv4 
 
P is the default logical router on physical router "dommelsch". It is 
the device under test. 
 
Ce11, pe1, pe2, p, pe2, ce21, and ce22 are logical routers on physical 
router "fosters". 

ce11 and ce21 are in VPN A and use IPv4 static routes as the PE-CE 
protocol. 
 
ce22 is in VPN B and also uses IPv4 static routes as the PE-CE 
protocol. 
 
P is a route reflector which has vpn-unicast sessions to pe1 and pe2. 
Route target filtering is enabled on all BGP sessions.  
 
Note that pe1 is only interested in the routes for VPN A and not in the 
routes for VPN B. 
 
A.7.2. CONFIGURATION FOR DOMMELSCH 
 
chassis { 
    redundancy { 
        graceful-switchover { 
            enable; 
        } 
    } 
} 
routing-options { 
    nonstop-routing; 
    router-id 99.99.99.3; 
    autonomous-system 100; 
} 
interfaces { 
    lo0 { 
        unit 0 { 
            family inet { 
                address 99.99.99.3/32; 
            } 
        } 
    } 
    fe-0/3/2 { 
        vlan-tagging; 
        unit 23 { 
            vlan-id 23; 
            family inet { 
                address 23.23.23.3/24; 
            } 
            family mpls; 
        } 
        unit 34 { 
            vlan-id 34; 
            family inet { 
                address 34.34.34.3/24; 
            } 
            family mpls; 
        } 
    } 
} 
protocols { 
    ospf { 
        area 0 { 
            interface lo0.0; 
            interface fe-0/3/2.23; 
            interface fe-0/3/2.34; 
        } 
    } 
    mpls { 
        interface fe-0/3/2.23; 
        interface fe-0/3/2.34; 
    } 
    ldp { 
        interface fe-0/3/2.23; 
        interface fe-0/3/2.34; 
    } 
    bgp { 
        group int { 
            type internal; 
            local-address 99.99.99.3; 
            family inet-vpn { 
                unicast; 
            } 
            family route-target; 
            cluster 99.99.99.3; 
            neighbor 99.99.99.2; 
            neighbor 99.99.99.4; 
        } 
    } 
} 
 
A.7.3. CONFIGURATION FOR FOSTERS 
 
interfaces { 
    fe-0/0/0 { 
        vlan-tagging; 
    } 
    fe-0/0/1 { 
        vlan-tagging; 
    } 
    fe-0/0/2 { 
        vlan-tagging; 
    } 
} 
logical-routers { 
    ce11 { 
        routing-options { 
            router-id 99.99.99.1; 
            static { 
                route 0.0.0.0/0 { 
                    next-hop 12.12.12.2; 
                    retain; 
                } 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 1 { 
                    family inet { 
                        address 99.99.99.1/32; 
                    } 
                } 
            } 
            fe-0/0/0 { 
                unit 12 { 
                    vlan-tag 12; 
                    family inet { 
                        address 12.12.12.1/24; 
                    } 
                } 
            } 
        } 
    } 
    pe1 { 
        routing-options { 
            router-id 99.99.99.2; 
            autonomous-system 100; 
        } 
        interfaces { 
            lo0 { 
                unit 2 { 
                    family inet { 
                        address 99.99.99.2/32; 
                    } 
                } 
            } 
            fe-0/0/1 { 
                unit 12 { 
                    vlan-tag 12; 
                    family inet { 
                        address 12.12.12.2/24; 
                    } 
                } 
            } 
            fe-0/0/2 { 
                unit 23 { 
                    vlan-tag 23; 
                    family inet { 
                        address 23.23.23.2/24; 
                    } 
                    family mpls; 
                } 
            } 
        } 
        protocols { 
            ospf { 
                area 0 { 
                    interface lo0.2; 
                    interface fe-0/0/2.23; 
                } 
            } 
            mpls { 
               interface fe-0/0/2.23; 
            } 
            ldp { 
               interface fe-0/0/2.23; 
            } 
            bgp { 
                group int { 
                    type internal; 
                    local-address 99.99.99.2; 
                    family inet-vpn { 
                        unicast; 
                    } 
                    family route-target; 
                    neighbor 99.99.99.3; 
                } 
            } 
        } 
        routing-instances { 
            pe11 { 
                instance-type vrf; 
                route-distinguisher 100:21; 
                vrf-target target:100:1; 
                interface fe-0/0/1.12; 
                routing-options { 
                    static { 
                        route 99.99.99.1/32 { 
                            next-hop 12.12.12.1; 
                        } 
                    } 
                } 
            } 
        } 
    } 
    pe2 { 
        routing-options { 
            router-id 99.99.99.4; 
            autonomous-system 100; 
        } 
        interfaces { 
            lo0 { 
                unit 4 { 
                    family inet { 
                        address 99.99.99.4/32; 
                    } 
                } 
            } 
            fe-0/0/2 { 
                unit 34 { 
                    vlan-tag 34; 
                    family inet { 
                        address 34.34.34.4/24; 
                    } 
                    family mpls; 
                } 
            } 
            fe-0/0/0 { 
                unit 45 { 
                    vlan-tag 45; 
                    family inet { 
                        address 45.45.45.4/24; 
                    } 
                } 
                unit 46 { 
                    vlan-tag 46; 
                    family inet { 
                        address 46.46.46.4/24; 
                    } 
                } 
            } 
        } 
        protocols { 
            ospf { 
                area 0 { 
                    interface lo0.4; 
                    interface fe-0/0/2.34; 
                } 
            } 
            mpls { 
               interface fe-0/0/2.34; 
            } 
            ldp { 
               interface fe-0/0/2.34; 
            } 
            bgp { 
                group int { 
                    type internal; 
                    local-address 99.99.99.4; 
                    family inet-vpn { 
                        unicast; 
                    } 
                    family route-target; 
                    neighbor 99.99.99.3; 
                } 
            } 
        } 
        routing-instances { 
            pe21 { 
                instance-type vrf; 
                route-distinguisher 100:21; 
                vrf-target target:100:1; 
                interface fe-0/0/0.45; 
                routing-options { 
                    static { 
                        route 99.99.99.5/32 { 
                            next-hop 45.45.45.5; 
                        } 
                    } 
                } 
            } 
            pe22 { 
                instance-type vrf; 
                route-distinguisher 100:22; 
                vrf-target target:100:2; 
                interface fe-0/0/0.46; 
                routing-options { 
                    static { 
                        route 99.99.99.6/32 { 
                            next-hop 46.46.46.6; 
                        } 
                    } 
                } 
            } 
        } 
    } 
    ce21 { 
        routing-options { 
            router-id 99.99.99.5; 
            static { 
                route 0.0.0.0/0 { 
                    next-hop 45.45.45.4; 
                    retain; 
                } 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 5 { 
                    family inet { 
                        address 99.99.99.5/32; 
                    } 
                } 
            } 
            fe-0/0/1 { 
                unit 45 { 
                    vlan-tag 45; 
                    family inet { 
                        address 45.45.45.5/24; 
                    } 
                } 
            } 
        } 
    } 
    ce22 { 
        routing-options { 
            router-id 99.99.99.6; 
            static { 
                route 0.0.0.0/0 { 
                    next-hop 46.46.46.4; 
                    retain; 
                } 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 6 { 
                    family inet { 
                        address 99.99.99.6/32; 
                    } 
                } 
            } 
            fe-0/0/1 { 
                unit 46 { 
                    vlan-tag 46; 
                    family inet { 
                        address 46.46.46.6/24; 
                    } 
                } 
            } 
        } 
    } 
} 
 
A.8. TOPOLOGY "VPNV4-IAA" 
 
This topology is used to test inter-AS option A. 
 
A.8.1. LOGICAL TOPOLOGY 
 
         +-----+   +-------+   +-------+   +-----+ 
+----+   |     |   |       |   |       |   |     |   +----+ 
|ce11|---| pe1 |---| asbr1 |---| asbr2 |---| pe2 |---|ce21| 
+----+   |     |   |       |   |       |   |     |   +----+ 
         +-----+   +-------+   +-------+   +-----+ 
 
<---->   <----------------->   <----------------->   <----> 
 AS100    AS200                 AS300                 AS400    
 
Asbr1 is the default logical router on physical router "dommelsch". It 
is the device under test. 
 
Ce11, pe1, asbr2, pe2, and ce21 are logical routers on physical router 
"fosters". 
 
Ce11 and ce21 use BGP as the PE-CE protocol. 
 
Asbr1 and asbr2 run inter-AS option A with BGP as the VRF-VRF protocol. 
 
A.8.2. CONFIGURATION FOR DOMMELSCH 
 
chassis { 
    redundancy { 
        graceful-switchover { 
            enable; 
        } 
    } 
} 
routing-options { 
    nonstop-routing; 
    router-id 99.99.99.3; 
    autonomous-system 200; 
} 
interfaces { 
    lo0 { 
        unit 0 { 
            family inet { 
                address 99.99.99.3/32; 
            } 
        } 
    } 
    fe-0/3/2 { 
        vlan-tagging; 
        unit 23 { 
            vlan-id 23; 
            family inet { 
                address 23.23.23.3/24; 
            } 
            family mpls; 
        } 
        unit 34 { 
            vlan-id 34; 
            family inet { 
                address 34.34.34.3/24; 
            } 
        } 
    } 
} 
protocols { 
    ospf { 
        area 0 { 
            interface lo0.0; 
            interface fe-0/3/2.23; 
        } 
    } 
    mpls { 
        interface fe-0/3/2.23; 
    } 
    ldp { 
        interface fe-0/3/2.23; 
    } 
    bgp { 
        group int { 
            type internal; 
            local-address 99.99.99.3; 
            family inet-vpn { 
                unicast; 
            } 
            neighbor 99.99.99.2; 
        } 
    } 
} 
routing-instances { 
    vrf-asbr1 { 
        instance-type vrf; 
        route-distinguisher 100:3; 
        vrf-target target:100:1; 
        interface fe-0/3/2.34; 
        routing-options { 
            router-id 99.99.99.21; 
        } 
        protocols { 
            bgp { 
                group ext { 
                    type external; 
                    neighbor 34.34.34.4 { 
                        peer-as 300; 
                    } 
                } 
            } 
        } 
    } 
} 

A.8.3. CONFIGURATION FOR FOSTERS 
 
interfaces { 
    fe-0/0/0 { 
        vlan-tagging; 
    } 
    fe-0/0/1 { 
        vlan-tagging; 
    } 
    fe-0/0/2 { 
        vlan-tagging; 
    } 
} 
logical-routers { 
    ce11 { 
        routing-options { 
            router-id 99.99.99.1; 
            autonomous-system 100; 
        } 
        policy-options { 
            policy-statement loopback { 
                from route-filter 99.99.99.1/32 exact; 
                then accept; 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 1 { 
                    family inet { 
                        address 99.99.99.1/32; 
                    } 
                } 
            } 
            fe-0/0/0 { 
                unit 12 { 
                    vlan-tag 12; 
                    family inet { 
                        address 12.12.12.1/24; 
                    } 
                } 
            } 
        } 
        protocols { 
            bgp { 
                group ext { 
                    type external; 
                    export loopback; 
                    neighbor 12.12.12.2 { 
                        peer-as 200; 
                    } 
                } 
            } 
        } 
    } 
    pe1 { 
        routing-options { 
            router-id 99.99.99.2; 
            autonomous-system 200; 
        } 
        interfaces { 
            lo0 { 
                unit 2 { 
                    family inet { 
                        address 99.99.99.2/32; 
                    } 
                } 
            } 
            fe-0/0/1 { 
                unit 12 { 
                    vlan-tag 12; 
                    family inet { 
                        address 12.12.12.2/24; 
                    } 
                } 
            } 
            fe-0/0/2 { 
                unit 23 { 
                    vlan-tag 23; 
                    family inet { 
                        address 23.23.23.2/24; 
                    } 
                    family mpls; 
                } 
            } 
        } 
        protocols { 
            ospf { 
                area 0 { 
                    interface lo0.2; 
                    interface fe-0/0/2.23; 
                } 
            } 
            mpls { 
               interface fe-0/0/2.23; 
            } 
            ldp { 
               interface fe-0/0/2.23; 
            } 
            bgp { 
                group int { 
                    type internal; 
                    local-address 99.99.99.2; 
                    family inet-vpn { 
                        unicast; 
                    } 
                    neighbor 99.99.99.3; 
                } 
            } 
        } 
        routing-instances { 
            vrf-pe1 { 
                instance-type vrf; 
                route-distinguisher 100:2; 
                vrf-target target:100:1; 
                interface fe-0/0/1.12; 
                protocols { 
                    bgp { 
                        group ext { 
                            type external; 
                            neighbor 12.12.12.1 { 
                                peer-as 100; 
                            } 
                        } 
                    } 
                } 
            } 
        } 
    } 
    asbr2 { 
        routing-options { 
            router-id 99.99.99.4; 
            autonomous-system 300; 
        } 
        interfaces { 
            lo0 { 
                unit 4 { 
                    family inet { 
                        address 99.99.99.4/32; 
                    } 
                } 
            } 
            fe-0/0/2 { 
                unit 34 { 
                    vlan-tag 34; 
                    family inet { 
                        address 34.34.34.4/24; 
                    } 
                } 
            } 
            fe-0/0/0 { 
                unit 45 { 
                    vlan-tag 45; 
                    family inet { 
                        address 45.45.45.4/24; 
                    } 
                    family mpls; 
                } 
            } 
        } 
        protocols { 
            ospf { 
                area 0 { 
                    interface lo0.4; 
                    interface fe-0/0/0.45; 
                } 
            } 
            mpls { 
               interface fe-0/0/0.45; 
            } 
            ldp { 
               interface fe-0/0/0.45; 
            } 
            bgp { 
                group int { 
                    type internal; 
                    local-address 99.99.99.4; 
                    family inet-vpn { 
                        unicast; 
                    } 
                    neighbor 99.99.99.5; 
                } 
            } 
        } 
        routing-instances { 
            vrf-asbr2 { 
                instance-type vrf; 
                route-distinguisher 100:4; 
                vrf-target target:100:1; 
                interface fe-0/0/2.34; 
                protocols { 
                    bgp { 
                        group ext { 
                            type external; 
                            neighbor 34.34.34.3 { 
                                peer-as 200; 
                            } 
                        } 
                    } 
                } 
            } 
        } 
    } 
    pe2 { 
        routing-options { 
            router-id 99.99.99.5; 
            autonomous-system 300; 
        } 
        interfaces { 
            lo0 { 
                unit 5 { 
                    family inet { 
                        address 99.99.99.5/32; 
                    } 
                } 
            } 
            fe-0/0/1 { 
                unit 45 { 
                    vlan-tag 45; 
                    family inet { 
                        address 45.45.45.5/24; 
                    } 
                    family mpls; 
                } 
            } 
            fe-0/0/0 { 
                unit 56 { 
                    vlan-tag 56; 
                    family inet { 
                        address 56.56.56.5/24; 
                    } 
                } 
            } 
        } 
        protocols { 
            ospf { 
                area 0 { 
                    interface lo0.5; 
                    interface fe-0/0/1.45; 
                } 
            } 
            mpls { 
               interface fe-0/0/1.45; 
            } 
            ldp { 
               interface fe-0/0/1.45; 
            } 
            bgp { 
                group int { 
                    type internal; 
                    local-address 99.99.99.5; 
                    family inet-vpn { 
                        unicast; 
                    } 
                    neighbor 99.99.99.4; 
                } 
            } 
        } 
        routing-instances { 
            vrf-pe2 { 
                instance-type vrf; 
                route-distinguisher 100:5; 
                vrf-target target:100:1; 
                interface fe-0/0/0.56; 
                protocols { 
                    bgp { 
                        group ext { 
                            type external; 
                            neighbor 56.56.56.6 { 
                                peer-as 400; 
                            } 
                        } 
                    } 
                } 
            } 
        } 
    } 
    ce21 { 
        routing-options { 
            router-id 99.99.99.6; 
            autonomous-system 400; 
        } 
        policy-options { 
            policy-statement loopback { 
                from route-filter 99.99.99.6/32 exact; 
                then accept; 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 6 { 
                    family inet { 
                        address 99.99.99.6/32; 
                    } 
                } 
            } 
            fe-0/0/1 { 
                unit 56 { 
                    vlan-tag 56; 
                    family inet { 
                        address 56.56.56.6/24; 
                    } 
                } 
            } 
        } 
        protocols { 
            bgp { 
                group ext { 
                    type external; 
                    export loopback; 
                    neighbor 56.56.56.5 { 
                        peer-as 300; 
                    } 
                } 
            } 
        } 
    } 
} 
 
A.9. TOPOLOGY "LU4" 
 
This topology is used to test IPv4 labeled-unicast routes (ingress or 
egress but not transit). 
 
A.9.1. LOGICAL TOPOLOGY 
 
 AS100              AS200              AS300              AS400 
+------+           +------+           +------+           +------+ 
|  r1  |-----------|  r2  |-----------|  r3  |-----------|  r4  | 
+------+           +------+           +------+           +------+ 
         IPv4 EBGP          IPv4 EBGP          IPv4 EBGP 
         unlabeled          labeled            unlabeled     
         unicast            unicast            unicast 
 
R2 is the default logical router on physical router "dommelsch". It is 
the device under test. 
 
R1, r3, and r4 are logical routers on physical router "fosters". 
 
IPv4 EBGP is used to signal a single-hop LSP from r2 to r3. When IPv4 
traffic is sent from R1 to R4, it is unlabeled on the r1-r2 link, 
labeled on the r2-r3 link, and unlabeled on the r3-r4 link. Thus, r2 is 
the LSP ingress router, r3 is the LSP egress router, and there is no 
LSP transit router. 
 
A.9.2. CONFIGURATION FOR DOMMELSCH 
 
chassis { 
    redundancy { 
        graceful-switchover { 
            enable; 
        } 
    } 
} 
routing-options { 
    nonstop-routing; 
    router-id 99.99.99.2; 
    autonomous-system 200; 
} 
interfaces { 
    lo0 { 
        unit 0 { 
            family inet { 
                address 99.99.99.2/32; 
            } 
        } 
    } 
    fe-0/3/2 { 
        vlan-tagging; 
        unit 12 { 
            vlan-id 12; 
            family inet { 
                address 12.12.12.2/24; 
            } 
        } 
        unit 23 { 
            vlan-id 23; 
            family inet { 
                address 23.23.23.2/24; 
            } 
            family mpls; 
        } 
    } 
} 
protocols { 
    mpls { 
        interface fe-0/3/2.23; 
    } 
    bgp { 
        group unlabeled { 
            type external; 
            family inet { 
                unicast; 
            } 
            neighbor 12.12.12.1 { 
                peer-as 100; 
            } 
        } 
        group labeled { 
            type external; 
            family inet { 
                labeled-unicast; 
            } 
            neighbor 23.23.23.3 { 
                peer-as 300; 
            } 
        } 
    } 
} 
 
A.9.3. CONFIGURATION FOR FOSTERS 
 
interfaces { 
    fe-0/0/0 { 
        vlan-tagging; 
    } 
    fe-0/0/1 { 
        vlan-tagging; 
    } 
    fe-0/0/2 { 
        vlan-tagging; 
    } 
} 
logical-routers { 
    r1 { 
        routing-options { 
            router-id 99.99.99.1; 
            autonomous-system 100; 
        } 
        policy-options { 
            policy-statement loopback { 
                from route-filter 99.99.99.1/32 exact; 
                then accept; 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 1 { 
                    family inet { 
                        address 99.99.99.1/32; 
                    } 
                } 
            } 
            fe-0/0/2 { 
                unit 12 { 
                    vlan-tag 12; 
                    family inet { 
                        address 12.12.12.1/24; 
                    } 
                } 
            } 
        } 
        protocols { 
            bgp { 
                group unlabeled { 
                    export loopback; 
                    type external; 
                    family inet { 
                        unicast; 
                    } 
                    neighbor 12.12.12.2 { 
                        peer-as 200 
                    }; 
                } 
            } 
        } 
    } 
    r3 { 
        routing-options { 
            router-id 99.99.99.3; 
            autonomous-system 300; 
        } 
        interfaces { 
            lo0 { 
                unit 3 { 
                    family inet { 
                        address 99.99.99.3/32; 
                    } 
                } 
            } 
            fe-0/0/2 { 
                unit 23 { 
                    vlan-tag 23; 
                    family inet { 
                        address 23.23.23.3/24; 
                    } 
                    family mpls; 
                } 
            } 
            fe-0/0/0 { 
                unit 34 { 
                    vlan-tag 34; 
                    family inet { 
                        address 34.34.34.3/24; 
                    } 
                } 
            } 
        } 
        protocols { 
            mpls { 
               interface fe-0/0/2.23; 
            } 
            bgp { 
                group labeled { 
                    type external; 
                    family inet { 
                        labeled-unicast; 
                    } 
                    neighbor 23.23.23.2 { 
                        peer-as 200 
                    }; 
                } 
                group unlabeled { 
                    type external; 
                    family inet { 
                        unicast; 
                    } 
                    neighbor 34.34.34.4 { 
                        peer-as 400 
                    }; 
                } 
            } 
        } 
    } 
    r4 { 
        routing-options { 
            router-id 99.99.99.4; 
            autonomous-system 400; 
        } 
        policy-options { 
            policy-statement loopback { 
                from route-filter 99.99.99.4/32 exact; 
                then accept; 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 4 { 
                    family inet { 
                        address 99.99.99.4/32; 
                    } 
                } 
            } 
            fe-0/0/1 { 
                unit 34 { 
                    vlan-tag 34; 
                    family inet { 
                        address 34.34.34.4/24; 
                    } 
                    family mpls; 
                } 
            } 
        } 
        protocols { 
            bgp { 
                group unlabeled { 
                    export loopback; 
                    type external; 
                    family inet { 
                        unicast; 
                    } 
                    neighbor 34.34.34.3 { 
                        peer-as 300 
                    }; 
                } 
            } 
        } 
    } 
} 
 
A.10. TOPOLOGY "LU6" 
 
This topology is used to test IPv6 labeled-unicast routes (ingress or 
egress but not transit). 
 
A.10.1. LOGICAL TOPOLOGY 
 
 AS100              AS200              AS300              AS400 
+------+           +------+           +------+           +------+ 
|  r1  |-----------|  r2  |-----------|  r3  |-----------|  r4  | 
+------+           +------+           +------+           +------+ 
         IPv6 EBGP          IPv6 EBGP          IPv6 EBGP 
         unlabeled          labeled            unlabeled     
         unicast            unicast            unicast 
 
R2 is the default logical router on physical router "dommelsch". It is 
the device under test. 
 
R1 and r4 are logical routers on physical router "fosters". R3 is the 
default logical router on physical router "fosters" - this is needed 
because explicit-null is mandatory labeled-unicast for IPv6. 
 
IPv6 EBGP is used to signal a single-hop LSP from r2 to r3. When IPv6 
traffic is sent from R1 to R4, it is unlabeled on the r1-r2 link, 
labeled on the r2-r3 link, and unlabeled on the r3-r4 link. Thus, r2 is 
the LSP ingress router, r3 is the LSP egress router, and there is no 
LSP transit router. 
 
A.10.2. CONFIGURATION FOR DOMMELSCH 
 
chassis { 
    redundancy { 
        graceful-switchover { 
            enable; 
        } 
    } 
} 
routing-options { 
    nonstop-routing; 
    router-id 99.99.99.2; 
    autonomous-system 200; 
} 
interfaces { 
    lo0 { 
        unit 0 { 
            family inet6 { 
                address ::99:99:99:2/128; 
            } 
        } 
    } 
    fe-0/3/2 { 
        vlan-tagging; 
        unit 12 { 
            vlan-id 12; 
            family inet6 { 
                address ::12:12:12:2/120; 
            } 
        } 
        unit 23 { 
            vlan-id 23; 
            family inet6 { 
                address ::23:23:23:2/120; 
            } 
            family mpls; 
        } 
    } 
} 
protocols { 
    mpls { 
        interface fe-0/3/2.23; 
    } 
    bgp { 
        group unlabeled { 
            type external; 
            family inet6 { 
                unicast; 
            } 
            neighbor ::12:12:12:1 { 
                peer-as 100; 
            } 
        } 
        group labeled { 
            type external; 
            family inet6 { 
                labeled-unicast explicit-null; 
            } 
            neighbor ::23:23:23:3 { 
                peer-as 300; 
            } 
        } 
    } 
} 
 
A.10.3. CONFIGURATION FOR FOSTERS 
 
interfaces { 
    fe-0/0/0 { 
        vlan-tagging; 
    } 
    fe-0/0/1 { 
        vlan-tagging; 
    } 
    fe-0/0/2 { 
        vlan-tagging; 
    } 
} 
routing-options { 
    router-id 99.99.99.3; 
    autonomous-system 300; 
} 
interfaces { 
    lo0 { 
        unit 0 { 
            family inet6 { 
                address ::99:99:99:3/128; 
            } 
        } 
    } 
    fe-0/0/2 { 
        unit 23 { 
            vlan-tag 23; 
            family inet6 { 
                address ::23:23:23:3/120; 
            } 
            family mpls; 
        } 
    } 
    fe-0/0/0 { 
        unit 34 { 
            vlan-tag 34; 
            family inet6 { 
                address ::34:34:34:3/120; 
            } 
        } 
    } 
} 
protocols { 
    mpls { 
       interface fe-0/0/2.23; 
    } 
    bgp { 
        group labeled { 
            type external; 
            family inet6 { 
                labeled-unicast explicit-null; 
            } 
            neighbor ::23:23:23:2 { 
                peer-as 200 
            }; 
        } 
        group unlabeled { 
            type external; 
            family inet6 { 
                unicast; 
            } 
            neighbor ::34:34:34:4 { 
                peer-as 400 
            }; 
        } 
    } 
} 
logical-routers { 
    r1 { 
        routing-options { 
            router-id 99.99.99.1; 
            autonomous-system 100; 
        } 
        policy-options { 
            policy-statement loopback { 
                from route-filter ::99:99:99:1/128 exact; 
                then accept; 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 1 { 
                    family inet6 { 
                        address ::99:99:99:1/128; 
                    } 
                } 
            } 
            fe-0/0/2 { 
                unit 12 { 
                    vlan-tag 12; 
                    family inet6 { 
                        address ::12:12:12:1/120; 
                    } 
                } 
            } 
        } 
        protocols { 
            bgp { 
                group unlabeled { 
                    export loopback; 
                    type external; 
                    family inet6 { 
                        unicast; 
                    } 
                    neighbor ::12:12:12:2 { 
                        peer-as 200 
                    }; 
                } 
            } 
        } 
    } 
    r4 { 
        routing-options { 
            router-id 99.99.99.4; 
            autonomous-system 400; 
        } 
        policy-options { 
            policy-statement loopback { 
                from route-filter ::99:99:99:4/128 exact; 
                then accept; 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 4 { 
                    family inet6 { 
                        address ::99:99:99:4/128; 
                    } 
                } 
            } 
            fe-0/0/1 { 
                unit 34 { 
                    vlan-tag 34; 
                    family inet6 { 
                        address ::34:34:34:4/120; 
                    } 
                    family mpls; 
                } 
            } 
        } 
        protocols { 
            bgp { 
                group unlabeled { 
                    export loopback; 
                    type external; 
                    family inet6 { 
                        unicast; 
                    } 
                    neighbor ::34:34:34:3 { 
                        peer-as 300 
                    }; 
                } 
            } 
        } 
    } 
} 
 
A.11. TOPOLOGY "MULTI-CE" 
 
This topology is used to test multiple CEs per VRF (so that we have VPN 
routes with different values in a given VRF). Also, this topology has a 
non-trivial number or routes per CE. 
  
A.11.1. LOGICAL TOPOLOGY 
 
               pe1                pe2 
              +------+           +------+ 
+----+ EBGP   |..... |           | .....| EBGP   +----+ 
|ce11|--------|    . |           | .    |--------|ce21| 
+----+        |    . |           | .    |        +----+ 
AS65011       |    . |           | .    |       AS65021 
              |    . |           | .    | 
+----+ EBGP   |    . |   +---+   | .    | EBGP   +----+ 
|ce12|--------|pe11. |---| p |---| .pe21|--------|ce22| 
+----+        |    . |   +---+   | .    |        +----+ 
AS65012       |    . |           | .    |       AS65022 
              |    . |           | .    | 
+----+ EBGP   |    . |           | .    | EBGP   +----+ 
|ce13|--------|    . |           | .    |--------|ce23| 
+----+        |..... |           | .....|        +----+ 
AS65013       +------+           +------+       AS65023 
 
      <------>        <--------->        <------> 
       IPv4            IPv4              IPv4 
 
Pe1 is the default logical router on physical router "dommelsch". It is 
the device under test. 
 
Ce11, ce12, ce13, p, pe2, ce21, ce22, and ce23 are logical routers on 
physical router "fosters". 
 
All CEs use EBGP as the PE-CE protocol and has a unique AS number. All 
3 CEs connected to a given PE are in the same VPN, i.e. they connected 
to the same VRF. Each CE advertises 11 routes over its EBGP session. 
 
A.11.2. CONFIGURATION FOR DOMMELSCH 
 
chassis { 
    redundancy { 
        graceful-switchover { 
            enable; 
        } 
    } 
} 
routing-options { 
    nonstop-routing; 
    router-id 99.99.99.4; 
    autonomous-system 100; 
} 
interfaces { 
    lo0 { 
        unit 0 { 
            family inet { 
                address 99.99.99.4/32; 
            } 
        } 
    } 
    fe-0/3/2 { 
        vlan-tagging; 
        unit 14 { 
            vlan-id 14; 
            family inet { 
                address 14.14.14.4/24; 
            } 
        } 
        unit 24 { 
            vlan-id 24; 
            family inet { 
                address 24.24.24.4/24; 
            } 
        } 
        unit 34 { 
            vlan-id 34; 
            family inet { 
                address 34.34.34.4/24; 
            } 
        } 
        unit 45 { 
            vlan-id 45; 
            family inet { 
                address 45.45.45.4/24; 
            } 
            family mpls; 
        } 
    } 
} 
protocols { 
    ospf { 
        area 0 { 
            interface lo0.0; 
            interface fe-0/3/2.45; 
        } 
    } 
    mpls { 
        interface fe-0/3/2.45; 
    } 
    ldp { 
        interface fe-0/3/2.45; 
    } 
    bgp { 
        group int { 
            type internal; 
            local-address 99.99.99.4; 
            family inet-vpn { 
                unicast; 
            } 
            neighbor 99.99.99.6; 
        } 
    } 
} 
routing-instances { 
    pe11 { 
        instance-type vrf; 
        route-distinguisher 100:11; 
        vrf-target target:100:1; 
        interface fe-0/3/2.14; 
        interface fe-0/3/2.24; 
        interface fe-0/3/2.34; 
        protocols { 
            bgp { 
                group ext { 
                    type external; 
                    neighbor 14.14.14.1 { 
                        peer-as 65011; 
                    } 
                    neighbor 24.24.24.2 { 
                        peer-as 65012; 
                    } 
                    neighbor 34.34.34.3 { 
                        peer-as 65013; 
                    } 
                } 
            } 
        } 
    } 
} 
 
A.11.3. CONFIGURATION FOR FOSTERS 
 
interfaces { 
    fe-0/0/0 { 
        vlan-tagging; 
    } 
    fe-0/0/1 { 
        vlan-tagging; 
    } 
    fe-0/0/2 { 
        vlan-tagging; 
    } 
} 
logical-routers { 
    ce11 { 
        routing-options { 
            router-id 99.99.99.1; 
            autonomous-system 65011; 
            static { 
                route 88.88.11.1/32 receive; 
                route 88.88.11.2/32 receive; 
                route 88.88.11.3/32 receive; 
                route 88.88.11.4/32 receive; 
                route 88.88.11.5/32 receive; 
                route 88.88.11.6/32 receive; 
                route 88.88.11.7/32 receive; 
                route 88.88.11.8/32 receive; 
                route 88.88.11.9/32 receive; 
                route 88.88.11.10/32 receive; 
            } 
        } 
        policy-options { 
            policy-statement loopback { 
                from route-filter 99.99.99.1/32 exact; 
                then accept; 
            } 
            policy-statement statics { 
                from protocol static; 
                then accept; 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 1 { 
                    family inet { 
                        address 99.99.99.1/32; 
                    } 
                } 
            } 
            fe-0/0/2 { 
                unit 14 { 
                    vlan-tag 14; 
                    family inet { 
                        address 14.14.14.1/24; 
                    } 
                } 
            } 
        } 
        protocols { 
            bgp { 
                group ext { 
                    type external; 
                    export [ loopback statics ]; 
                    neighbor 14.14.14.4 { 
                        peer-as 100; 
                    } 
                } 
            } 
        } 
    } 
    ce12 { 
        routing-options { 
            router-id 99.99.99.2; 
            autonomous-system 65012; 
            static { 
                route 88.88.12.1/32 receive; 
                route 88.88.12.2/32 receive; 
                route 88.88.12.3/32 receive; 
                route 88.88.12.4/32 receive; 
                route 88.88.12.5/32 receive; 
                route 88.88.12.6/32 receive; 
                route 88.88.12.7/32 receive; 
                route 88.88.12.8/32 receive; 
                route 88.88.12.9/32 receive; 
                route 88.88.12.10/32 receive; 
            } 
        } 
        policy-options { 
            policy-statement loopback { 
                from route-filter 99.99.99.2/32 exact; 
                then accept; 
            } 
            policy-statement statics { 
                from protocol static; 
                then accept; 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 2 { 
                    family inet { 
                        address 99.99.99.2/32; 
                    } 
                } 
            } 
            fe-0/0/2 { 
                unit 24 { 
                    vlan-tag 24; 
                    family inet { 
                        address 24.24.24.2/24; 
                    } 
                } 
            } 
        } 
        protocols { 
            bgp { 
                group ext { 
                    type external; 
                    export [ loopback statics ]; 
                    neighbor 24.24.24.4 { 
                        peer-as 100; 
                    } 
                } 
            } 
        } 
    } 
    ce13 { 
        routing-options { 
            router-id 99.99.99.3; 
            autonomous-system 65013; 
            static { 
                route 88.88.13.1/32 receive; 
                route 88.88.13.2/32 receive; 
                route 88.88.13.3/32 receive; 
                route 88.88.13.4/32 receive; 
                route 88.88.13.5/32 receive; 
                route 88.88.13.6/32 receive; 
                route 88.88.13.7/32 receive; 
                route 88.88.13.8/32 receive; 
                route 88.88.13.9/32 receive; 
                route 88.88.13.10/32 receive; 
            } 
        } 
        policy-options { 
            policy-statement loopback { 
                from route-filter 99.99.99.3/32 exact; 
                then accept; 
            } 
            policy-statement statics { 
                from protocol static; 
                then accept; 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 3 { 
                    family inet { 
                        address 99.99.99.3/32; 
                    } 
                } 
            } 
            fe-0/0/2 { 
                unit 34 { 
                    vlan-tag 34; 
                    family inet { 
                        address 34.34.34.3/24; 
                    } 
                } 
            } 
        } 
        protocols { 
            bgp { 
                group ext { 
                    type external; 
                    export [ loopback statics ]; 
                    neighbor 34.34.34.4 { 
                        peer-as 100; 
                    } 
                } 
            } 
        } 
    } 
    p { 
        routing-options { 
            router-id 99.99.99.5; 
        } 
        interfaces { 
            lo0 { 
                unit 5 { 
                    family inet { 
                        address 99.99.99.5/32; 
                    } 
                } 
            } 
            fe-0/0/2 { 
                unit 45 { 
                    vlan-tag 45; 
                    family inet { 
                        address 45.45.45.5/24; 
                    } 
                    family mpls; 
                } 
            } 
            fe-0/0/0 { 
                unit 56 { 
                    vlan-tag 56; 
                    family inet { 
                        address 56.56.56.5/24; 
                    } 
                    family mpls; 
                } 
            } 
        } 
        protocols { 
            ospf { 
                area 0 { 
                    interface lo0.5; 
                    interface fe-0/0/2.45; 
                    interface fe-0/0/0.56; 
                } 
            } 
            mpls { 
               interface fe-0/0/2.45; 
               interface fe-0/0/0.56; 
            } 
            ldp { 
               interface fe-0/0/2.45; 
               interface fe-0/0/0.56; 
            } 
        } 
    } 
    pe2 { 
        routing-options { 
            router-id 99.99.99.6; 
            autonomous-system 100; 
        } 
        policy-options { 
            policy-statement bgp-routes {  
                from protocol bgp; 
                then accept; 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 6 { 
                    family inet { 
                        address 99.99.99.6/32; 
                    } 
                } 
            } 
            fe-0/0/1 { 
                unit 56 { 
                    vlan-tag 56; 
                    family inet { 
                        address 56.56.56.6/24; 
                    } 
                    family mpls; 
                } 
            } 
            fe-0/0/0 { 
                unit 67 { 
                    vlan-tag 67; 
                    family inet { 
                        address 67.67.67.6/24; 
                    } 
                } 
            } 
            fe-0/0/0 { 
                unit 68 { 
                    vlan-tag 68; 
                    family inet { 
                        address 68.68.68.6/24; 
                    } 
                } 
            } 
            fe-0/0/0 { 
                unit 69 { 
                    vlan-tag 69; 
                    family inet { 
                        address 69.69.69.6/24; 
                    } 
                } 
            } 
        } 
        protocols { 
            ospf { 
                area 0 { 
                    interface lo0.6; 
                    interface fe-0/0/1.56; 
                } 
            } 
            mpls { 
               interface fe-0/0/1.56; 
            } 
            ldp { 
               interface fe-0/0/1.56; 
            } 
            bgp { 
                group int { 
                    type internal; 
                    local-address 99.99.99.6; 
                    family inet-vpn { 
                        unicast; 
                    } 
                    neighbor 99.99.99.4; 
                } 
            } 
        } 
        routing-instances { 
            pe21 { 
                instance-type vrf; 
                route-distinguisher 100:21; 
                vrf-target target:100:1; 
                interface fe-0/0/0.67; 
                interface fe-0/0/0.68; 
                interface fe-0/0/0.69; 
                protocols { 
                    bgp { 
                        group ext { 
                            type external; 
                            neighbor 67.67.67.7 { 
                                peer-as 65021; 
                            } 
                            neighbor 68.68.68.8 { 
                                peer-as 65022; 
                            } 
                            neighbor 69.69.69.9 { 
                                peer-as 65023; 
                            } 
                        } 
                    } 
                } 
            } 
        } 
    } 
    ce21 { 
        routing-options { 
            router-id 99.99.99.7; 
            autonomous-system 65021; 
            static { 
                route 88.88.21.1/32 receive; 
                route 88.88.21.2/32 receive; 
                route 88.88.21.3/32 receive; 
                route 88.88.21.4/32 receive; 
                route 88.88.21.5/32 receive; 
                route 88.88.21.6/32 receive; 
                route 88.88.21.7/32 receive; 
                route 88.88.21.8/32 receive; 
                route 88.88.21.9/32 receive; 
                route 88.88.21.10/32 receive; 
            } 
        } 
        policy-options { 
            policy-statement loopback { 
                from route-filter 99.99.99.7/32 exact; 
                then accept; 
            } 
            policy-statement statics { 
                from protocol static; 
                then accept; 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 7 { 
                    family inet { 
                        address 99.99.99.7/32; 
                    } 
                } 
            } 
            fe-0/0/1 { 
                unit 67 { 
                    vlan-tag 67; 
                    family inet { 
                        address 67.67.67.7/24; 
                    } 
                } 
            } 
        } 
        protocols { 
            bgp { 
                group ext { 
                    type external; 
                    export [ loopback statics ]; 
                    neighbor 67.67.67.6 { 
                        peer-as 100; 
                    } 
                } 
            } 
        } 
    } 
    ce22 { 
        routing-options { 
            router-id 99.99.99.8; 
            autonomous-system 65022; 
            static { 
                route 88.88.22.1/32 receive; 
                route 88.88.22.2/32 receive; 
                route 88.88.22.3/32 receive; 
                route 88.88.22.4/32 receive; 
                route 88.88.22.5/32 receive; 
                route 88.88.22.6/32 receive; 
                route 88.88.22.7/32 receive; 
                route 88.88.22.8/32 receive; 
                route 88.88.22.9/32 receive; 
                route 88.88.22.10/32 receive; 
            } 
        } 
        policy-options { 
            policy-statement loopback { 
                from route-filter 99.99.99.8/32 exact; 
                then accept; 
            } 
            policy-statement statics { 
                from protocol static; 
                then accept; 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 8 { 
                    family inet { 
                        address 99.99.99.8/32; 
                    } 
                } 
            } 
            fe-0/0/1 { 
                unit 68 { 
                    vlan-tag 68; 
                    family inet { 
                        address 68.68.68.8/24; 
                    } 
                } 
            } 
        } 
        protocols { 
            bgp { 
                group ext { 
                    type external; 
                    export [ loopback statics ]; 
                    neighbor 68.68.68.6 { 
                        peer-as 100; 
                    } 
                } 
            } 
        } 
    } 
    ce23 { 
        routing-options { 
            router-id 99.99.99.9; 
            autonomous-system 65023; 
            static { 
                route 88.88.23.1/32 receive; 
                route 88.88.23.2/32 receive; 
                route 88.88.23.3/32 receive; 
                route 88.88.23.4/32 receive; 
                route 88.88.23.5/32 receive; 
                route 88.88.23.6/32 receive; 
                route 88.88.23.7/32 receive; 
                route 88.88.23.8/32 receive; 
                route 88.88.23.9/32 receive; 
                route 88.88.23.10/32 receive; 
            } 
        } 
        policy-options { 
            policy-statement loopback { 
                from route-filter 99.99.99.9/32 exact; 
                then accept; 
            } 
            policy-statement statics { 
                from protocol static; 
                then accept; 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 9 { 
                    family inet { 
                        address 99.99.99.9/32; 
                    } 
                } 
            } 
            fe-0/0/1 { 
                unit 69 { 
                    vlan-tag 69; 
                    family inet { 
                        address 69.69.69.9/24; 
                    } 
                } 
            } 
        } 
        protocols { 
            bgp { 
                group ext { 
                    type external; 
                    export [ loopback statics ]; 
                    neighbor 69.69.69.6 { 
                        peer-as 100 
                    } 
                } 
            } 
        } 
    } 
} 
 
A.12. TOPOLOGY "MULTI-PATH" 
 
This topology is used to test multipath. 
  
A.12.1. LOGICAL TOPOLOGY 
                                       pe5 
                                      +-----+ 
                          +--+        | ....| 
                       ---|p3|--------| .vrf| 
            pe2       /   +--+     ---| ....|- 
           +------+  /     |  \   /   +-----+ \ 
 +---+     |....  |--      |   \ /             \+---+ 
 |ce1|-----|vrf.  |        |    \               |ce7| 
 +---+     |....  |--      |   / \             /+---+ 
           +------+  \     |  /   \   +-----+ / 
                      \   +--+     ---| ....|- 
                       ---|p4|--------| .vrf| 
                          +--+        | ....| 
                                      +-----+ 
                                       pe6 
 
Pe2 is the default logical router on physical router "dommelsch". It is 
the device under test. 
 
Ce1, p3, p4, pe5, pe6, and ce7 are logical routers on physical router 
"fosters". 
 
Both CEs use EBGP as the PE-CE protocol and has a unique AS number.  
 
The topology has been designed to exercise multipath in two different 
ways: 
 
1) Pe2 has two equal-cost BGP VPN routes to ce7: one received from pe5 
and one received from pe6. Multipath is enabled on all three pe 
routers. 
 
2) The next-hop of each BGP route is resolved by an ECMP route with two 
legs. For example, router pe2 has an ECMP route to pe5 (pe2->p3->pe5 
and pe2->p4->pe5). 
 
A.12.2. CONFIGURATION FOR DOMMELSCH 
 
chassis { 
    redundancy { 
        graceful-switchover { 
            enable; 
        } 
    } 
} 
routing-options { 
    nonstop-routing; 
    router-id 99.99.99.2; 
    autonomous-system 100; 
} 
interfaces { 
    lo0 { 
        unit 0 { 
            family inet { 
                address 99.99.99.2/32; 
            } 
        } 
    } 
    fe-0/3/2 { 
        vlan-tagging; 
        unit 12 { 
            vlan-id 12; 
            family inet { 
                address 12.12.12.2/24; 
            } 
        } 
        unit 23 { 
            vlan-id 23; 
            family inet { 
                address 23.23.23.2/24; 
            } 
            family mpls; 
        } 
        unit 24 { 
            vlan-id 24; 
            family inet { 
                address 24.24.24.2/24; 
            } 
            family mpls; 
        } 
    } 
} 
protocols { 
    ospf { 
        area 0 { 
            interface lo0.0; 
            interface fe-0/3/2.23; 
            interface fe-0/3/2.24; 
        } 
    } 
    mpls { 
        interface fe-0/3/2.23; 
        interface fe-0/3/2.24; 
    } 
    ldp { 
        interface fe-0/3/2.23; 
        interface fe-0/3/2.24; 
    } 
    bgp { 
        group int { 
            type internal; 
            local-address 99.99.99.2; 
            family inet-vpn { 
                unicast; 
            } 
            neighbor 99.99.99.5; 
            neighbor 99.99.99.6; 
        } 
    } 
} 
routing-instances { 
    vrf { 
        instance-type vrf; 
        route-distinguisher 100:11; 
        vrf-target target:100:1; 
        interface fe-0/3/2.12; 
        routing-options { 
            multipath; 
        } 
        protocols { 
            bgp { 
                group ext { 
                    type external; 
                    neighbor 12.12.12.1 { 
                        peer-as 65001; 
                    } 
                } 
            } 
        } 
    } 
} 
 
A.12.3. CONFIGURATION FOR FOSTERS 
 
interfaces { 
    fe-0/0/0 { 
        vlan-tagging; 
    } 
    fe-0/0/1 { 
        vlan-tagging; 
    } 
    fe-0/0/2 { 
        vlan-tagging; 
    } 
} 
logical-routers { 
    ce1 { 
        routing-options { 
            router-id 99.99.99.1; 
            autonomous-system 65001; 
        } 
        policy-options { 
            policy-statement loopback { 
                from route-filter 99.99.99.1/32 exact; 
                then accept; 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 1 { 
                    family inet { 
                        address 99.99.99.1/32; 
                    } 
                } 
            } 
            fe-0/0/2 { 
                unit 12 { 
                    vlan-tag 12; 
                    family inet { 
                        address 12.12.12.1/24; 
                    } 
                } 
            } 
        } 
        protocols { 
            bgp { 
                group ext { 
                    type external; 
                    export loopback; 
                    neighbor 12.12.12.2 { 
                        peer-as 100; 
                    } 
                } 
            } 
        } 
    } 
    p3 { 
        routing-options { 
            router-id 99.99.99.3; 
        } 
        interfaces { 
            lo0 { 
                unit 3 { 
                    family inet { 
                        address 99.99.99.3/32; 
                    } 
                } 
            } 
            fe-0/0/2 { 
                unit 23 { 
                    vlan-tag 23; 
                    family inet { 
                        address 23.23.23.3/24; 
                    } 
                    family mpls; 
                } 
            } 
            fe-0/0/0 { 
                unit 34 { 
                    vlan-tag 34; 
                    family inet { 
                        address 34.34.34.3/24; 
                    } 
                    family mpls; 
                } 
            } 
            fe-0/0/0 { 
                unit 35 { 
                    vlan-tag 35; 
                    family inet { 
                        address 35.35.35.3/24; 
                    } 
                    family mpls; 
                } 
            } 
            fe-0/0/0 { 
                unit 36 { 
                    vlan-tag 36; 
                    family inet { 
                        address 36.36.36.3/24; 
                    } 
                    family mpls; 
                } 
            } 
        } 
        protocols { 
            ospf { 
                area 0 { 
                    interface lo0.3; 
                    interface fe-0/0/2.23; 
                    interface fe-0/0/0.34; 
                    interface fe-0/0/0.35; 
                    interface fe-0/0/0.36; 
                } 
            } 
            mpls { 
               interface fe-0/0/2.23; 
               interface fe-0/0/0.34; 
               interface fe-0/0/0.35; 
               interface fe-0/0/0.36; 
            } 
            ldp { 
               interface fe-0/0/2.23; 
               interface fe-0/0/0.34; 
               interface fe-0/0/0.35; 
               interface fe-0/0/0.36; 
            } 
        } 
    } 
    p4 { 
        routing-options { 
            router-id 99.99.99.4; 
        } 
        interfaces { 
            lo0 { 
                unit 4 { 
                    family inet { 
                        address 99.99.99.4/32; 
                    } 
                } 
            } 
            fe-0/0/2 { 
                unit 24 { 
                    vlan-tag 24; 
                    family inet { 
                        address 24.24.24.4/24; 
                    } 
                    family mpls; 
                } 
            } 
            fe-0/0/1 { 
                unit 34 { 
                    vlan-tag 34; 
                    family inet { 
                        address 34.34.34.4/24; 
                    } 
                    family mpls; 
                } 
            } 
            fe-0/0/0 { 
                unit 45 { 
                    vlan-tag 45; 
                    family inet { 
                        address 45.45.45.4/24; 
                    } 
                    family mpls; 
                } 
            } 
            fe-0/0/0 { 
                unit 46 { 
                    vlan-tag 46; 
                    family inet { 
                        address 46.46.46.4/24; 
                    } 
                    family mpls; 
                } 
            } 
        } 
        protocols { 
            ospf { 
                area 0 { 
                    interface lo0.4; 
                    interface fe-0/0/2.24; 
                    interface fe-0/0/1.34; 
                    interface fe-0/0/0.45; 
                    interface fe-0/0/0.46; 
                } 
            } 
            mpls { 
               interface fe-0/0/2.24; 
               interface fe-0/0/1.34; 
               interface fe-0/0/0.45; 
               interface fe-0/0/0.46; 
            } 
            ldp { 
               interface fe-0/0/2.24; 
               interface fe-0/0/1.34; 
               interface fe-0/0/0.45; 
               interface fe-0/0/0.46; 
            } 
        } 
    } 
    pe5 { 
        routing-options { 
            router-id 99.99.99.5; 
            autonomous-system 100; 
        } 
        policy-options { 
            policy-statement bgp-routes {  
                from protocol bgp; 
                then accept; 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 5 { 
                    family inet { 
                        address 99.99.99.5/32; 
                    } 
                } 
            } 
            fe-0/0/1 { 
                unit 35 { 
                    vlan-tag 35; 
                    family inet { 
                        address 35.35.35.5/24; 
                    } 
                    family mpls; 
                } 
            } 
            fe-0/0/1 { 
                unit 45 { 
                    vlan-tag 45; 
                    family inet { 
                        address 45.45.45.5/24; 
                    } 
                } 
            } 
            fe-0/0/0 { 
                unit 57 { 
                    vlan-tag 57; 
                    family inet { 
                        address 57.57.57.5/24; 
                    } 
                } 
            } 
        } 
        protocols { 
            ospf { 
                area 0 { 
                    interface lo0.5; 
                    interface fe-0/0/1.35; 
                    interface fe-0/0/1.45; 
                } 
            } 
            mpls { 
               interface fe-0/0/1.35; 
               interface fe-0/0/1.45; 
            } 
            ldp { 
               interface fe-0/0/1.35; 
               interface fe-0/0/1.45; 
 
            } 
            bgp { 
                group int { 
                    type internal; 
                    local-address 99.99.99.5; 
                    family inet-vpn { 
                        unicast; 
                    } 
                    neighbor 99.99.99.2; 
                    neighbor 99.99.99.6; 
                } 
            } 
        } 
        routing-instances { 
            vrf { 
                instance-type vrf; 
                route-distinguisher 100:51; 
                vrf-target target:100:1; 
                interface fe-0/0/0.57; 
                routing-options { 
                    multipath; 
                } 
                protocols { 
                    bgp { 
                        group ext { 
                            type external; 
                            neighbor 57.57.57.7 { 
                                peer-as 65007; 
                            } 
                        } 
                    } 
                } 
            } 
        } 
    } 
    pe6 { 
        routing-options { 
            router-id 99.99.99.6; 
            autonomous-system 100; 
        } 
        policy-options { 
            policy-statement bgp-routes {  
                from protocol bgp; 
                then accept; 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 6 { 
                    family inet { 
                        address 99.99.99.6/32; 
                    } 
                } 
            } 
            fe-0/0/1 { 
                unit 36 { 
                    vlan-tag 36; 
                    family inet { 
                        address 36.36.36.6/24; 
                    } 
                    family mpls; 
                } 
            } 
            fe-0/0/1 { 
                unit 46 { 
                    vlan-tag 46; 
                    family inet { 
                        address 46.46.46.6/24; 
                    } 
                } 
            } 
            fe-0/0/0 { 
                unit 67 { 
                    vlan-tag 67; 
                    family inet { 
                        address 67.67.67.6/24; 
                    } 
                } 
            } 
        } 
        protocols { 
            ospf { 
                area 0 { 
                    interface lo0.6; 
                    interface fe-0/0/1.36; 
                    interface fe-0/0/1.46; 
                } 
            } 
            mpls { 
               interface fe-0/0/1.36; 
               interface fe-0/0/1.46; 
            } 
            ldp { 
               interface fe-0/0/1.36; 
               interface fe-0/0/1.46; 
 
            } 
            bgp { 
                group int { 
                    type internal; 
                    local-address 99.99.99.6; 
                    family inet-vpn { 
                        unicast; 
                    } 
                    neighbor 99.99.99.2; 
                    neighbor 99.99.99.5; 
                } 
            } 
        } 
        routing-instances { 
            vrf { 
                instance-type vrf; 
                route-distinguisher 100:61; 
                vrf-target target:100:1; 
                interface fe-0/0/0.67; 
                routing-options { 
                    multipath; 
                } 
                protocols { 
                    bgp { 
                        group ext { 
                            type external; 
                            neighbor 67.67.67.7 { 
                                peer-as 65007; 
                            } 
                        } 
                    } 
                } 
            } 
        } 
    } 
    ce7 { 
        routing-options { 
            router-id 99.99.99.7; 
            autonomous-system 65007; 
        } 
        policy-options { 
            policy-statement loopback { 
                from route-filter 99.99.99.7/32 exact; 
                then accept; 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 7 { 
                    family inet { 
                        address 99.99.99.7/32; 
                    } 
                } 
            } 
            fe-0/0/1 { 
                unit 57 { 
                    vlan-tag 57; 
                    family inet { 
                        address 57.57.57.7/24; 
                    } 
                } 
            } 
            fe-0/0/1 { 
                unit 67 { 
                    vlan-tag 67; 
                    family inet { 
                        address 67.67.67.7/24; 
                    } 
                } 
            } 
        } 
        protocols { 
            bgp { 
                group ext { 
                    type external; 
                    export loopback; 
                    peer-as 100; 
                    neighbor 57.57.57.5; 
                    neighbor 67.67.67.6; 
                } 
            } 
        } 
    } 
} 
 
A.13. TOPOLOGY "LABEL-AGG" 
 
This topology is used to test label aggregation. 
  
A.13.1. LOGICAL TOPOLOGY 
 
The "LABEL-AGG" topology is the same as the "MULTI-PATH" topology (see 
appendix A.12.) with the following additions: 
 
1) Ce7 advertises multiple routes 
 
2) Per-prefix-label is confired on pe5 and pe6 so that each route to 
ce7 has a different label. 
 
3) Policy is configured on pe5 and pe6 to attach a site-of-origin 
community to the routes to ce7. 
 
4) Label-aggregation is configured on pe2. 
 
A.13.2. CONFIGURATION FOR DOMMELSCH 
 
chassis { 
    redundancy { 
        graceful-switchover { 
            enable; 
        } 
    } 
} 
routing-options { 
    nonstop-routing; 
    router-id 99.99.99.2; 
    autonomous-system 100; 
} 
policy-options { 
    community soo-ce7 { 
        members origin:100:7; 
    } 
} 
interfaces { 
    lo0 { 
        unit 0 { 
            family inet { 
                address 99.99.99.2/32; 
            } 
        } 
    } 
    fe-0/3/2 { 
        vlan-tagging; 
        unit 12 { 
            vlan-id 12; 
            family inet { 
                address 12.12.12.2/24; 
            } 
        } 
        unit 23 { 
            vlan-id 23; 
            family inet { 
                address 23.23.23.2/24; 
            } 
            family mpls; 
        } 
        unit 24 { 
            vlan-id 24; 
            family inet { 
                address 24.24.24.2/24; 
            } 
            family mpls; 
        } 
    } 
} 
protocols { 
    ospf { 
        area 0 { 
            interface lo0.0; 
            interface fe-0/3/2.23; 
            interface fe-0/3/2.24; 
        } 
    } 
    mpls { 
        interface fe-0/3/2.23; 
        interface fe-0/3/2.24; 
    } 
    ldp { 
        interface fe-0/3/2.23; 
        interface fe-0/3/2.24; 
    } 
    bgp { 
        group int { 
            type internal; 
            local-address 99.99.99.2; 
            family inet-vpn { 
                unicast { 
                    aggregate-label { 
                        community soo-ce7; 
                    } 
                } 
            } 
            neighbor 99.99.99.5; 
            neighbor 99.99.99.6; 
        } 
    } 
} 
routing-instances { 
    vrf { 
        instance-type vrf; 
        route-distinguisher 100:11; 
        vrf-target target:100:1; 
        interface fe-0/3/2.12; 
        routing-options { 
            multipath; 
        } 
        protocols { 
            bgp { 
                group ext { 
                    type external; 
                    neighbor 12.12.12.1 { 
                        peer-as 65001; 
                    } 
                } 
            } 
        } 
    } 
} 
 
A.13.3. CONFIGURATION FOR FOSTERS 
 
interfaces { 
    fe-0/0/0 { 
        vlan-tagging; 
    } 
    fe-0/0/1 { 
        vlan-tagging; 
    } 
    fe-0/0/2 { 
        vlan-tagging; 
    } 
} 
logical-routers { 
    ce1 { 
        routing-options { 
            router-id 99.99.99.1; 
            autonomous-system 65001; 
        } 
        policy-options { 
            policy-statement loopback { 
                from route-filter 99.99.99.1/32 exact; 
                then accept; 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 1 { 
                    family inet { 
                        address 99.99.99.1/32; 
                    } 
                } 
            } 
            fe-0/0/2 { 
                unit 12 { 
                    vlan-tag 12; 
                    family inet { 
                        address 12.12.12.1/24; 
                    } 
                } 
            } 
        } 
        protocols { 
            bgp { 
                group ext { 
                    type external; 
                    export loopback; 
                    neighbor 12.12.12.2 { 
                        peer-as 100; 
                    } 
                } 
            } 
        } 
    } 
    p3 { 
        routing-options { 
            router-id 99.99.99.3; 
        } 
        interfaces { 
            lo0 { 
                unit 3 { 
                    family inet { 
                        address 99.99.99.3/32; 
                    } 
                } 
            } 
            fe-0/0/2 { 
                unit 23 { 
                    vlan-tag 23; 
                    family inet { 
                        address 23.23.23.3/24; 
                    } 
                    family mpls; 
                } 
            } 
            fe-0/0/0 { 
                unit 34 { 
                    vlan-tag 34; 
                    family inet { 
                        address 34.34.34.3/24; 
                    } 
                    family mpls; 
                } 
            } 
            fe-0/0/0 { 
                unit 35 { 
                    vlan-tag 35; 
                    family inet { 
                        address 35.35.35.3/24; 
                    } 
                    family mpls; 
                } 
            } 
            fe-0/0/0 { 
                unit 36 { 
                    vlan-tag 36; 
                    family inet { 
                        address 36.36.36.3/24; 
                    } 
                    family mpls; 
                } 
            } 
        } 
        protocols { 
            ospf { 
                area 0 { 
                    interface lo0.3; 
                    interface fe-0/0/2.23; 
                    interface fe-0/0/0.34; 
                    interface fe-0/0/0.35; 
                    interface fe-0/0/0.36; 
                } 
            } 
            mpls { 
               interface fe-0/0/2.23; 
               interface fe-0/0/0.34; 
               interface fe-0/0/0.35; 
               interface fe-0/0/0.36; 
            } 
            ldp { 
               interface fe-0/0/2.23; 
               interface fe-0/0/0.34; 
               interface fe-0/0/0.35; 
               interface fe-0/0/0.36; 
            } 
        } 
    } 
    p4 { 
        routing-options { 
            router-id 99.99.99.4; 
        } 
        interfaces { 
            lo0 { 
                unit 4 { 
                    family inet { 
                        address 99.99.99.4/32; 
                    } 
                } 
            } 
            fe-0/0/2 { 
                unit 24 { 
                    vlan-tag 24; 
                    family inet { 
                        address 24.24.24.4/24; 
                    } 
                    family mpls; 
                } 
            } 
            fe-0/0/1 { 
                unit 34 { 
                    vlan-tag 34; 
                    family inet { 
                        address 34.34.34.4/24; 
                    } 
                    family mpls; 
                } 
            } 
            fe-0/0/0 { 
                unit 45 { 
                    vlan-tag 45; 
                    family inet { 
                        address 45.45.45.4/24; 
                    } 
                    family mpls; 
                } 
            } 
            fe-0/0/0 { 
                unit 46 { 
                    vlan-tag 46; 
                    family inet { 
                        address 46.46.46.4/24; 
                    } 
                    family mpls; 
                } 
            } 
        } 
        protocols { 
            ospf { 
                area 0 { 
                    interface lo0.4; 
                    interface fe-0/0/2.24; 
                    interface fe-0/0/1.34; 
                    interface fe-0/0/0.45; 
                    interface fe-0/0/0.46; 
                } 
            } 
            mpls { 
               interface fe-0/0/2.24; 
               interface fe-0/0/1.34; 
               interface fe-0/0/0.45; 
               interface fe-0/0/0.46; 
            } 
            ldp { 
               interface fe-0/0/2.24; 
               interface fe-0/0/1.34; 
               interface fe-0/0/0.45; 
               interface fe-0/0/0.46; 
            } 
        } 
    } 
    pe5 { 
        routing-options { 
            router-id 99.99.99.5; 
            autonomous-system 100; 
        } 
        policy-options { 
            community soo-ce7 { 
                members origin:100:7; 
            } 
            policy-statement bgp-routes {  
                from protocol bgp; 
                then accept; 
            } 
            policy-statement add-soo-ce7 { 
                then { 
                    community add soo-ce7; 
                    accept; 
                } 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 5 { 
                    family inet { 
                        address 99.99.99.5/32; 
                    } 
                } 
            } 
            fe-0/0/1 { 
                unit 35 { 
                    vlan-tag 35; 
                    family inet { 
                        address 35.35.35.5/24; 
                    } 
                    family mpls; 
                } 
            } 
            fe-0/0/1 { 
                unit 45 { 
                    vlan-tag 45; 
                    family inet { 
                        address 45.45.45.5/24; 
                    } 
                } 
            } 
            fe-0/0/0 { 
                unit 57 { 
                    vlan-tag 57; 
                    family inet { 
                        address 57.57.57.5/24; 
                    } 
                } 
            } 
        } 
        protocols { 
            ospf { 
                area 0 { 
                    interface lo0.5; 
                    interface fe-0/0/1.35; 
                    interface fe-0/0/1.45; 
                } 
            } 
            mpls { 
               interface fe-0/0/1.35; 
               interface fe-0/0/1.45; 
            } 
            ldp { 
               interface fe-0/0/1.35; 
               interface fe-0/0/1.45; 
 
            } 
            bgp { 
                group int { 
                    type internal; 
                    local-address 99.99.99.5; 
                    family inet-vpn { 
                        unicast { 
                            per-prefix-label; 
                        } 
                    } 
                    neighbor 99.99.99.2; 
                    neighbor 99.99.99.6; 
                } 
            } 
        } 
        routing-instances { 
            vrf { 
                instance-type vrf; 
                route-distinguisher 100:51; 
                vrf-target target:100:1; 
                interface fe-0/0/0.57; 
                routing-options { 
                    multipath; 
                } 
                protocols { 
                    bgp { 
                        group ext { 
                            type external; 
                            neighbor 57.57.57.7 { 
                                peer-as 65007; 
                                import add-soo-ce7; 
                            } 
                        } 
                    } 
                } 
            } 
        } 
    } 
    pe6 { 
        routing-options { 
            router-id 99.99.99.6; 
            autonomous-system 100; 
        } 
        policy-options { 
            community soo-ce7 { 
                members origin:100:7; 
            } 
            policy-statement bgp-routes {  
                from protocol bgp; 
                then accept; 
            } 
            policy-statement add-soo-ce7 { 
                then { 
                    community add soo-ce7; 
                    accept; 
                } 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 6 { 
                    family inet { 
                        address 99.99.99.6/32; 
                    } 
                } 
            } 
            fe-0/0/1 { 
                unit 36 { 
                    vlan-tag 36; 
                    family inet { 
                        address 36.36.36.6/24; 
                    } 
                    family mpls; 
                } 
            } 
            fe-0/0/1 { 
                unit 46 { 
                    vlan-tag 46; 
                    family inet { 
                        address 46.46.46.6/24; 
                    } 
                } 
            } 
            fe-0/0/0 { 
                unit 67 { 
                    vlan-tag 67; 
                    family inet { 
                        address 67.67.67.6/24; 
                    } 
                } 
            } 
        } 
        protocols { 
            ospf { 
                area 0 { 
                    interface lo0.6; 
                    interface fe-0/0/1.36; 
                    interface fe-0/0/1.46; 
                } 
            } 
            mpls { 
               interface fe-0/0/1.36; 
               interface fe-0/0/1.46; 
            } 
            ldp { 
               interface fe-0/0/1.36; 
               interface fe-0/0/1.46; 
 
            } 
            bgp { 
                group int { 
                    type internal; 
                    local-address 99.99.99.6; 
                    family inet-vpn { 
                        unicast { 
                            per-prefix-label; 
                        } 
                    } 
                    neighbor 99.99.99.2; 
                    neighbor 99.99.99.5; 
                } 
            } 
        } 
        routing-instances { 
            vrf { 
                instance-type vrf; 
                route-distinguisher 100:61; 
                vrf-target target:100:1; 
                interface fe-0/0/0.67; 
                routing-options { 
                    multipath; 
                } 
                protocols { 
                    bgp { 
                        group ext { 
                            type external; 
                            neighbor 67.67.67.7 { 
                                peer-as 65007; 
                                import add-soo-ce7; 
                            } 
                        } 
                    } 
                } 
            } 
        } 
    } 
    ce7 { 
        routing-options { 
            router-id 99.99.99.7; 
            autonomous-system 65007; 
            static { 
                route 88.88.7.1/32 receive; 
                route 88.88.7.2/32 receive; 
                route 88.88.7.3/32 receive; 
                route 88.88.7.4/32 receive; 
                route 88.88.7.5/32 receive; 
                route 88.88.7.6/32 receive; 
                route 88.88.7.7/32 receive; 
                route 88.88.7.8/32 receive; 
                route 88.88.7.9/32 receive; 
                route 88.88.7.10/32 receive; 
            } 
        } 
        policy-options { 
            policy-statement loopback { 
                from route-filter 99.99.99.7/32 exact; 
                then accept; 
            } 
            policy-statement statics { 
                from protocol static; 
                then accept; 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 7 { 
                    family inet { 
                        address 99.99.99.7/32; 
                    } 
                } 
            } 
            fe-0/0/1 { 
                unit 57 { 
                    vlan-tag 57; 
                    family inet { 
                        address 57.57.57.7/24; 
                    } 
                } 
            } 
            fe-0/0/1 { 
                unit 67 { 
                    vlan-tag 67; 
                    family inet { 
                        address 67.67.67.7/24; 
                    } 
                } 
            } 
        } 
        protocols { 
            bgp { 
                group ext { 
                    type external; 
                    export [ loopback statics ]; 
                    peer-as 100; 
                    neighbor 57.57.57.5; 
                    neighbor 67.67.67.6; 
                } 
            } 
        } 
    } 
} 
 
A.14. TOPOLOGY "VPNV4-OVERLAP" 
 
This topology is used to test overlapping VPNs. 
  
A.14.1. LOGICAL TOPOLOGY 
 
               pe1                pe2 
              +------+           +------+ 
+----+ EBGP   |..... |           | .....| EBGP   +----+ 
|ce11|--------|pe11. |           | .pe21|--------|ce21|   VPN A 
+----+        |..... |           | .....|        +----+ 
AS65011       |      |           |      |       AS65021 
              |      |           |      | 
+----+ EBGP   |..... |   +---+   | .....| EBGP   +----+ 
|ce12|--------|pe12. |---| p |---| .pe22|--------|ce22|   VPN B 
+----+        |..... |   +---+   | .....|        +----+ 
AS65012       |      |           |      |       AS65022 
              |      |           |      | 
+----+ EBGP   |..... |           | .....| EBGP   +----+ 
|ce13|--------|pe13. |           | .pe23|--------|ce23|   VPN A & B 
+----+        |..... |           | .....|        +----+ 
AS65013       +------+           +------+       AS65023 
 
 
Pe1 is the default logical router on physical router "dommelsch". It is 
the device under test. 
 
Ce11, ce12, ce13, p, pe2, ce21, ce22, and ce23 are logical routers on 
physical router "fosters". 
 
A.14.2. CONFIGURATION FOR DOMMELSCH 
 
chassis { 
    redundancy { 
        graceful-switchover { 
            enable; 
        } 
    } 
} 
routing-options { 
    nonstop-routing; 
    router-id 99.99.99.4; 
    autonomous-system 100; 
} 
policy-options { 
    community vpn-a { 
        members target:100:1; 
    } 
    community vpn-b { 
        members target:100:2; 
    } 
    community vpn-a-b { 
        members [ target:100:1 target:100:2 ]; 
    } 
    policy-statement bgp-routes {  
        from protocol bgp; 
        then accept; 
    } 
    policy-statement pe11-export { 
        then { 
            community add vpn-a; 
            accept; 
        } 
    } 
    policy-statement pe11-import { 
        from community vpn-a; 
        then accept; 
    } 
    policy-statement pe12-export { 
        then { 
            community add vpn-b; 
            accept; 
        } 
    } 
    policy-statement pe12-import { 
        from community vpn-b; 
        then accept; 
    } 
    policy-statement pe13-export { 
        then { 
            community add vpn-a-b; 
            accept; 
        } 
    } 
    policy-statement pe13-import { 
        from { 
            community vpn-a; 
            community vpn-b; 
        } 
        then accept; 
    } 
} 
interfaces { 
    lo0 { 
        unit 0 { 
            family inet { 
                address 99.99.99.4/32; 
            } 
        } 
    } 
    fe-0/3/2 { 
        vlan-tagging; 
        unit 14 { 
            vlan-id 14; 
            family inet { 
                address 14.14.14.4/24; 
            } 
        } 
        unit 24 { 
            vlan-id 24; 
            family inet { 
                address 24.24.24.4/24; 
            } 
        } 
        unit 34 { 
            vlan-id 34; 
            family inet { 
                address 34.34.34.4/24; 
            } 
        } 
        unit 45 { 
            vlan-id 45; 
            family inet { 
                address 45.45.45.4/24; 
            } 
            family mpls; 
        } 
    } 
} 
protocols { 
    ospf { 
        area 0 { 
            interface lo0.0; 
            interface fe-0/3/2.45; 
        } 
    } 
    mpls { 
        interface fe-0/3/2.45; 
    } 
    ldp { 
        interface fe-0/3/2.45; 
    } 
    bgp { 
        group int { 
            type internal; 
            local-address 99.99.99.4; 
            family inet-vpn { 
                unicast; 
            } 
            neighbor 99.99.99.6; 
        } 
    } 
} 
routing-instances { 
    pe11 { 
        instance-type vrf; 
        route-distinguisher 100:11; 
        vrf-export pe11-export; 
        vrf-import pe11-import; 
        routing-options { 
           auto-export; 
        } 
        interface fe-0/3/2.14; 
        protocols { 
            bgp { 
                group ext { 
                    type external; 
                    neighbor 14.14.14.1 { 
                        peer-as 65011; 
                    } 
                } 
            } 
        } 
    } 
    pe12 { 
        instance-type vrf; 
        route-distinguisher 100:12; 
        vrf-export pe12-export; 
        vrf-import pe12-import; 
        routing-options { 
           auto-export; 
        } 
        interface fe-0/3/2.24; 
        protocols { 
            bgp { 
                group ext { 
                    type external; 
                    as-override; 
                    neighbor 24.24.24.2 { 
                        peer-as 65012; 
                    } 
                } 
            } 
        } 
    } 
    pe13 { 
        instance-type vrf; 
        route-distinguisher 100:13; 
        vrf-export pe13-export; 
        vrf-import pe13-import; 
        routing-options { 
           auto-export; 
        } 
        interface fe-0/3/2.34; 
        protocols { 
            bgp { 
                group ext { 
                    type external; 
                    neighbor 34.34.34.3 { 
                        peer-as 65013; 
                    } 
                } 
            } 
        } 
    } 
} 
 
A.14.3. CONFIGURATION FOR FOSTERS 
 
interfaces { 
    fe-0/0/0 { 
        vlan-tagging; 
    } 
    fe-0/0/1 { 
        vlan-tagging; 
    } 
    fe-0/0/2 { 
        vlan-tagging; 
    } 
} 
logical-routers { 
    ce11 { 
        routing-options { 
            router-id 99.99.99.1; 
            autonomous-system 65011; 
        } 
        policy-options { 
            policy-statement loopback { 
                from route-filter 99.99.99.1/32 exact; 
                then accept; 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 1 { 
                    family inet { 
                        address 99.99.99.1/32; 
                    } 
                } 
            } 
            fe-0/0/2 { 
                unit 14 { 
                    vlan-tag 14; 
                    family inet { 
                        address 14.14.14.1/24; 
                    } 
                } 
            } 
        } 
        protocols { 
            bgp { 
                group ext { 
                    type external; 
                    export loopback; 
                    neighbor 14.14.14.4 { 
                        peer-as 100; 
                    } 
                } 
            } 
        } 
    } 
    ce12 { 
        routing-options { 
            router-id 99.99.99.2; 
            autonomous-system 65012; 
        } 
        policy-options { 
            policy-statement loopback { 
                from route-filter 99.99.99.2/32 exact; 
                then accept; 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 2 { 
                    family inet { 
                        address 99.99.99.2/32; 
                    } 
                } 
            } 
            fe-0/0/2 { 
                unit 24 { 
                    vlan-tag 24; 
                    family inet { 
                        address 24.24.24.2/24; 
                    } 
                } 
            } 
        } 
        protocols { 
            bgp { 
                group ext { 
                    type external; 
                    export loopback; 
                    neighbor 24.24.24.4 { 
                        peer-as 100; 
                    } 
                } 
            } 
        } 
    } 
    ce13 { 
        routing-options { 
            router-id 99.99.99.3; 
            autonomous-system 65013; 
        } 
        policy-options { 
            policy-statement loopback { 
                from route-filter 99.99.99.3/32 exact; 
                then accept; 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 3 { 
                    family inet { 
                        address 99.99.99.3/32; 
                    } 
                } 
            } 
            fe-0/0/2 { 
                unit 34 { 
                    vlan-tag 34; 
                    family inet { 
                        address 34.34.34.3/24; 
                    } 
                } 
            } 
        } 
        protocols { 
            bgp { 
                group ext { 
                    type external; 
                    export loopback; 
                    neighbor 34.34.34.4 { 
                        peer-as 100; 
                    } 
                } 
            } 
        } 
    } 
    p { 
        routing-options { 
            router-id 99.99.99.5; 
        } 
        interfaces { 
            lo0 { 
                unit 5 { 
                    family inet { 
                        address 99.99.99.5/32; 
                    } 
                } 
            } 
            fe-0/0/2 { 
                unit 45 { 
                    vlan-tag 45; 
                    family inet { 
                        address 45.45.45.5/24; 
                    } 
                    family mpls; 
                } 
            } 
            fe-0/0/0 { 
                unit 56 { 
                    vlan-tag 56; 
                    family inet { 
                        address 56.56.56.5/24; 
                    } 
                    family mpls; 
                } 
            } 
        } 
        protocols { 
            ospf { 
                area 0 { 
                    interface lo0.5; 
                    interface fe-0/0/2.45; 
                    interface fe-0/0/0.56; 
                } 
            } 
            mpls { 
               interface fe-0/0/2.45; 
               interface fe-0/0/0.56; 
            } 
            ldp { 
               interface fe-0/0/2.45; 
               interface fe-0/0/0.56; 
            } 
        } 
    } 
    pe2 { 
        routing-options { 
            router-id 99.99.99.6; 
            autonomous-system 100; 
        } 
        policy-options { 
            community vpn-a { 
                members target:100:1; 
            } 
            community vpn-b { 
                members target:100:2; 
            } 
            community vpn-a-b { 
                members [ target:100:1 target:100:2 ]; 
            } 
            policy-statement bgp-routes {  
                from protocol bgp; 
                then accept; 
            } 
            policy-statement pe21-export { 
                then { 
                    community add vpn-a; 
                    accept; 
                } 
            } 
            policy-statement pe21-import { 
                from community vpn-a; 
                then accept; 
            } 
            policy-statement pe22-export { 
                then { 
                    community add vpn-b; 
                    accept; 
                } 
            } 
            policy-statement pe22-import { 
                from community vpn-b; 
                then accept; 
            } 
            policy-statement pe23-export { 
                then { 
                    community add vpn-a-b; 
                    accept; 
                } 
            } 
            policy-statement pe23-import { 
                from { 
                    community vpn-a; 
                    community vpn-b; 
                } 
                then accept; 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 6 { 
                    family inet { 
                        address 99.99.99.6/32; 
                    } 
                } 
            } 
            fe-0/0/1 { 
                unit 56 { 
                    vlan-tag 56; 
                    family inet { 
                        address 56.56.56.6/24; 
                    } 
                    family mpls; 
                } 
            } 
            fe-0/0/0 { 
                unit 67 { 
                    vlan-tag 67; 
                    family inet { 
                        address 67.67.67.6/24; 
                    } 
                } 
            } 
            fe-0/0/0 { 
                unit 68 { 
                    vlan-tag 68; 
                    family inet { 
                        address 68.68.68.6/24; 
                    } 
                } 
            } 
            fe-0/0/0 { 
                unit 69 { 
                    vlan-tag 69; 
                    family inet { 
                        address 69.69.69.6/24; 
                    } 
                } 
            } 
        } 
        protocols { 
            ospf { 
                area 0 { 
                    interface lo0.6; 
                    interface fe-0/0/1.56; 
                } 
            } 
            mpls { 
               interface fe-0/0/1.56; 
            } 
            ldp { 
               interface fe-0/0/1.56; 
            } 
            bgp { 
                group int { 
                    type internal; 
                    local-address 99.99.99.6; 
                    family inet-vpn { 
                        unicast; 
                    } 
                    neighbor 99.99.99.4; 
                } 
            } 
        } 
        routing-instances { 
            pe21 { 
                instance-type vrf; 
                route-distinguisher 100:21; 
                vrf-export pe21-export; 
                vrf-import pe21-import; 
                routing-options { 
                   auto-export; 
                } 
                interface fe-0/0/0.67; 
                protocols { 
                    bgp { 
                        group ext { 
                            type external; 
                            neighbor 67.67.67.7 { 
                                peer-as 65021; 
                            } 
                        } 
                    } 
                } 
            } 
            pe22 { 
                instance-type vrf; 
                route-distinguisher 100:22; 
                vrf-export pe22-export; 
                vrf-import pe22-import; 
                routing-options { 
                   auto-export; 
                } 
                interface fe-0/0/0.68; 
                protocols { 
                    bgp { 
                        group ext { 
                            type external; 
                            as-override; 
                            neighbor 68.68.68.8 { 
                                peer-as 65022; 
                            } 
                        } 
                    } 
                } 
            } 
            pe23 { 
                instance-type vrf; 
                route-distinguisher 100:23; 
                vrf-export pe23-export; 
                vrf-import pe23-import; 
                routing-options { 
                   auto-export; 
                } 
                interface fe-0/0/0.69; 
                protocols { 
                    bgp { 
                        group ext { 
                            type external; 
                            neighbor 69.69.69.9 { 
                               peer-as 65023; 
                            } 
                        } 
                    } 
                } 
            } 
        } 
    } 
    ce21 { 
        routing-options { 
            router-id 99.99.99.7; 
            autonomous-system 65021; 
        } 
        policy-options { 
            policy-statement loopback { 
                from route-filter 99.99.99.7/32 exact; 
                then accept; 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 7 { 
                    family inet { 
                        address 99.99.99.7/32; 
                    } 
                } 
            } 
            fe-0/0/1 { 
                unit 67 { 
                    vlan-tag 67; 
                    family inet { 
                        address 67.67.67.7/24; 
                    } 
                } 
            } 
        } 
        protocols { 
            bgp { 
                group ext { 
                    type external; 
                    export loopback; 
                    neighbor 67.67.67.6 { 
                        peer-as 100; 
                    } 
                } 
            } 
        } 
    } 
    ce22 { 
        routing-options { 
            router-id 99.99.99.8; 
            autonomous-system 65022; 
        } 
        policy-options { 
            policy-statement loopback { 
                from route-filter 99.99.99.8/32 exact; 
                then accept; 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 8 { 
                    family inet { 
                        address 99.99.99.8/32; 
                    } 
                } 
            } 
            fe-0/0/1 { 
                unit 68 { 
                    vlan-tag 68; 
                    family inet { 
                        address 68.68.68.8/24; 
                    } 
                } 
            } 
        } 
        protocols { 
            bgp { 
                group ext { 
                    type external; 
                    export loopback; 
                    neighbor 68.68.68.6 { 
                        peer-as 100; 
                    } 
                } 
            } 
        } 
    } 
    ce23 { 
        routing-options { 
            router-id 99.99.99.9; 
            autonomous-system 65023; 
        } 
        policy-options { 
            policy-statement loopback { 
                from route-filter 99.99.99.9/32 exact; 
                then accept; 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 9 { 
                    family inet { 
                        address 99.99.99.9/32; 
                    } 
                } 
            } 
            fe-0/0/1 { 
                unit 69 { 
                    vlan-tag 69; 
                    family inet { 
                        address 69.69.69.9/24; 
                    } 
                } 
            } 
        } 
        protocols { 
            bgp { 
                group ext { 
                    type external; 
                    export loopback; 
                    neighbor 69.69.69.6 { 
                        peer-as 100; 
                    } 
                } 
            } 
        } 
    } 
} 
 
A.15. TOPOLOGY "6PE" 
 
This topology is used to test 6PE. 
 
A.15.1. LOGICAL TOPOLOGY 
 
+--+         +--+         +--+         +--+         +--+ 
|r1|---------|r2|---------|r3|---------|r4|---------|r5| 
+--+         +--+         +--+         +--+         +--+ 
 
                <--------->  <---------> 
                 IPv4 LDP     IPv4 LDP 
 
   <--------->  <---------------------->  <---------> 
    IPv6 EBGP           IPv6 IBGP          IPv6 EBGP 
    unlabeled           labeled            unlabeled     
    unicast             unicast            unicast 
 
R2 is the default logical router on physical router "dommelsch". It is 
the device under test. 
 
R1, r3 and r5 are logical routers on physical router "fosters".  
 
R4 is the default logical router on physical router "fosters" - this is 
needed because explicit-null is mandatory labeled-unicast for IPv6. 
 
A.15.2. CONFIGURATION FOR DOMMELSCH 
 
chassis { 
    redundancy { 
        graceful-switchover { 
            enable; 
        } 
    } 
} 
routing-options { 
    nonstop-routing; 
    router-id 99.99.99.2; 
    autonomous-system 200; 
} 
interfaces { 
    lo0 { 
        unit 0 { 
            family inet { 
                address 99.99.99.2/32; 
            } 
        } 
    } 
    fe-0/3/2 { 
        vlan-tagging; 
        unit 12 { 
            vlan-id 12; 
            family inet6 { 
                address ::12:12:12:2/120; 
            } 
        } 
        unit 23 { 
            vlan-id 23; 
            family inet { 
                address 23.23.23.2/24; 
            } 
            family mpls; 
            family inet6; 
        } 
    } 
} 
protocols { 
    ospf { 
        area 0 { 
            interface lo0.0; 
            interface fe-0/3/2.23; 
        } 
    } 
    mpls { 
        interface fe-0/3/2.23; 
        ipv6-tunneling; 
    } 
    ldp { 
        interface fe-0/3/2.23; 
    }        
    bgp { 
        group unlabeled { 
            type external; 
            family inet6 { 
                unicast; 
            } 
            neighbor ::12:12:12:1 { 
                peer-as 100; 
            } 
        } 
        group labeled { 
            type internal; 
            local-address 99.99.99.2; 
            family inet6 { 
                labeled-unicast explicit-null; 
            } 
            neighbor 99.99.99.4; 
        } 
    } 
} 
 
A.15.3. CONFIGURATION FOR FOSTERS 
 
interfaces { 
    fe-0/0/0 { 
        vlan-tagging; 
    } 
    fe-0/0/1 { 
        vlan-tagging; 
    } 
    fe-0/0/2 { 
        vlan-tagging; 
    } 
} 
routing-options { 
    router-id 99.99.99.4; 
    autonomous-system 200; 
} 
interfaces { 
    lo0 { 
        unit 0 { 
            family inet { 
                address 99.99.99.4/32; 
            } 
        } 
    } 
    fe-0/0/1 { 
        unit 34 { 
            vlan-id 34; 
            family inet { 
                address 34.34.34.4/24; 
            } 
            family mpls; 
            family inet6; 
        } 
    } 
    fe-0/0/0 { 
        unit 45 { 
            vlan-id 45; 
            family inet6 { 
                address ::45:45:45:4/120; 
            } 
        } 
    } 
} 
protocols { 
    ospf { 
        area 0 { 
            interface lo0.0; 
            interface fe-0/0/1.34; 
        } 
    } 
    mpls { 
       interface fe-0/0/1.34; 
       ipv6-tunneling; 
    } 
    ldp { 
       interface fe-0/0/1.34; 
    } 
    bgp { 
        group labeled { 
            type internal; 
            local-address 99.99.99.4; 
            family inet6 { 
                labeled-unicast explicit-null; 
            } 
            neighbor 99.99.99.2; 
        } 
        group unlabeled { 
            type external; 
            family inet6 { 
                unicast; 
            } 
            neighbor ::45:45:45:5 { 
                peer-as 300 
            }; 
        } 
    } 
} 
logical-routers { 
    r1 { 
        routing-options { 
            router-id 99.99.99.1; 
            autonomous-system 100; 
        } 
        policy-options { 
            policy-statement loopback { 
                from route-filter ::99:99:99:1/128 exact; 
                then accept; 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 1 { 
                    family inet6 { 
                        address ::99:99:99:1/128; 
                    } 
                } 
            } 
            fe-0/0/2 { 
                unit 12 { 
                    vlan-id 12; 
                    family inet6 { 
                        address ::12:12:12:1/120; 
                    } 
                } 
            } 
        } 
        protocols { 
            bgp { 
                group unlabeled { 
                    export loopback; 
                    type external; 
                    family inet6 { 
                        unicast; 
                    } 
                    neighbor ::12:12:12:2 { 
                        peer-as 200 
                    }; 
                } 
            } 
        } 
    } 
    r3 { 
        routing-options { 
            router-id 99.99.99.3; 
        } 
        interfaces { 
            lo0 { 
                unit 3 { 
                    family inet { 
                        address 99.99.99.3/32; 
                    } 
                } 
            } 
            fe-0/0/2 { 
                unit 23 { 
                    vlan-id 23; 
                    family inet { 
                        address 23.23.23.3/24; 
                    } 
                    family mpls; 
                } 
            } 
            fe-0/0/0 { 
                unit 34 { 
                    vlan-id 34; 
                    family inet { 
                        address 34.34.34.3/24; 
                    } 
                    family mpls; 
                } 
            } 
        } 
        protocols { 
            ospf { 
                area 0 { 
                    interface lo0.3; 
                    interface fe-0/0/2.23; 
                    interface fe-0/0/0.34; 
                } 
            } 
            mpls { 
                interface fe-0/0/2.23; 
                interface fe-0/0/0.34; 
            } 
            ldp { 
                interface fe-0/0/2.23; 
                interface fe-0/0/0.34; 
            } 
        } 
    } 
    r5 { 
        routing-options { 
            router-id 99.99.99.5; 
            autonomous-system 300; 
        } 
        policy-options { 
            policy-statement loopback { 
                from route-filter ::99:99:99:5/128 exact; 
                then accept; 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 5 { 
                    family inet6 { 
                        address ::99:99:99:5/128; 
                    } 
                } 
            } 
            fe-0/0/1 { 
                unit 45 { 
                    vlan-id 45; 
                    family inet6 { 
                        address ::45:45:45:5/120; 
                    } 
                    family mpls; 
                } 
            } 
        } 
        protocols { 
            bgp { 
                group unlabeled { 
                    export loopback; 
                    type external; 
                    family inet6 { 
                        unicast; 
                    } 
                    neighbor ::45:45:45:4 { 
                        peer-as 200 
                    }; 
                } 
            } 
        } 
    } 
} 
 
A.16. TOPOLOGY "VPNV4-GRE-DYN" 
 
This topology is used to test IPv4 VPNs over dynamic GRE base tunnels. 
 
A.16.1. LOGICAL TOPOLOGY 
 
              +-----+           +-----+   
+----+ Static |     |   +---+   |     | Static +----+ 
|ce11|--------| pe1 |---| p |---| pe2 |--------|ce21| 
+----+        |     |   +---+   |     |        +----+ 
              +-----+           +-----+ 
 
                     <--------->                
                      dynamic GRE                     
 
Pe1 is the default logical router on physical router "dommelsch". It is 
the device under test. 
 
Ce11, p, pe2, and ce21 are logical routers on physical router 
"fosters". 
 
ce11 and ce21 use IPv4 static routes as the PE-CE protocol. 
 
Pe1 and pe2 are configured to dynamically establish GRE tunnels to BGP 
next-hops using the "dynamic-tunnels" statement. 
 
A.16.2. CONFIGURATION FOR DOMMELSCH 
 
chassis { 
    redundancy { 
        graceful-switchover { 
            enable; 
        } 
    } 
} 
routing-options { 
    nonstop-routing; 
    router-id 99.99.99.2; 
    autonomous-system 100; 
    dynamic-tunnels { 
        gre-tunnels { 
            source-address 99.99.99.2; 
            tunnel-type gre; 
            destination-networks { 
                99.99.99.0/24; 
            } 
        } 
    } 
} 
interfaces { 
    lo0 { 
        unit 0 { 
            family inet { 
                address 99.99.99.2/32; 
            } 
        } 
    } 
    fe-0/3/2 { 
        vlan-tagging; 
        unit 12 { 
            vlan-id 12; 
            family inet { 
                address 12.12.12.2/24; 
            } 
        } 
        unit 23 { 
            vlan-id 23; 
            family inet { 
                address 23.23.23.2/24; 
            } 
        } 
    } 
} 
protocols { 
    ospf { 
        area 0 { 
            interface lo0.0; 
            interface fe-0/3/2.23; 
        } 
    } 
    bgp { 
        group int { 
            type internal; 
            local-address 99.99.99.2; 
            family inet-vpn { 
                unicast; 
            } 
            neighbor 99.99.99.4; 
        } 
    } 
} 
routing-instances { 
    pe11 { 
        instance-type vrf; 
        route-distinguisher 100:11; 
        vrf-target target:100:1; 
        interface fe-0/3/2.12; 
        routing-options { 
            static { 
                route 99.99.99.1/32 { 
                    next-hop 12.12.12.1; 
                } 
            } 
        } 
    } 
} 
 
A.16.2. CONFIGURATION FOR FOSTERS 
 
interfaces { 
    fe-0/0/0 { 
        vlan-tagging; 
    } 
    fe-0/0/1 { 
        vlan-tagging; 
    } 
    fe-0/0/2 { 
        vlan-tagging; 
    } 
} 
logical-routers { 
    ce11 { 
        routing-options { 
            router-id 99.99.99.1; 
            static { 
                route 0.0.0.0/0 { 
                    next-hop 12.12.12.2; 
                    retain; 
                } 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 1 { 
                    family inet { 
                        address 99.99.99.1/32; 
                    } 
                } 
            } 
            fe-0/0/2 { 
                unit 12 { 
                    vlan-id 12; 
                    family inet { 
                        address 12.12.12.1/24; 
                    } 
                } 
            } 
        } 
    } 
    p { 
        routing-options { 
            router-id 99.99.99.3; 
        } 
        interfaces { 
            lo0 { 
                unit 3 { 
                    family inet { 
                        address 99.99.99.3/32; 
                    } 
                } 
            } 
            fe-0/0/2 { 
                unit 23 { 
                    vlan-id 23; 
                    family inet { 
                        address 23.23.23.3/24; 
                    } 
                } 
            } 
            fe-0/0/0 { 
                unit 34 { 
                    vlan-id 34; 
                    family inet { 
                        address 34.34.34.3/24; 
                    } 
                } 
            } 
        } 
        protocols { 
            ospf { 
                area 0 { 
                    interface lo0.0; 
                    interface fe-0/0/2.23; 
                    interface fe-0/0/0.34; 
                } 
            } 
        } 
    } 
    pe2 { 
        routing-options { 
            router-id 99.99.99.4; 
            autonomous-system 100; 
            dynamic-tunnels { 
                gre-tunnels { 
                    source-address 99.99.99.4; 
                    tunnel-type gre; 
                    destination-networks { 
                        99.99.99.0/24; 
                    } 
                } 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 4 { 
                    family inet { 
                        address 99.99.99.4/32; 
                    } 
                } 
            } 
            fe-0/0/1 { 
                unit 34 { 
                    vlan-id 34; 
                    family inet { 
                        address 34.34.34.4/24; 
                    } 
                } 
            } 
            fe-0/0/0 { 
                unit 45 { 
                    vlan-id 45; 
                    family inet { 
                        address 45.45.45.4/24; 
                    } 
                } 
            } 
        } 
        protocols { 
            ospf { 
                area 0 { 
                    interface lo0.4; 
                    interface fe-0/0/1.34; 
                } 
            } 
            bgp { 
                group int { 
                    type internal; 
                    local-address 99.99.99.4; 
                    family inet-vpn { 
                        unicast; 
                    } 
                    neighbor 99.99.99.2; 
                } 
            } 
        } 
        routing-instances { 
            pe21 { 
                instance-type vrf; 
                route-distinguisher 100:21; 
                vrf-target target:100:1; 
                interface fe-0/0/0.45; 
                routing-options { 
                    static { 
                        route 99.99.99.5/32 { 
                            next-hop 45.45.45.5; 
                        } 
                    } 
                } 
            } 
        } 
    } 
    ce21 { 
        routing-options { 
            router-id 99.99.99.5; 
            static { 
                route 0.0.0.0/0 { 
                    next-hop 45.45.45.4; 
                    retain; 
                } 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 5 { 
                    family inet { 
                        address 99.99.99.5/32; 
                    } 
                } 
            } 
            fe-0/0/1 { 
                unit 45 { 
                    vlan-id 45; 
                    family inet { 
                        address 45.45.45.5/24; 
                    } 
                } 
            } 
        } 
    } 
} 
 
A.17. TOPOLOGY "HUB-AND-SPOKE"

This topology is used to test hub-and-spoke.
 
A.17.1. LOGICAL TOPOLOGY

                                     pe3
                                  +-----+
                                  | ....|   +---+
                                --| .vrf|---|ce5|
          pe2                  /  | ....|   +---+
         +-----------------+  /   +-----+ 
         |...............  |--       |
         |vrf-upstream  .  |         |
 +---+   |...............  |         |
 |ce1|---|                 |         |
 +---+   |...............  |         |
         |vrf-downstream.  |         |
         |...............  |--       |   
         +-----------------+  \   +-----+
                               \  | ....|   +---+
                                --| .vrf|---|ce6|
                                  | ....|   +---+
                                  +-----+
                                     pe4

Pe2 is the default logical router on physical router "dommelsch". It is 
the device under test.

Ce1, pe3, pe4, ce5, and ce6 are logical routers on physical router "fosters".

All CEs use EBGP as the PE-CE protocol and have unique AS numbers. 

The route targets have been configured to create a hub-and-spoke topology 
where ce1 is the hub and ce5 and ce6 are the spokes. Pe2 has sepearate 
upstream and downstream VRFs and no-vrf-advertise to force spoke-to-spoke 
traffic through the hub.

A.17.2. CONFIGURATION FOR DOMMELSCH

chassis {
    redundancy {
        graceful-switchover {
            enable;
        }
    }
}
interfaces {
    fe-0/3/2 {
        vlan-tagging;
        unit 12 {
            vlan-id 12;
            family inet {
                address 12.12.12.2/24;
            }
        }
        unit 23 {
            vlan-id 23;
            family inet {
                address 23.23.23.2/24;
            }
            family mpls;
        }
        unit 24 {
            vlan-id 24;
            family inet {
                address 24.24.24.2/24;
            }
            family mpls;
        }
    }
    lo0 {
        unit 0 {
            family inet {
                address 99.99.99.2/32;
            }
        }
    }
}
routing-options {
    nonstop-routing;
    router-id 99.99.99.2;
    autonomous-system 100;
}
protocols {
    mpls {
        interface fe-0/3/2.23;
        interface fe-0/3/2.24;
    }
    bgp {
        group int {
            type internal;
            local-address 99.99.99.2;
            family inet-vpn {
                unicast;
            }
            neighbor 99.99.99.3;
            neighbor 99.99.99.4;
        }
    }
    ospf {
        area 0.0.0.0 {
            interface lo0.0;
            interface fe-0/3/2.23;
            interface fe-0/3/2.24;
        }
    }
    ldp {
        interface fe-0/3/2.23;
        interface fe-0/3/2.24;
    }
}
routing-instances {
    vrf-downstream {
        instance-type vrf;
        route-distinguisher 100:112;
        vrf-target target:100:11;
        vrf-table-label;
        routing-options {
            auto-export;
        }
    }
    vrf-upstream {
        instance-type vrf;
        interface fe-0/3/2.12;
        route-distinguisher 100:111;
        vrf-target {
            import target:100:12;
            export target:100:11;
        }
        no-vrf-advertise;
        routing-options {
            auto-export;
        }
        protocols {
            bgp {
                group ext {
                    type external;
                    neighbor 12.12.12.1 {
                        peer-as 65001;
                    }
                }
            }
        }
    }
}

A.17.3. CONFIGURATION FOR FOSTERS

logical-routers {
    ce1 {
        interfaces {
            fe-0/0/2 {
                unit 12 {
                    vlan-tag 12;
                    family inet {
                        address 12.12.12.1/24;
                    }
                }
            }
            lo0 {
                unit 1 {
                    family inet {
                        address 99.99.99.1/32;
                    }
                }
            }
        }
        protocols {
            bgp {
                group ext {
                    type external;
                    export loopback;
                    neighbor 12.12.12.2 {
                        peer-as 100;
                    }
                }
            }
        }
        policy-options {
            policy-statement loopback {
                from {
                    route-filter 99.99.99.1/32 exact;
                }
                then accept;
            }
        }
        routing-options {
            router-id 99.99.99.1;
            autonomous-system 65001;
        }
    }
    ce5 {
        interfaces {
            fe-0/0/1 {
                unit 35 {
                    vlan-tag 35;
                    family inet {
                        address 35.35.35.5/24;
                    }
                }
            }
            lo0 {
                unit 5 {
                    family inet {
                        address 99.99.99.5/32;
                    }
                }
            }
        }
        protocols {
            bgp {
                group ext {
                    type external;
                    export loopback;
                    peer-as 100;
                    neighbor 35.35.35.3;
                }
            }
        }
        policy-options {
            policy-statement loopback {
                from {
                    route-filter 99.99.99.5/32 exact;
                }
                then accept;
            }
        }
        routing-options {
            router-id 99.99.99.5;
            autonomous-system 65005;
        }
    }
    ce6 {
        interfaces {
            fe-0/0/1 {
                unit 46 {
                    vlan-tag 46;
                    family inet {
                        address 46.46.46.6/24;
                    }
                }
            }
            lo0 {
                unit 6 {
                    family inet {
                        address 99.99.99.6/32;
                    }
                }
            }
        }
        protocols {
            bgp {
                group ext {
                    type external;
                    export loopback;
                    peer-as 100;
                    neighbor 46.46.46.4;
                }
            }
        }
        policy-options {
            policy-statement loopback {
                from {
                    route-filter 99.99.99.6/32 exact;
                }
                then accept;
            }
        }
        routing-options {
            router-id 99.99.99.6;
            autonomous-system 65006;
        }
    }
    pe3 {
        interfaces {
            fe-0/0/0 {
                unit 34 {
                    vlan-tag 34;
                    family inet {
                        address 34.34.34.3/24;
                    }
                    family mpls;
                }
                unit 35 {
                    vlan-tag 35;
                    family inet {
                        address 35.35.35.3/24;
                    }
                }
            }
            fe-0/0/2 {
                unit 23 {
                    vlan-tag 23;
                    family inet {
                        address 23.23.23.3/24;
                    }
                    family mpls;
                }
            }
            lo0 {
                unit 3 {
                    family inet {
                        address 99.99.99.3/32;
                    }
                }
            }
        }
        protocols {
            mpls {
                interface fe-0/0/2.23;
                interface fe-0/0/0.34;
            }
            bgp {
                group int {
                    type internal;
                    local-address 99.99.99.3;
                    family inet-vpn {
                        unicast;
                    }
                    neighbor 99.99.99.2;
                    neighbor 99.99.99.4;
                }
            }
            ospf {
                area 0.0.0.0 {
                    interface lo0.3;
                    interface fe-0/0/2.23;
                    interface fe-0/0/0.34;
                }
            }
            ldp {
                interface fe-0/0/0.34;
                interface fe-0/0/2.23;
            }
        }
        routing-instances {
            vrf {
                instance-type vrf;
                interface fe-0/0/0.35;
                route-distinguisher 100:31;
                vrf-target {
                    import target:100:11;
                    export target:100:12;
                }
                protocols {
                    bgp {
                        group ext {
                            type external;
                            neighbor 35.35.35.5 {
                                peer-as 65005;
                            }
                        }
                    }
                }
            }
        }
        routing-options {
            router-id 99.99.99.3;
            autonomous-system 100;
        }
    }
    pe4 {
        interfaces {
            fe-0/0/0 {
                unit 46 {
                    vlan-tag 46;
                    family inet {
                        address 46.46.46.4/24;
                    }
                }
            }
            fe-0/0/1 {
                unit 34 {
                    vlan-tag 34;
                    family inet {
                        address 34.34.34.4/24;
                    }
                    family mpls;
                }
            }
            fe-0/0/2 {
                unit 24 {
                    vlan-tag 24;
                    family inet {
                        address 24.24.24.4/24;
                    }
                    family mpls;
                }
            }
            lo0 {
                unit 4 {
                    family inet {
                        address 99.99.99.4/32;
                    }
                }
            }
        }
        protocols {
            mpls {
                interface fe-0/0/2.24;
                interface fe-0/0/1.34;
            }
            bgp {
                group int {
                    type internal;
                    local-address 99.99.99.4;
                    family inet-vpn {
                        unicast;
                    }
                    neighbor 99.99.99.2;
                    neighbor 99.99.99.3;
                }
            }
            ospf {
                area 0.0.0.0 {
                    interface lo0.4;
                    interface fe-0/0/2.24;
                    interface fe-0/0/1.34;
                }
            }
            ldp {
                interface fe-0/0/1.34;
                interface fe-0/0/2.24;
            }
        }
        routing-instances {
            vrf {
                instance-type vrf;
                interface fe-0/0/0.46;
                route-distinguisher 100:41;
                vrf-target {
                    import target:100:11;
                    export target:100:12;
                }
                protocols {
                    bgp {
                        group ext {
                            type external;
                            neighbor 46.46.46.6 {
                                peer-as 65006;
                            }
                        }
                    }
                }
            }
        }
        routing-options {
            router-id 99.99.99.4;
            autonomous-system 100;
        }
    }
}
interfaces {
    fe-0/0/0 {
        vlan-tagging;
    }
    fe-0/0/1 {
        vlan-tagging;
    }
    fe-0/0/2 {
        vlan-tagging;
    }
}

A.18. TOPOLOGY "INTERNET-ACCESS" 
 
This topology is used to test internet access from a VPN. 
  
A.18.1. LOGICAL TOPOLOGY 
 
              +-----+           +-----+   
+----+  EBGP  |     |   +---+   |     |  EBGP  +----+ 
|ce11|--------| pe1 |---| p |---| pe2 |--------|ce21| 
+----+        |     |   +---+   |     |        +----+ 
              +-----+     |     +-----+ 
                          | 
                          | 
                    +----------+ 
                    | internet | 
                    +----------+ 
 
Pe1 is the default logical router on physical router "dommelsch". It is 
the device under test. 
 
Ce11, p, pe2, ce21, and internet are logical routers on physical router 
"fosters". 
 
Pe1 is configured to allow ce11 to reach both ce21 (which is in the 
same VPN as ce11) as well as "internet" which is not in the VPN: 
 
- The ce11-pe1 EBGP session has a rib-group configured to inject the 
VPN routes into the internet. 
 
- Pe1 has a static default route in the VRF with a next-table next-hop 
which points to inet.0. 
 
A.18.2. CONFIGURATION FOR DOMMELSCH 

chassis {
    redundancy {
        graceful-switchover {
            enable;
        }
    }
}
routing-options {
    nonstop-routing;
    router-id 99.99.99.2;
    autonomous-system 100;
    rib-groups {
        pe11-and-inet0 {
            import-rib [ pe11.inet.0 inet.0 ];
        }
    }
}
policy-options {
    policy-statement statics {
        from protocol static;
        then accept;
    }
}
interfaces {
    lo0 {
        unit 0 {
            family inet {
                address 99.99.99.2/32;
            }
        }
    }
    fe-0/3/2 {
        vlan-tagging;
        unit 12 {
            vlan-id 12;
            family inet {
                address 12.12.12.2/24;
            }
        }
        unit 23 {
            vlan-id 23;
            family inet {
                address 23.23.23.2/24;
            }
            family mpls;
        }
    }
}
protocols {
    ospf {
        area 0 {
            interface lo0.0;
            interface fe-0/3/2.23;
        }
    }
    mpls {
        interface fe-0/3/2.23;
    }
    ldp {
        interface fe-0/3/2.23;
    }
    bgp {
        group int {
            type internal;
            local-address 99.99.99.2;
            family inet {
                unicast;
            }
            family inet-vpn {
                unicast;
            }
            neighbor 99.99.99.3;
            neighbor 99.99.99.4;
            neighbor 99.99.99.6;
        }
    }
}
routing-instances {
    pe11 {
        instance-type vrf;	
        route-distinguisher 100:11;
        vrf-target target:100:1;
        interface fe-0/3/2.12;
        routing-options {
            static {
                route 0.0.0.0/0 {
                    next-table inet.0;
                    retain;
                }
            }
        }
        protocols {
            bgp {
                group ext {
                    type external;
                    export statics;
                    family inet {
                        unicast {
                            rib-group pe11-and-inet0;
                        }
                    }
                    neighbor 12.12.12.1 {
                        peer-as 65001;
                    }
                }
            }
        }
    }
}

 
A.18.3. CONFIGURATION FOR FOSTERS

interfaces {
    fe-0/0/0 {
        vlan-tagging;
    }
    fe-0/0/1 {
        vlan-tagging;
    }
    fe-0/0/2 {
        vlan-tagging;
    }
}
logical-routers {
    ce11 {
        routing-options {
            router-id 99.99.99.1;
            autonomous-system 65001;
        }
        policy-options {
            policy-statement loopback {
                from route-filter 99.99.99.1/32 exact;
                then accept;
            }
        }
        interfaces {
            lo0 {
                unit 1 {
                    family inet {
                        address 99.99.99.1/32;
                    }
                }
            }
            fe-0/0/2 {
                unit 12 {
                    vlan-id 12;
                    family inet {
                        address 12.12.12.1/24;
                    }
                }
            }
        }
        protocols {
            bgp {
                group ext {
                    type external;
                    export loopback;
                    neighbor 12.12.12.2 {
                        peer-as 100;
                    }
                }
            }
        }
    }
    p {
        routing-options {
            router-id 99.99.99.3;
            autonomous-system 100;
        }
        interfaces {
            lo0 {
                unit 3 {
                    family inet {
                        address 99.99.99.3/32;
                    }
                }
            }
            fe-0/0/2 {
                unit 23 {
                    vlan-id 23;
                    family inet {
                        address 23.23.23.3/24;
                    }
                    family mpls;
                }
            }
            fe-0/0/0 {
                unit 34 {
                    vlan-id 34;
                    family inet {
                        address 34.34.34.3/24;
                    }
                    family mpls;
                }
                unit 36 {
                    vlan-id 36;
                    family inet {
                        address 36.36.36.3/24;
                    }
                    family mpls;
                }
            }
        }
        protocols {
            ospf {
                area 0 {
                    interface lo0.3;
                    interface fe-0/0/2.23;
                    interface fe-0/0/0.34;
                    interface fe-0/0/0.36;
                }
            }
            mpls {
                interface fe-0/0/2.23;
                interface fe-0/0/0.34;
                interface fe-0/0/0.36;
            }
            ldp {
                interface fe-0/0/2.23;
                interface fe-0/0/0.34;
                interface fe-0/0/0.36;
            }
            bgp {
                group int {
                    type internal;
                    local-address 99.99.99.3;
                    family inet {
                        unicast;
                    }
                    family inet-vpn {
                        unicast;
                    }
                    neighbor 99.99.99.2;
                    neighbor 99.99.99.4;
                    neighbor 99.99.99.6;
                }
            }
        }
    }
    pe2 {
        routing-options {
            router-id 99.99.99.4;
            autonomous-system 100;
        }
        interfaces {
            lo0 {
                unit 4 {
                    family inet {
                        address 99.99.99.4/32;
                    }
                }
            }
            fe-0/0/1 {
                unit 34 {
                    vlan-id 34;
                    family inet {
                        address 34.34.34.4/24;
                    }
                    family mpls;
                }
            }
            fe-0/0/0 {
                unit 45 {
                    vlan-id 45;
                    family inet {
                        address 45.45.45.4/24;
                    }
                }
            }
        }
        protocols {
            ospf {
                area 0 {
                    interface lo0.4;
                    interface fe-0/0/1.34;
                }
            }
            mpls {
                interface fe-0/0/1.34;
            }
            ldp {
                interface fe-0/0/1.34;
            }
            bgp {
                group int {
                    type internal;
                    local-address 99.99.99.4;
                    family inet {
                        unicast;
                    }
                    family inet-vpn {
                        unicast;
                    }
                    neighbor 99.99.99.2;
                    neighbor 99.99.99.3;
                    neighbor 99.99.99.6;
                }
            }
        }
        routing-instances {
            pe21 {
                instance-type vrf;	
                route-distinguisher 100:21;
                vrf-target target:100:1;
                interface fe-0/0/0.45;

                protocols {
                    bgp {
                        group ext {
                            type external;
                            neighbor 45.45.45.5 {
                                peer-as 65002;
                            }
                        }
                    }
                }
            }
        }
    }
    ce21 {
        routing-options {
            router-id 99.99.99.5;
            autonomous-system 65002;
        }
        policy-options {
            policy-statement loopback {
                from route-filter 99.99.99.5/32 exact;
                then accept;
            }
        }
        interfaces {
            lo0 {
                unit 5 {
                    family inet {
                        address 99.99.99.5/32;
                    }
                }
            }
            fe-0/0/1 {
                unit 45 {
                    vlan-id 45;
                    family inet {
                        address 45.45.45.5/24;
                    }
                }
            }
        }
        protocols {
            bgp {
                group ext {
                    type external;
                    export loopback;
                    neighbor 45.45.45.4 {
                        peer-as 100;
                    }
                }
            }
        }
    }
    internet {
        routing-options {
            router-id 99.99.99.6;
            autonomous-system 100;
        }
        policy-options {
            policy-statement internet-route {
                from route-filter 66.66.66.0/24 exact;
                then accept;
            }
        }
        interfaces {
            lo0 {
                unit 6 {
                    family inet {
                        address 99.99.99.6/32;
                    }
                }
            }
            fe-0/0/0 {
                unit 66 {
                    vlan-id 66;
                    family inet {
                        address 66.66.66.6/24;
                    }
                }
            }
            fe-0/0/1 {
                unit 36 {
                    vlan-id 36;
                    family inet {
                        address 36.36.36.6/24;
                    }
                }
                unit 66 {
                    vlan-id 66;
                }
            }
        }
        protocols {
            ospf {
                area 0 {
                    interface lo0.6;
                    interface fe-0/0/1.36;
                }
            }
            bgp {
                group int {
                    type internal;
                    export internet-route;
                    local-address 99.99.99.6;
                    family inet {
                        unicast;
                    }
                    neighbor 99.99.99.2;
                    neighbor 99.99.99.3;
                    neighbor 99.99.99.4;
                }
            }
        }
    }
}

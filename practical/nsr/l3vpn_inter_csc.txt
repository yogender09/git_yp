       NSR: pre-release testing of L3VPN Inter-AS and CsC / NSR
                               
                           RLI 5911
                               
                    Unit test plan and results 
 
Author: Rex Fernando { rex@juniper.net }
 
Copyright (C) 2006, Juniper Networks, Inc. 
 
NOTICE: This document contains the proprietary and confidential 
information of Juniper Networks, Inc., and must not be distributed 
outside of the company without the permission of Juniper Engineering. 
 
1. INTRODUCTION 
 
This document contains the unit test plan and unit test results for RLI 
5911.

The following list summarizes the features tested in this plan:

Feature                                           Result      
------------------------------------------------  ----------------
Inter-AS option A                                 OK
Inter-AS option B                                 OK
Inter-AS option C                                 OK
Carrier Supporting Carrier		          OK
 
2. SETUP 
 
The hardware required for this unit test plan is two routers (we used 
M10i routers), each with at least one ethernet PIC. The physical 
topology is fixed for all test cases and is described in appendix A.1. 
Logical routes are used extensively to create different logical 
topologies for the various test cases; these logical topologies are 
described in the rest of appendix A. 

Issues during testing:
---------------------

The following issue was uncovered during the testing. All the oberseved
results were obtained with a special image having a fix for this issue:

257196: BGP/NSR: Secondary discards labels for labeled ipv4 sessions

 
3. FUNCTIONAL TEST CASES 
 
3.1. TEST-CASE: INTER-AS OPTION A 
 
Goals: 
 
   1. Inter-AS option A 
      
Test Steps: 
 
   1. Configure routers dommelsch and fosters according to topology 
     "VPNV4-IAA" (see appendix A.2). 
      
   2. Let everything converge. 
      
   3. On fosters, start a continuous ping from ce11 to ce21: 
      
     [fosters] 
     set cli logical-router ce11 
     ping 99.99.99.6 source 99.99.99.1 count 1000000 rapid
      
   4. On dommelsch, switch-over from the master RE to the standby RE: 
      
     [dommelsch] 
     request chassis routing-engine mastership switch 
      
   5. On fosters, observe all the pings and verify that there is no 
     dropped traffic. 
      
   6. Wait 2 minutes for everything to re-converge after each switch-
     over. [See observation 1] 
      
   7. Repeat steps 4, 5, and 6 several times, switching back and forth 
     between RE0 and RE1 on dommelsch. 
 
Success criteria:  

   1. No traffic loss on any switch-over. 
 
Results: Pass 


3.2. TEST-CASE: INTER-AS OPTION B
 
Goals: 
 
   1. Inter-AS option B
      
Test Steps: 
 
   1. Configure routers dommelsch and fosters according to topology 
     "VPNV4-IAB" (see appendix A.3). 
      
   2. Let everything converge. 
      
   3. On fosters, start a continuous ping from ce11 to ce21: 
      
     [fosters] 
     set cli logical-router ce11 
     ping 99.99.99.6 source 99.99.99.1 count 1000000 rapid
      
   4. On dommelsch, switch-over from the master RE to the standby RE: 
      
     [dommelsch] 
     request chassis routing-engine mastership switch 
      
   5. On fosters, observe all the pings and verify that there is no 
     dropped traffic. 
      
   6. Wait 2 minutes for everything to re-converge after each switch-
     over. [See observation 1] 
      
   7. Repeat steps 4, 5, and 6 several times, switching back and forth 
     between RE0 and RE1 on dommelsch. 
 
Success criteria:  

   1. No traffic loss on any switch-over. 
 
Results: Pass 

3.3. TEST-CASE: INTER-AS OPTION C
 
Goals: 
 
   1. Inter-AS option C
      
Test Steps: 
 
   1. Configure routers dommelsch and fosters according to topology 
     "VPNV4-IAC" (see appendix A.4). 
      
   2. Let everything converge. 
      
   3. On fosters, start a continuous ping from ce11 to ce21: 
      
     [fosters] 
     set cli logical-router ce11 
     ping 99.99.99.6 source 99.99.99.1 count 1000000 rapid
      
   4. On dommelsch, switch-over from the master RE to the standby RE: 
      
     [dommelsch] 
     request chassis routing-engine mastership switch 
      
   5. On fosters, observe all the pings and verify that there is no 
     dropped traffic. 
      
   6. Wait 2 minutes for everything to re-converge after each switch-
     over. [See observation 1] 
      
   7. Repeat steps 4, 5, and 6 several times, switching back and forth 
     between RE0 and RE1 on dommelsch. 
 
Success criteria:  

   1. No traffic loss on any switch-over. 
 
Results: Pass 


3.4. TEST-CASE: CARRIER SUPPORTING CARRIER
 
Goals: 
 
   1. To test CsC
      
Test Steps: 
 
   1. Configure routers dommelsch and fosters according to topology 
     "VPNV4-CSC" (see appendix A.5). 
      
   2. Let everything converge. 
      
   3. On fosters, start a continuous ping from ce1 to ce2: 
      
     [fosters] 
     set cli logical-router ce1
     ping 99.99.99.11 source 99.99.99.1 count 1000000 rapid
      
   4. On dommelsch, switch-over from the master RE to the standby RE: 
      
     [dommelsch] 
     request chassis routing-engine mastership switch 
      
   5. On fosters, observe all the pings and verify that there is no 
     dropped traffic. 
      
   6. Wait 2 minutes for everything to re-converge after each switch-
     over. [See observation 1] 
      
   7. Repeat steps 4, 5, and 6 several times, switching back and forth 
     between RE0 and RE1 on dommelsch. 
 
Success criteria:  

   1. No traffic loss on any switch-over. 
 
Results: Pass 


 
4. BOUNDARY TEST CASES 
 
None. 
 
5. REGRESSION TEST CASES 
 
None. 
 
6. INTEROP TEST CASES 
 
None. 
 
7. MIGRATION & COMPATIBILITY TEST CASES 
 
None. 
 
8. TEST COVERAGE REMAINING 
 
None. 
 
9. DEFECTS REMAINING 
 
See list of PRs for each test case. 
 
10. REVIEWS
 
A.1. PHYSICAL TOPOLOGY 
 
  fe-0/3/0 +-----------+ 
+----------|           | 
|          | dommelsch | 
+----------| M10i      | 
  fe-0/3/1 |           | 
           +-----------+ 
                 | fe-0/3/2 
                 | 
                 | fe-0/0/2 
  fe-0/0/0 +-----------+ 
+----------|           | 
|          | fosters   | 
+----------| M10i      | 
  fe-0/0/1 |           | 
           +-----------+ 
 


A.2. TOPOLOGY "VPNV4-IAA" 
 
This topology is used to test inter-AS option A. 
 
A.2.1. LOGICAL TOPOLOGY 
 
         +-----+   +-------+   +-------+   +-----+ 
+----+   |     |   |       |   |       |   |     |   +----+ 
|ce11|---| pe1 |---| asbr1 |---| asbr2 |---| pe2 |---|ce21| 
+----+   |     |   |       |   |       |   |     |   +----+ 
         +-----+   +-------+   +-------+   +-----+ 
 
<---->   <----------------->   <----------------->   <----> 
 AS100    AS200                 AS300                 AS400    
 
Asbr1 is the default logical router on physical router "dommelsch". It 
is the device under test. 
 
Ce11, pe1, asbr2, pe2, and ce21 are logical routers on physical router 
"fosters". 
 
Ce11 and ce21 use BGP as the PE-CE protocol. 
 
Asbr1 and asbr2 run inter-AS option A with BGP as the VRF-VRF protocol. 
 
A.2.2. CONFIGURATION FOR DOMMELSCH 
 
chassis { 
    redundancy { 
        graceful-switchover { 
            enable; 
        } 
    } 
} 
routing-options { 
    nonstop-routing; 
    router-id 99.99.99.3; 
    autonomous-system 200; 
} 
interfaces { 
    lo0 { 
        unit 0 { 
            family inet { 
                address 99.99.99.3/32; 
            } 
        } 
    } 
    fe-0/3/2 { 
        vlan-tagging; 
        unit 23 { 
            vlan-id 23; 
            family inet { 
                address 23.23.23.3/24; 
            } 
            family mpls; 
        } 
        unit 34 { 
            vlan-id 34; 
            family inet { 
                address 34.34.34.3/24; 
            } 
        } 
    } 
} 
protocols { 
    ospf { 
        area 0 { 
            interface lo0.0; 
            interface fe-0/3/2.23; 
        } 
    } 
    mpls { 
        interface fe-0/3/2.23; 
    } 
    ldp { 
        interface fe-0/3/2.23; 
    } 
    bgp { 
        group int { 
            type internal; 
            local-address 99.99.99.3; 
            family inet-vpn { 
                unicast; 
            } 
            neighbor 99.99.99.2; 
        } 
    } 
} 
routing-instances { 
    vrf-asbr1 { 
        instance-type vrf; 
        route-distinguisher 100:3; 
        vrf-target target:100:1; 
        interface fe-0/3/2.34; 
        routing-options { 
            router-id 99.99.99.21; 
        } 
        protocols { 
            bgp { 
                group ext { 
                    type external; 
                    neighbor 34.34.34.4 { 
                        peer-as 300; 
                    } 
                } 
            } 
        } 
    } 
} 

A.8.3. CONFIGURATION FOR FOSTERS 
 
interfaces { 
    fe-0/0/0 { 
        vlan-tagging; 
    } 
    fe-0/0/1 { 
        vlan-tagging; 
    } 
    fe-0/0/2 { 
        vlan-tagging; 
    } 
} 
logical-routers { 
    ce11 { 
        routing-options { 
            router-id 99.99.99.1; 
            autonomous-system 100; 
        } 
        policy-options { 
            policy-statement loopback { 
                from route-filter 99.99.99.1/32 exact; 
                then accept; 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 1 { 
                    family inet { 
                        address 99.99.99.1/32; 
                    } 
                } 
            } 
            fe-0/0/0 { 
                unit 12 { 
                    vlan-tag 12; 
                    family inet { 
                        address 12.12.12.1/24; 
                    } 
                } 
            } 
        } 
        protocols { 
            bgp { 
                group ext { 
                    type external; 
                    export loopback; 
                    neighbor 12.12.12.2 { 
                        peer-as 200; 
                    } 
                } 
            } 
        } 
    } 
    pe1 { 
        routing-options { 
            router-id 99.99.99.2; 
            autonomous-system 200; 
        } 
        interfaces { 
            lo0 { 
                unit 2 { 
                    family inet { 
                        address 99.99.99.2/32; 
                    } 
                } 
            } 
            fe-0/0/1 { 
                unit 12 { 
                    vlan-tag 12; 
                    family inet { 
                        address 12.12.12.2/24; 
                    } 
                } 
            } 
            fe-0/0/2 { 
                unit 23 { 
                    vlan-tag 23; 
                    family inet { 
                        address 23.23.23.2/24; 
                    } 
                    family mpls; 
                } 
            } 
        } 
        protocols { 
            ospf { 
                area 0 { 
                    interface lo0.2; 
                    interface fe-0/0/2.23; 
                } 
            } 
            mpls { 
               interface fe-0/0/2.23; 
            } 
            ldp { 
               interface fe-0/0/2.23; 
            } 
            bgp { 
                group int { 
                    type internal; 
                    local-address 99.99.99.2; 
                    family inet-vpn { 
                        unicast; 
                    } 
                    neighbor 99.99.99.3; 
                } 
            } 
        } 
        routing-instances { 
            vrf-pe1 { 
                instance-type vrf; 
                route-distinguisher 100:2; 
                vrf-target target:100:1; 
                interface fe-0/0/1.12; 
                protocols { 
                    bgp { 
                        group ext { 
                            type external; 
                            neighbor 12.12.12.1 { 
                                peer-as 100; 
                            } 
                        } 
                    } 
                } 
            } 
        } 
    } 
    asbr2 { 
        routing-options { 
            router-id 99.99.99.4; 
            autonomous-system 300; 
        } 
        interfaces { 
            lo0 { 
                unit 4 { 
                    family inet { 
                        address 99.99.99.4/32; 
                    } 
                } 
            } 
            fe-0/0/2 { 
                unit 34 { 
                    vlan-tag 34; 
                    family inet { 
                        address 34.34.34.4/24; 
                    } 
                } 
            } 
            fe-0/0/0 { 
                unit 45 { 
                    vlan-tag 45; 
                    family inet { 
                        address 45.45.45.4/24; 
                    } 
                    family mpls; 
                } 
            } 
        } 
        protocols { 
            ospf { 
                area 0 { 
                    interface lo0.4; 
                    interface fe-0/0/0.45; 
                } 
            } 
            mpls { 
               interface fe-0/0/0.45; 
            } 
            ldp { 
               interface fe-0/0/0.45; 
            } 
            bgp { 
                group int { 
                    type internal; 
                    local-address 99.99.99.4; 
                    family inet-vpn { 
                        unicast; 
                    } 
                    neighbor 99.99.99.5; 
                } 
            } 
        } 
        routing-instances { 
            vrf-asbr2 { 
                instance-type vrf; 
                route-distinguisher 100:4; 
                vrf-target target:100:1; 
                interface fe-0/0/2.34; 
                protocols { 
                    bgp { 
                        group ext { 
                            type external; 
                            neighbor 34.34.34.3 { 
                                peer-as 200; 
                            } 
                        } 
                    } 
                } 
            } 
        } 
    } 
    pe2 { 
        routing-options { 
            router-id 99.99.99.5; 
            autonomous-system 300; 
        } 
        interfaces { 
            lo0 { 
                unit 5 { 
                    family inet { 
                        address 99.99.99.5/32; 
                    } 
                } 
            } 
            fe-0/0/1 { 
                unit 45 { 
                    vlan-tag 45; 
                    family inet { 
                        address 45.45.45.5/24; 
                    } 
                    family mpls; 
                } 
            } 
            fe-0/0/0 { 
                unit 56 { 
                    vlan-tag 56; 
                    family inet { 
                        address 56.56.56.5/24; 
                    } 
                } 
            } 
        } 
        protocols { 
            ospf { 
                area 0 { 
                    interface lo0.5; 
                    interface fe-0/0/1.45; 
                } 
            } 
            mpls { 
               interface fe-0/0/1.45; 
            } 
            ldp { 
               interface fe-0/0/1.45; 
            } 
            bgp { 
                group int { 
                    type internal; 
                    local-address 99.99.99.5; 
                    family inet-vpn { 
                        unicast; 
                    } 
                    neighbor 99.99.99.4; 
                } 
            } 
        } 
        routing-instances { 
            vrf-pe2 { 
                instance-type vrf; 
                route-distinguisher 100:5; 
                vrf-target target:100:1; 
                interface fe-0/0/0.56; 
                protocols { 
                    bgp { 
                        group ext { 
                            type external; 
                            neighbor 56.56.56.6 { 
                                peer-as 400; 
                            } 
                        } 
                    } 
                } 
            } 
        } 
    } 
    ce21 { 
        routing-options { 
            router-id 99.99.99.6; 
            autonomous-system 400; 
        } 
        policy-options { 
            policy-statement loopback { 
                from route-filter 99.99.99.6/32 exact; 
                then accept; 
            } 
        } 
        interfaces { 
            lo0 { 
                unit 6 { 
                    family inet { 
                        address 99.99.99.6/32; 
                    } 
                } 
            } 
            fe-0/0/1 { 
                unit 56 { 
                    vlan-tag 56; 
                    family inet { 
                        address 56.56.56.6/24; 
                    } 
                } 
            } 
        } 
        protocols { 
            bgp { 
                group ext { 
                    type external; 
                    export loopback; 
                    neighbor 56.56.56.5 { 
                        peer-as 300; 
                    } 
                } 
            } 
        } 
    } 
} 



 
A.3. TOPOLOGY "VPNV4-IAB" 
 
This topology is used to test inter-AS option B.
 
A.2.1. LOGICAL TOPOLOGY 
 
         +-----+   +-------+   +-------+   +-----+ 
+----+   |     |   |       |   |       |   |     |   +----+ 
|ce11|---| pe1 |---| asbr1 |---| asbr2 |---| pe2 |---|ce21| 
+----+   |     |   |       |   |       |   |     |   +----+ 
         +-----+   +-------+   +-------+   +-----+ 
 
<---->   <----------------->   <----------------->   <----> 
 AS100    AS200                 AS300                 AS400    
 
Asbr1 is the default logical router on physical router "dommelsch". It 
is the device under test. 
 
Ce11, pe1, asbr2, pe2, and ce21 are logical routers on physical router 
"fosters". 
 
Ce11 and ce21 use BGP as the PE-CE protocol. 
 
Asbr1 and asbr2 run inter-AS option B with BGP + VPNv4 between them.
 
A.2.2. CONFIGURATION FOR DOMMELSCH 

interfaces {
    fe-0/3/2 {
        vlan-tagging;
        unit 23 {
            vlan-id 23;
            family inet {
                address 23.23.23.3/24;
            }
            family mpls;
        }
        unit 34 {
            vlan-id 34;
            family inet {
                address 34.34.34.3/24;
            }
            family mpls;
        }
    }
    lo0 {
        unit 0 {
            family inet {
                address 99.99.99.3/32;
            }
        }
    }
}
routing-options {
    nonstop-routing;
    router-id 99.99.99.3;
    autonomous-system 200;
}
protocols {
    mpls {
        interface fe-0/3/2.23;
        interface fe-0/3/2.34;
    }
    bgp {
        traceoptions {
            file bgp_trace;
            flag state;
        }
        group int {
            type internal;
            local-address 99.99.99.3;
            family inet-vpn {
                unicast;
            }
            neighbor 99.99.99.2;
        }
        group ext {
            type external;
            family inet-vpn {
                unicast;
            }
            peer-as 300;
            neighbor 34.34.34.4 {
                family inet-vpn {
                    unicast;
                }
            }
        }
    }
    ospf {
        area 0.0.0.0 {
            interface lo0.0;
            interface fe-0/3/2.23;
        }
    }
    ldp {
        interface fe-0/3/2.23;
    }
}
 
A.8.3. CONFIGURATION FOR FOSTERS 
 
logical-routers {
    asbr2 {
        interfaces {
            fe-0/0/0 {
                unit 45 {
                    vlan-id 45;
                    family inet {
                        address 45.45.45.4/24;
                    }
                    family mpls;
                }
            }
            fe-0/0/2 {
                unit 34 {
                    vlan-id 34;
                    family inet {
                        address 34.34.34.4/24;
                    }
                    family mpls;
                }
            }
            lo0 {
                unit 4 {
                    family inet {
                        address 99.99.99.4/32;
                    }
                }
            }
        }
        protocols {
            mpls {
                interface fe-0/0/0.45;
                interface fe-0/0/2.34;
            }
            bgp {
                traceoptions {
                    file bgp_trace;
                    flag state;
                }
                group int {
                    type internal;
                    local-address 99.99.99.4;
                    family inet-vpn {
                        unicast;
                    }
                    neighbor 99.99.99.5;
                }
                group ext {
                    type external;
                    neighbor 34.34.34.3 {
                        family inet-vpn {
                            unicast;
                        }
                        peer-as 200;
                    }
                }
            }
            ospf {
                area 0.0.0.0 {
                    interface lo0.4;
                    interface fe-0/0/0.45;
                }
            }
            ldp {
                interface fe-0/0/0.45;
            }
        }
        routing-options {
            router-id 99.99.99.4;
            autonomous-system 300;
        }
    }
    ce11 {
        interfaces {
            fe-0/0/0 {
                unit 12 {
                    vlan-id 12;
                    family inet {
                        address 12.12.12.1/24;
                    }
                }
            }
            lo0 {
                unit 1 {
                    family inet {
                        address 99.99.99.1/32;
                    }
                }
            }
        }
        protocols {
            bgp {
                group ext {
                    type external;
                    export loopback;
                    neighbor 12.12.12.2 {
                        peer-as 200;
                    }
                }
            }
        }
        policy-options {
            policy-statement loopback {
                from {
                    route-filter 99.99.99.1/32 exact;
                }
                then accept;
            }
        }
        routing-options {
            router-id 99.99.99.1;
            autonomous-system 100;
        }
    }
    ce21 {
        interfaces {
            fe-0/0/1 {
                unit 56 {
                    vlan-id 56;
                    family inet {
                        address 56.56.56.6/24;
                    }
                }
            }
            lo0 {
                unit 6 {
                    family inet {
                        address 99.99.99.6/32;
                    }
                }
            }
        }
        protocols {
            bgp {
                group ext {
                    type external;
                    export loopback;
                    neighbor 56.56.56.5 {
                        peer-as 300;
                    }
                }
            }
        }
        policy-options {
            policy-statement loopback {
                from {
                    route-filter 99.99.99.6/32 exact;
                }
                then accept;
            }
        }
        routing-options {
            router-id 99.99.99.6;
            autonomous-system 400;
        }
    }
    pe1 {
        interfaces {
            fe-0/0/1 {
                unit 12 {
                    vlan-id 12;
                    family inet {
                        address 12.12.12.2/24;
                    }
                }
            }
            fe-0/0/2 {
                unit 23 {
                    vlan-id 23;
                    family inet {
                        address 23.23.23.2/24;
                    }
                    family mpls;
                }
            }
            lo0 {
                unit 2 {
                    family inet {
                        address 99.99.99.2/32;
                    }
                }
            }
        }
        protocols {
            mpls {
                interface fe-0/0/2.23;
            }
            bgp {
                group int {
                    type internal;
                    local-address 99.99.99.2;
                    family inet-vpn {
                        unicast;
                    }
                    neighbor 99.99.99.3;
                }
            }
            ospf {
                area 0.0.0.0 {
                    interface lo0.2;
                    interface fe-0/0/2.23;
                }
            }
            ldp {
                interface fe-0/0/2.23;
            }
        }
        routing-instances {
            vrf-pe1 {
                instance-type vrf;
                interface fe-0/0/1.12;
                route-distinguisher 100:2;
                vrf-target target:100:1;
                protocols {
                    bgp {
                        group ext {
                            type external;
                            neighbor 12.12.12.1 {
                                peer-as 100;
                            }
                        }
                    }
                }
            }
        }
        routing-options {
            router-id 99.99.99.2;
            autonomous-system 200;
        }
    }
    pe2 {
        interfaces {
            fe-0/0/0 {
                unit 56 {
                    vlan-id 56;
                    family inet {
                        address 56.56.56.5/24;
                    }
                }
            }
            fe-0/0/1 {
                unit 45 {
                    vlan-id 45;
                    family inet {
                        address 45.45.45.5/24;
                    }
                    family mpls;
                }
            }
            lo0 {
                unit 5 {
                    family inet {
                        address 99.99.99.5/32;
                    }
                }
            }
        }
        protocols {
            mpls {
                interface fe-0/0/1.45;
            }
            bgp {
                group int {
                    type internal;
                    local-address 99.99.99.5;
                    family inet-vpn {
                        unicast;
                    }
                    neighbor 99.99.99.4;
                }
            }
            ospf {
                area 0.0.0.0 {
                    interface lo0.5;
                    interface fe-0/0/1.45;
                }
            }
            ldp {
                interface fe-0/0/1.45;
            }
        }
        routing-instances {
            vrf-pe2 {
                instance-type vrf;
                interface fe-0/0/0.56;
                route-distinguisher 100:5;
                vrf-target target:100:1;
                protocols {
                    bgp {
                        group ext {
                            type external;
                            neighbor 56.56.56.6 {
                                peer-as 400;
                            }
                        }
                    }
                }
            }
        }
        routing-options {
            router-id 99.99.99.5;
            autonomous-system 300;
        }
    }
}
interfaces {
    fe-0/0/0 {
        vlan-tagging;
    }
    fe-0/0/1 {
        vlan-tagging;
    }
    fe-0/0/2 {
        vlan-tagging;
    }
}



A.4. TOPOLOGY "VPNV4-IAC" 
 
This topology is used to test inter-AS option C.
 
A.4.1. LOGICAL TOPOLOGY 
 
           
                 +-------+
               +-+  p(rr)+-+
               | |       | |
               | +-------+ |
               |           |
            +--+--+   +----+--+   +-------+   +-----+
   +----+   |     |   |       |   |       |   |     |   +----+
   |ce11|---| pe1 |   | asbr1 |---| asbr2 |---| pe2 |---|ce21|
   +----+   |     |   |       |   |       |   |     |   +----+
            +-----+   +-------+   +-------+   +-----+

   <---->   <----------------->   <----------------->   <---->
    AS100    AS200                 AS300                 AS400

RR is introduced in AS200

EBGP session between 'p' and 'pe2' with next hop unchanged exchanging
VPNv4 prefixes. P is a route reflector.

Internal loopbacks leaked between the two ASs

'ldp' and 'ospf' used as IGP

leaking happens from inet.3 and inbound updates are replicated to inet.0 
using rib-groups

Asbr1 is the default logical router on physical router "dommelsch". It 
is the device under test. 
 
Ce11, pe1, asbr2, pe2, p, and ce21 are logical routers on physical router 
"fosters". 
 
Ce11 and ce21 use BGP as the PE-CE protocol. 
 
Asbr1 and asbr2 run inter-AS option C with IPv4 + labels between them.
 
A.4.2. CONFIGURATION FOR DOMMELSCH 


interfaces {
    fe-0/3/2 {
        vlan-tagging;
        unit 23 {
            vlan-id 23;
            family inet {
                address 23.23.23.3/24;
            }
            family mpls;
        }
        unit 34 {
            vlan-id 34;
            family inet {
                address 34.34.34.3/24;
            }
            family mpls;
        }
    }
    lo0 {
        unit 0 {
            family inet {
                address 99.99.99.3/32;
            }
        }
    }
}
routing-options {
    nonstop-routing;
    rib-groups {
        bgp {
            import-rib [ inet.3 inet.0 ];
            import-policy bgp-only;
        }
    }
    router-id 99.99.99.3;
    autonomous-system 200;
    resolution;
}
protocols {
    mpls {
        interface fe-0/3/2.23;
        interface fe-0/3/2.34;
    }
    bgp {
        traceoptions {
            file bgp_trace;
        }
        group int {
            type internal;
            traceoptions {
                flag task;
            }
            local-address 99.99.99.3;
            family inet {
                labeled-unicast {
                    rib {
                        inet.3;
                    }
                }
            }
            neighbor 99.99.99.2;
        }
        group ext {
            type external;
            traceoptions {
                file nsrtrace;
                flag task;
            }
            family inet {
                labeled-unicast {
                    rib-group bgp;
                    rib {
                        inet.3;
                    }
                }
            }
            peer-as 300;
            neighbor 34.34.34.4 {
                family inet {
                    labeled-unicast;
                }
                export internal;
            }
        }
    }
    ospf {
        area 0.0.0.0 {
            interface lo0.0;
            interface fe-0/3/2.23;
        }
    }
    ldp {
        interface fe-0/3/2.23;
    }
}
policy-options {
    policy-statement bgp-only {
        term bgp {
            from protocol bgp;
            then accept;
        }
        term default {
            then reject;
        }
    }
    policy-statement internal {
        term a {
            from protocol [ ldp direct ];
            then accept;
        }
        term b {
            then reject;
        }
    }
}


A.4.2. CONFIGURATION FOR FOSTERS

logical-routers {
    asbr2 {
        interfaces {
            fe-0/0/0 {
                unit 45 {
                    vlan-id 45;
                    family inet {
                        address 45.45.45.4/24;
                    }
                    family mpls;
                }
            }
            fe-0/0/2 {
                unit 34 {
                    vlan-id 34;
                    family inet {
                        address 34.34.34.4/24;
                    }
                    family mpls;
                }
            }
            lo0 {
                unit 4 {
                    family inet {
                        address 99.99.99.4/32;
                    }
                }
            }
        }
        protocols {
            mpls {
                interface fe-0/0/0.45;
                interface fe-0/0/2.34;
            }
            bgp {
                traceoptions {
                    file bgptrace;
                    flag state;
                    flag update detail;
                }
                group int {
                    type internal;
                    local-address 99.99.99.4;
                    family inet {
                        labeled-unicast;
                    }
                    neighbor 99.99.99.5;
                }
                group ext {
                    type external;
                    family inet {
                        labeled-unicast;
                    }
                    neighbor 34.34.34.3 {
                        family inet {
                            labeled-unicast;
                        }
                        export internal;
                        peer-as 200;
                    }
                }
            }
            ospf {
                area 0.0.0.0 {
                    interface lo0.4;
                    interface fe-0/0/0.45;
                }
            }
            ldp {
                interface fe-0/0/0.45;
            }
        }
        policy-options {
            policy-statement internal {
                term a {
                    from protocol [ ospf direct ];
                    then accept;
                }
                term b {
                    then reject;
                }
            }
        }
        routing-options {
            router-id 99.99.99.4;
            autonomous-system 300;
        }
    }
    ce11 {
        interfaces {
            fe-0/0/0 {
                unit 12 {
                    vlan-id 12;
                    family inet {
                        address 12.12.12.1/24;
                    }
                }
            }
            lo0 {
                unit 1 {
                    family inet {
                        address 99.99.99.1/32;
                    }
                }
            }
        }
        protocols {
            bgp {
                group ext {
                    type external;
                    export loopback;
                    neighbor 12.12.12.2 {
                        peer-as 200;
                    }
                }
            }
        }
        policy-options {
            policy-statement loopback {
                from {
                    route-filter 99.99.99.1/32 exact;
                }
                then accept;
            }
        }
        routing-options {
            router-id 99.99.99.1;
            autonomous-system 100;
        }
    }
    ce21 {
        interfaces {
            fe-0/0/1 {
                unit 56 {
                    vlan-id 56;
                    family inet {
                        address 56.56.56.6/24;
                    }
                }
            }
            lo0 {
                unit 6 {
                    family inet {
                        address 99.99.99.6/32;
                    }
                }
            }
        }
        protocols {
            bgp {
                group ext {
                    type external;
                    export loopback;
                    neighbor 56.56.56.5 {
                        peer-as 300;
                    }
                }
            }
        }
        policy-options {
            policy-statement loopback {
                from {
                    route-filter 99.99.99.6/32 exact;
                }
                then accept;
            }
        }
        routing-options {
            router-id 99.99.99.6;
            autonomous-system 400;
        }
    }
    p {
        interfaces {
            fe-0/0/0 {
                unit 122 {
                    vlan-id 122;
                    family inet {
                        address 12.12.13.2/24;
                    }
                    family mpls;
                }
            }
            fe-0/0/2 {
                unit 23 {
                    vlan-id 23;
                    family inet {
                        address 23.23.23.2/24;
                    }
                    family mpls;
                }
            }
            lo0 {
                unit 2 {
                    family inet {
                        address 99.99.99.2/32;
                    }
                }
            }
        }
        protocols {
            mpls {
                interface fe-0/0/2.23;
                interface fe-0/0/0.122;
            }
            bgp {
                group int {
                    type internal;
                    local-address 99.99.99.2;
                    family inet {
                        labeled-unicast {
                            rib-group bgp;
                            rib {
                                inet.3;
                            }
                        }
                    }
                    family inet-vpn {
                        unicast;
                    }
                    cluster 0.0.0.10;
                    neighbor 99.99.99.3;
                    neighbor 99.99.99.12;
                }
                group interas_rr {
                    multihop {
                        no-nexthop-change;
                    }
                    local-address 99.99.99.2;
                    family inet-vpn {
                        unicast;
                    }
                    neighbor 99.99.99.5 {
                        peer-as 300;
                    }
                }
            }
            ospf {
                area 0.0.0.0 {
                    interface lo0.2;
                    interface fe-0/0/2.23;
                    interface fe-0/0/0.122;
                }
            }
            ldp {
                explicit-null;
                interface fe-0/0/0.122;
                interface fe-0/0/2.23;
            }
        }
        routing-options {
            rib-groups {
                bgp {
                    import-rib [ inet.3 inet.0 ];
                }
            }
            router-id 99.99.99.2;
            autonomous-system 200;
        }
    }
    pe1 {
        interfaces {
            fe-0/0/1 {
                unit 12 {
                    vlan-id 12;
                    family inet {
                        address 12.12.12.2/24;
                    }
                }
                unit 122 {
                    vlan-id 122;
                    family inet {
                        address 12.12.13.12/24;
                    }
                    family mpls;
                }
            }
            lo0 {
                unit 12 {
                    family inet {
                        address 99.99.99.12/32;
                    }
                }
            }
        }
        protocols {
            mpls {
                interface fe-0/0/1.12;
                interface fe-0/0/1.122;
            }
            bgp {
                group int {
                    type internal;
                    local-address 99.99.99.12;
                    neighbor 99.99.99.2 {
                        family inet {
                            labeled-unicast {
                                rib-group bgp;
                                rib {
                                    inet.3;
                                }
                            }
                        }
                        family inet-vpn {
                            unicast;
                        }
                    }
                }
            }
            ospf {
                area 0.0.0.0 {
                    interface lo0.12;
                    interface fe-0/0/1.122;
                }
            }
            ldp {
                explicit-null;
                interface fe-0/0/1.122;
            }
        }
        routing-instances {
            vrf-pe1 {
                instance-type vrf;
                interface fe-0/0/1.12;
                route-distinguisher 100:2;
                vrf-target target:100:1;
                protocols {
                    bgp {
                        group ext {
                            type external;
                            neighbor 12.12.12.1 {
                                peer-as 100;
                            }
                        }
                    }
                }
            }
        }
        routing-options {
            rib-groups {
                bgp {
                    import-rib [ inet.3 inet.0 ];
                }
            }
            router-id 99.99.99.12;
            autonomous-system 200;
        }
    }
    pe2 {
        interfaces {
            fe-0/0/0 {
                unit 56 {
                    vlan-id 56;
                    family inet {
                        address 56.56.56.5/24;
                    }
                }
            }
            fe-0/0/1 {
                unit 45 {
                    vlan-id 45;
                    family inet {
                        address 45.45.45.5/24;
                    }
                    family mpls;
                }
            }
            lo0 {
                unit 5 {
                    family inet {
                        address 99.99.99.5/32;
                    }
                }
            }
        }
        protocols {
            mpls {
                interface fe-0/0/1.45;
            }
            bgp {
                traceoptions {
                    file bgptrace;
                    flag update;
                }
                group int {
                    type internal;
                    local-address 99.99.99.5;
                    family inet {
                        labeled-unicast {
                            rib-group bgp;
                            rib {
                                inet.3;
                            }
                        }
                    }
                    neighbor 99.99.99.4;
                }
                group interas_rr {
                    multihop {
                        no-nexthop-change;
                    }
                    local-address 99.99.99.5;
                    family inet-vpn {
                        unicast;
                    }
                    neighbor 99.99.99.2 {
                        peer-as 200;
                    }
                }
            }
            ospf {
                area 0.0.0.0 {
                    interface lo0.5;
                    interface fe-0/0/1.45;
                }
            }
            ldp {
                interface fe-0/0/1.45;
            }
        }
        routing-instances {
            vrf-pe2 {
                instance-type vrf;
                interface fe-0/0/0.56;
                route-distinguisher 100:5;
                vrf-target target:100:1;
                protocols {
                    bgp {
                        group ext {
                            type external;
                            neighbor 56.56.56.6 {
                                peer-as 400;
                            }
                        }
                    }
                }
            }
        }
        routing-options {
            rib-groups {
                bgp {
                    import-rib [ inet.3 inet.0 ];
                }
            }
            router-id 99.99.99.5;
            autonomous-system 300;
        }
    }
}
interfaces {
    fe-0/0/0 {
        vlan-tagging;
    }
    fe-0/0/1 {
        vlan-tagging;
    }
    fe-0/0/2 {
        vlan-tagging;
    }
}



A.5. TOPOLOGY "VPNV4-CsC" 
 
This topology is used to test Carrier supporting Carrier.
 
A.5.1. LOGICAL TOPOLOGY 

 
  +-------------+
  |     ce1     |
  | 99.99.99.1  |
  +-----+-------+
        | 11.11.11/24
        |                     AS200
+-------+----------------------------------------------------------+
| +-----+-------+         +-------------+         +-------------+  |
| |     pe1     |_________|    p1 (RR)  |_________|    pe2      |  |
| | 99.99.99.2  |   L1    | 99.99.99.3  |  L2     | 99.99.99.4  |  |
| +-------------+         +-------------+         +------+------+  |
+--------------------------------------------------------+---------+
                                                         | L3
                              AS300                      |
+--------------------------------------------------------+---------+
| +-------------+         +-------------+         +------+------+  |
| |    pe3      |_________|    p2 (RR)  |_________|     dut     |  |
| | 99.99.99.5  |   L5    | 99.99.99.6  '   L4    | 99.99.99.7  |  |
| +-----+-------+         +-------------+         +-------------+  |
+-------+----------------------------------------------------------+
        |
        | L6
        |                     AS200
+-------+----------------------------------------------------------+
| +-----+-------+         +-------------+         +-------------+  |
| |    pe4      |_________|    p3 (RR)  |_________|    pe5      |  |
| | 99.99.99.8  |  L7     | 99.99.99.9  |   L8    | 99.99.99.10 |  |
| +-------------+         +-------------+         +-------+-----+  |
+---------------------------------------------------------+--------+
                                                          |
                                           35.35.35/24    |
                                                   +------+------+
                                                   |     ce2     |
                                                   | 99.99.99.11 |
                                                   +-------------+
                 Link IP Addresses
                 -----------------
      L1 - 22.22.22/24       L5 - 66.66.66/24
      L2 - 33.33.33/24       L6 - 77.77.77/24
      L3 - 44.44.44/24       L8 - 88.88.88/24
      L4 - 55.55.55/24       L9 - 25.25.25/24

'dut' is the default logical router on physical router "dommelsch". It 
is the device under test. 
 
ce1, pe1, p1(rr), pe2, p2(rr), pe3, pe4, p3(rr), pe5, ce2 are logical routers 
on physical router  "fosters". 
 
ce1 and ce2 use BGP as the PE-CE protocol. 

pe1 has vrf-red to ce1 and pe5 has vrf-red to ce2 (target 100:50)

dut and pe3 have vrf-blue to pe2 and pe4 respectively (target 100:100)

Run rfc 3107 (ipv4 + labels) sessions between pe3 - pe4 and pe2 - dut 
(in vrf-blue's context)

IBGP session from p1(RR) to p3(RR) exchanging VPNv4 unicast prefixes

ce1 and ce2 originate their loopbacks (99.99.99.1 & .11)

A.5.2. CONFIGURATION FOR DOMMELSCH 

interfaces {
    fe-0/3/2 {
        vlan-tagging;
        unit 44 {
            vlan-id 44;
            family inet {
                address 44.44.44.5/24;
            }
            family mpls;
        }
        unit 55 {
            vlan-id 55;
            family inet {
                address 55.55.55.5/24;
            }
            family mpls;
        }
    }
    lo0 {
        unit 0 {
            family inet {
                address 99.99.99.5/32;
            }
        }
    }
}
routing-options {
    nonstop-routing;
    router-id 99.99.99.5;
    autonomous-system 300;
    resolution;
}
protocols {
    mpls {
        interface fe-0/3/2.44;
        interface fe-0/3/2.55;
    }
    bgp {
        group int {
            type internal;
            local-address 99.99.99.5;
            family inet-vpn {
                unicast;
            }
            peer-as 300;
            neighbor 99.99.99.6;
        }
    }
    ospf {
        area 0.0.0.0 {
            interface lo0.0;
            interface fe-0/3/2.55;
        }
    }
    ldp {
        interface fe-0/3/2.55;
    }
}
policy-options {
    policy-statement bgp-only {
        term bgp {
            from protocol bgp;
            then accept;
        }
        term default {
            then reject;
        }
    }
    policy-statement internal {
        term a {
            from protocol [ ldp direct ];
            then accept;
        }
        term b {
            then reject;
        }
    }
}
routing-instances {
    vrf-blue {
        instance-type vrf;
        interface fe-0/3/2.44;
        route-distinguisher 100:5;
        vrf-target target:100:100;
        protocols {
            bgp {
                group ext {
                    type external;
                    advertise-peer-as;
                    family inet {
                        labeled-unicast;
                    }
                    peer-as 200;
                    neighbor 44.44.44.4;
                }
            }
        }
    }
}


A.5.3. CONFIGURATION FOR FOSTERS 


logical-routers {
    ce1 {
        interfaces {
            fe-0/0/0 {
                unit 11 {
                    vlan-id 11;
                    family inet {
                        address 11.11.11.1/24;
                    }
                }
            }
            lo0 {
                unit 1 {
                    family inet {
                        address 99.99.99.1/32;
                    }
                }
            }
        }
        protocols {
            bgp {
                group ext {
                    type external;
                    local-address 11.11.11.1;
                    family inet {
                        unicast;
                    }
                    export redist_loop;
                    peer-as 200;
                    neighbor 11.11.11.2;
                }
            }
        }
        policy-options {
            policy-statement redist_loop {
                term a {
                    from protocol direct;
                    then accept;
                }
                term b {
                    then reject;
                }
            }
        }
        routing-options {
            router-id 99.99.99.1;
            autonomous-system 100;
        }
    }
    ce2 {
        interfaces {
            fe-0/0/1 {
                unit 35 {
                    vlan-id 35;
                    family inet {
                        address 35.35.35.11/24;
                    }
                }
            }
            lo0 {
                unit 11 {
                    family inet {
                        address 99.99.99.11/32;
                    }
                }
            }
        }
        protocols {
            bgp {
                group ext {
                    type external;
                    local-address 35.35.35.11;
                    family inet {
                        unicast;
                    }
                    export redist_loop;
                    peer-as 200;
                    neighbor 35.35.35.10;
                }
            }
        }
        policy-options {
            policy-statement redist_loop {
                term a {
                    from protocol direct;
                    then accept;
                }
                term b {
                    then reject;
                }
            }
        }
        routing-options {
            router-id 99.99.99.11;
            autonomous-system 400;
        }
    }
    p1 {
        interfaces {
            fe-0/0/0 {
                unit 33 {
                    vlan-id 33;
                    family inet {
                        address 33.33.33.3/24;
                    }
                    family mpls;
                }
            }
            fe-0/0/1 {
                unit 22 {
                    vlan-id 22;
                    family inet {
                        address 22.22.22.3/24;
                    }
                    family mpls;
                }
            }
            lo0 {
                unit 3 {
                    family inet {
                        address 99.99.99.3/32;
                    }
                }
            }
        }
        protocols {
            mpls {
                interface fe-0/0/1.22;
                interface fe-0/0/0.33;
            }
            bgp {
                group int {
                    type internal;
                    local-address 99.99.99.3;
                    family inet {
                        labeled-unicast;
                    }
                    family inet-vpn {
                        unicast;
                    }
                    cluster 0.0.0.10;
                    peer-as 200;
                    neighbor 99.99.99.2;
                    neighbor 99.99.99.4 {
                        family inet {
                            labeled-unicast {
                                rib-group bgp;
                                rib {
                                    inet.3;
                                }
                            }
                        }
                    }
                }
                group far_ibgp {
                    local-address 99.99.99.3;
                    family inet-vpn {
                        unicast;
                    }
                    peer-as 200;
                    neighbor 99.99.99.9;
                }
            }
            ospf {
                area 0.0.0.0 {
                    interface lo0.3;
                    interface fe-0/0/1.22;
                    interface fe-0/0/0.33;
                }
            }
            ldp {
                interface fe-0/0/0.33;
                interface fe-0/0/1.22;
            }
        }
        routing-options {
            rib-groups {
                bgp {
                    import-rib [ inet.3 inet.0 ];
                }
            }
            router-id 99.99.99.3;
            autonomous-system 200 loops 2;
        }
    }
    p2 {
        interfaces {
            fe-0/0/0 {
                unit 66 {
                    vlan-id 66;
                    family inet {
                        address 66.66.66.6/24;
                    }
                    family mpls;
                }
            }
            fe-0/0/2 {
                unit 55 {
                    vlan-id 55;
                    family inet {
                        address 55.55.55.6/24;
                    }
                    family mpls;
                }
            }
            lo0 {
                unit 6 {
                    family inet {
                        address 99.99.99.6/32;
                    }
                }
            }
        }
        protocols {
            mpls {
                interface fe-0/0/2.55;
                interface fe-0/0/0.66;
            }
            bgp {
                group int {
                    type internal;
                    local-address 99.99.99.6;
                    family inet-vpn {
                        unicast;
                    }
                    cluster 0.0.0.2;
                    peer-as 300;
                    neighbor 99.99.99.5;
                    neighbor 99.99.99.7;
                }
            }
            ospf {
                area 0.0.0.0 {
                    interface lo0.6;
                    interface fe-0/0/2.55;
                    interface fe-0/0/0.66;
                }
            }
            ldp {
                interface fe-0/0/0.66;
                interface fe-0/0/2.55;
            }
        }
        routing-options {
            router-id 99.99.99.6;
            autonomous-system 300;
        }
    }
    p3 {
        interfaces {
            fe-0/0/0 {
                unit 25 {
                    vlan-id 25;
                    family inet {
                        address 25.25.25.9/24;
                    }
                    family mpls;
                }
            }
            fe-0/0/1 {
                unit 88 {
                    vlan-id 88;
                    family inet {
                        address 88.88.88.9/24;
                    }
                    family mpls;
                }
            }
            lo0 {
                unit 9 {
                    family inet {
                        address 99.99.99.9/32;
                    }
                }
            }
        }
        protocols {
            mpls {
                interface fe-0/0/1.88;
                interface fe-0/0/0.25;
            }
            bgp {
                group int {
                    type internal;
                    local-address 99.99.99.9;
                    family inet {
                        labeled-unicast;
                    }
                    family inet-vpn {
                        unicast;
                    }
                    cluster 0.0.0.3;
                    peer-as 200;
                    neighbor 99.99.99.8 {
                        family inet {
                            labeled-unicast {
                                rib-group bgp;
                                rib {
                                    inet.3;
                                }
                            }
                        }
                    }
                    neighbor 99.99.99.10;
                }
                group far_ibgp {
                    local-address 99.99.99.9;
                    family inet-vpn {
                        unicast;
                    }
                    peer-as 200;
                    neighbor 99.99.99.3;
                }
            }
            ospf {
                area 0.0.0.0 {
                    interface lo0.9;
                    interface fe-0/0/1.88;
                    interface fe-0/0/0.25;
                }
            }
            ldp {
                interface fe-0/0/0.25;
                interface fe-0/0/1.88;
            }
        }
        routing-options {
            rib-groups {
                bgp {
                    import-rib [ inet.3 inet.0 ];
                }
            }
            router-id 99.99.99.9;
            autonomous-system 200 loops 2;
        }
    }
    pe1 {
        interfaces {
            fe-0/0/0 {
                unit 22 {
                    vlan-id 22;
                    family inet {
                        address 22.22.22.2/24;
                    }
                    family mpls;
                }
            }
            fe-0/0/1 {
                unit 11 {
                    vlan-id 11;
                    family inet {
                        address 11.11.11.2/24;
                    }
                }
            }
            lo0 {
                unit 2 {
                    family inet {
                        address 99.99.99.2/32;
                    }
                }
            }
        }
        protocols {
            mpls {
                interface fe-0/0/0.22;
            }
            bgp {
                group int {
                    type internal;
                    local-address 99.99.99.2;
                    family inet {
                        labeled-unicast {
                            rib {
                                inet.3;
                            }
                        }
                    }
                    family inet-vpn {
                        unicast;
                    }
                    peer-as 200;
                    neighbor 99.99.99.3;
                }
            }
            ospf {
                area 0.0.0.0 {
                    interface lo0.2;
                    interface fe-0/0/0.22;
                }
            }
            ldp {
                interface fe-0/0/0.22;
            }
        }
        routing-instances {
            vrf-red {
                instance-type vrf;
                interface fe-0/0/1.11;
                route-distinguisher 100:2;
                vrf-target target:100:50;
                protocols {
                    bgp {
                        group ext {
                            type external;
                            peer-as 100;
                            neighbor 11.11.11.1;
                        }
                    }
                }
            }
        }
        routing-options {
            router-id 99.99.99.2;
            autonomous-system 200 loops 2;
        }
    }
    pe2 {
        interfaces {
            fe-0/0/1 {
                unit 33 {
                    vlan-id 33;
                    family inet {
                        address 33.33.33.4/24;
                    }
                    family mpls;
                }
            }
            fe-0/0/2 {
                unit 44 {
                    vlan-id 44;
                    family inet {
                        address 44.44.44.4/24;
                    }
                    family mpls;
                }
            }
            lo0 {
                unit 4 {
                    family inet {
                        address 99.99.99.4/32;
                    }
                }
            }
        }
        protocols {
            mpls {
                interface fe-0/0/1.33;
                interface fe-0/0/2.44;
            }
            bgp {
                group int {
                    type internal;
                    local-address 99.99.99.4;
                    family inet {
                        labeled-unicast {
                            rib {
                                inet.3;
                            }
                        }
                    }
                    family inet-vpn {
                        unicast;
                    }
                    neighbor 99.99.99.3;
                }
                group ext {
                    type external;
                    local-address 44.44.44.4;
                    family inet {
                        labeled-unicast {
                            rib {
                                inet.3;
                            }
                        }
                    }
                    export ldp_and_direct;
                    peer-as 300;
                    neighbor 44.44.44.5;
                }
            }
            ospf {
                area 0.0.0.0 {
                    interface lo0.4;
                    interface fe-0/0/1.33;
                }
            }
            ldp {
                interface fe-0/0/1.33;
            }
        }
        policy-options {
            policy-statement ldp_and_direct {
                term a {
                    from protocol [ ldp direct ];
                    then accept;
                }
                term b {
                    then reject;
                }
            }
        }
        routing-options {
            router-id 99.99.99.4;
            autonomous-system 200 loops 2;
        }
    }
    pe3 {
        interfaces {
            fe-0/0/0 {
                unit 77 {
                    vlan-id 77;
                    family inet {
                        address 77.77.77.7/24;
                    }
                    family mpls;
                }
            }
            fe-0/0/1 {
                unit 66 {
                    vlan-id 66;
                    family inet {
                        address 66.66.66.7/24;
                    }
                    family mpls;
                }
            }
            lo0 {
                unit 7 {
                    family inet {
                        address 99.99.99.7/32;
                    }
                }
            }
        }
        protocols {
            mpls {
                interface fe-0/0/1.66;
                interface fe-0/0/0.77;
            }
            bgp {
                group int {
                    type internal;
                    local-address 99.99.99.7;
                    family inet-vpn {
                        unicast;
                    }
                    neighbor 99.99.99.6;
                }
            }
            ospf {
                area 0.0.0.0 {
                    interface lo0.7;
                    interface fe-0/0/1.66;
                }
            }
            ldp {
                interface fe-0/0/1.66;
            }
        }
        routing-instances {
            vrf-blue {
                instance-type vrf;
                interface fe-0/0/0.77;
                route-distinguisher 100:7;
                vrf-target target:100:100;
                protocols {
                    bgp {
                        group ext {
                            type external;
                            advertise-peer-as;
                            family inet {
                                labeled-unicast;
                            }
                            peer-as 200;
                            neighbor 77.77.77.8;
                        }
                    }
                }
            }
        }
        routing-options {
            router-id 99.99.99.7;
            autonomous-system 300;
        }
    }
    pe4 {
        interfaces {
            fe-0/0/0 {
                unit 88 {
                    vlan-id 88;
                    family inet {
                        address 88.88.88.8/24;
                    }
                    family mpls;
                }
            }
            fe-0/0/1 {
                unit 77 {
                    vlan-id 77;
                    family inet {
                        address 77.77.77.8/24;
                    }
                    family mpls;
                }
            }
            lo0 {
                unit 8 {
                    family inet {
                        address 99.99.99.8/32;
                    }
                }
            }
        }
        protocols {
            mpls {
                interface fe-0/0/0.88;
                interface fe-0/0/1.77;
            }
            bgp {
                group int {
                    type internal;
                    local-address 99.99.99.8;
                    family inet {
                        labeled-unicast {
                            rib {
                                inet.3;
                            }
                        }
                    }
                    family inet-vpn {
                        unicast;
                    }
                    peer-as 200;
                    neighbor 99.99.99.9;
                }
                group ext {
                    type external;
                    local-address 77.77.77.8;
                    family inet {
                        labeled-unicast {
                            rib {
                                inet.3;
                            }
                        }
                    }
                    export ldp_and_direct;
                    peer-as 300;
                    neighbor 77.77.77.7;
                }
            }
            ospf {
                area 0.0.0.0 {
                    interface lo0.8;
                    interface fe-0/0/0.88;
                }
            }
            ldp {
                interface fe-0/0/0.88;
            }
        }
        policy-options {
            policy-statement ldp_and_direct {
                term a {
                    from protocol [ ldp direct ];
                    then accept;
                }
                term b {
                    then reject;
                }
            }
        }
        routing-options {
            router-id 99.99.99.8;
            autonomous-system 200 loops 2;
        }
    }
    pe5 {
        interfaces {
            fe-0/0/0 {
                unit 35 {
                    vlan-id 35;
                    family inet {
                        address 35.35.35.10/24;
                    }
                }
            }
            fe-0/0/1 {
                unit 25 {
                    vlan-id 25;
                    family inet {
                        address 25.25.25.10/24;
                    }
                    family mpls;
                }
            }
            lo0 {
                unit 10 {
                    family inet {
                        address 99.99.99.10/32;
                    }
                }
            }
        }
        protocols {
            mpls {
                interface fe-0/0/1.25;
            }
            bgp {
                group int {
                    type internal;
                    local-address 99.99.99.10;
                    family inet {
                        labeled-unicast {
                            rib {
                                inet.3;
                            }
                        }
                    }
                    family inet-vpn {
                        unicast;
                    }
                    neighbor 99.99.99.9;
                }
            }
            ospf {
                area 0.0.0.0 {
                    interface lo0.10;
                    interface fe-0/0/1.25;
                }
            }
            ldp {
                interface fe-0/0/1.25;
            }
        }
        routing-instances {
            vrf-red {
                instance-type vrf;
                interface fe-0/0/0.35;
                route-distinguisher 100:10;
                vrf-target target:100:50;
                protocols {
                    bgp {
                        group ext {
                            type external;
                            family inet {
                                unicast;
                            }
                            peer-as 400;
                            neighbor 35.35.35.11;
                        }
                    }
                }
            }
        }
        routing-options {
            router-id 99.99.99.10;
            autonomous-system 200 loops 2;
        }
    }
}
interfaces {
    fe-0/0/0 {
        vlan-tagging;
    }
    fe-0/0/1 {
        vlan-tagging;
    }
    fe-0/0/2 {
        vlan-tagging;
    }
}


----------------------------------------------------------------------------

Dealing with PIM-related features unsupported with NSR/ISSU in 9.3:
------------------------------------------------------------------

1. Background/Issue:
   ----------------

PIM(-related) features:
 - PNSF (PIM(-related) NSR Supported feature).
 - PNUF (PIM(-related) NSR Unsupported feature).

The following text is relevant in 9.3 (& later) and only if any of the PNUF 
are configured when NSR is turned-on.

In 9.3, no PNUF may be configured when ** PIM-NSR ** is enabled. 
(NOTE: Important statement). 

Pre-9.3: It is possible to configure any PIM feature when NSR is enabled as 
PIM NSR is not supported in pre-9.3.

This requires that an decent upgrade path be provided for customers that
insist on keeping their PIM-related features that are unsupported with
PIM-NSR enabled, even while running NSR for the other supported protocols in
9.3.


2. Upgrades:
   ---------
If (in a release prior to 9.3) a config has any PNUF configured while NSR is 
enabled, then a choice has to be made:
a. Before one upgrades from a pre-9.3 release to 9.3:
   - What does one care for? PNUF or NSR/ISSU:?
      + If ISSU: disable the PNUF & do an ISSU.
	         This gives one ISSU for the ISSU-supported features.
  	         PIM anyway is not ISSU capable from pre-9.3 to 9.3 even if
		 NSR is configured. So, disabling PNUF causes no harm.
      + If PNUF: disable "routing-options nsr" & 
	         upgrade. Going with this does not buy anything since...
		 PIM is not ISSU capable from pre-9.3 to 9.3

b. After one has upgraded to 9.3:
   - What do one care for? PNUF or NSR/ISSU:?
      + If PNUF; AND NSR/ISSU for non-PIM features:
	  - Disable PIM-NSR (by configuring the new knob "pim-nsr-disabled") 
	    while NSR is globally enabled.
      + If PNUF and NOT NSR/ISSU for non-PIM features:
          - Disable NSR globally. Keep PNUF enabled.
      + If NSR/ISSU & Not-PNUF:
          - Disable PNUF. PIM-NSR will work for the supported & configured
	    PIM features.
    SUMMARY: If any PNUF has to be enabled, PIM-NSR MUST be disabled if NSR
             is globally enabled.

3. Downgrades:
   -----------
ISSU downgrades are not supported for any protocol. So, there should be no 
expectation of ISSU when downgrading.

However, to downgrade when PNUF is configured & NSR-ISSU is enabled:
   (ie PIM NSR is explicitly disabled by setting pim-nsr-disabled)

   Before downgrading:
     a. Disable PNUF.
     b. Disable "pim-nsr-disabled".
     c. Downgrade


4. Knob: Supporting configs having PIM-related features unsupported with NSR:
   --------------------------------------------------------------------------
A new knob is introduced in 9.3. This can be configured to explicitly disable
PIM-NSR even while NSR for other supported protocols continues to run.

# show protocols 
...
pim {
    nonstop-routing {
        disable;
    }
}
...


5. Messages
   --------
Listed below are relevant messages that would show up when an attempt to 
commit an unsupported config is made:

a. PIM-NSR disable is attempted when NSR is not globally configured, or when
   NSR disable is globally attempted when PIM-NSR disable is configured:
   
    "To disable PIM nonstop-routing, non-stop routing must be globally 
    enabled."

b. When a PIM-NSR-unsupported feature is configured when NSR is globally 
   enabled, or when
   NSR is globally enabled while a PIM-NSR unsupported feature is already
   configured:
   "<Feature> is not supported with PIM nonstop-routing in this JunOS release.
    <Feature> configuration with PIM nonstop-routing will be supported in a
    future release.
    To configure <feature>, PIM non-stop routing must be disabled.";

c. When PIM-NSR disable configuration is attempted in a non-main instance:
   "PIM: Disabling PIM nonstop-routing is configurable only in the main 
    instance".

The above messages are relevant for the following PIM features unsupported with
NSR in 9.3:
    - Local-RP
    - PIM join-load-balancing:
    - Rosen MVPN
    - Ngen MVPN using PIM-asm/ssm provider tunnels.
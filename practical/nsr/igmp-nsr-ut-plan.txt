$Id: igmp-nsr-ut-plan.txt,v 1.3 2007/11/21 20:01:21 ravis Exp $tag:
                     NSR: IGMP stateful replication
                     Unit-test Plan

                     Ravi Singh <ravis@juniper.net>

S3.02.P05.T02
{Standard Unit Test Plan Template}

Copyright (C) 2007, Juniper Networks, Inc.

NOTICE: This document contains the proprietary and confidential
information of Juniper Networks, Inc., and must not be
distributed outside of the company without the
permission of Juniper Engineering.

1.  INTRODUCTION

This document describes the unit test plan for IGMP NSR. Since, no explicit
state replication has been done for IGMP, there is not much functionality
testing required to be done for IGMP. This document lists the basic sanity 
test-cases that need to be executed.
The aims of this document are to:
    - List basic sanity testing checks.
    - Communicate expected output of IGMP operational commands.

Tracks:  
  RLI 2727: IGMP stateful replication, PR 94594.
  Functional spec: sw-projects/os/nsr/igmp-nsr-funcspec.txt

A related RLI is tracked under:
  RLI 2728: PIM stateful replication.
  PR 94595.
  Functional spec:  sw-projects/os/nsr/pim-nsr-funcspec.txt
  Design spec:      sw-projects/os/nsr/pim-nsr-designspec.txt

Enabling NSR:
         set routing-options nonstop-routing 
         set chassis redundancy graceful-switchover
         
2.  SETUP
2.1 Common Topologies
    Topology A:
     A 3 router setup. The DUT is a dual RE JNPR router.
                               _______
                               | R1   |
                               |______|
                                  |
                      -------------------------
                          |              |
                        __|____       ___|__
                        |  R2 |       | DUT |
                        |_____|       |_____|


3. FUNCTIONAL TEST CASES

IGMP protocol functionality was not changed. Therefore, only basic sanity
and basic NSR testing is needed for IGMP.

3.1 Sanity testing:

1. Sending IGMP Queries/Leaves
   GOAL: Only the master should send IGMP queries/leaves.
   STEPS:
      - Enable NSR.
      - Enable PIM.
   CRITERIA:
        Master must start as IGMP querier. Sniff the wire to see that the
        master is sending the queries.
        Backup must not send any IGMP queries/reports. IGMP interfaces should
        not get initialized on the backup.
   RESULT: PASS.


2. Processing IGMP state:
   GOAL: Listener state gets updated on the master.
   STEPS:
      - Enable NSR.
      - Enable PIM.
   CRITERIA:
        Master must process the received IGMP queries & reports to update
        it group state.
        Backup must not display any group state for directly connected
        receivers.

   RESULT: Pass.


3. After switchover:
   GOAL: Backup learns IGMP state after the switchover.
   STEPS:
      - Enable NSR.
      - Enable PIM.
      - Induce a RE switchover.

   CRITERIA:
        After switchover:
              - the new-master starts as querier & learns IGMP group state.
              - the new-master processing IGMP queries/reports/leaves
                normally.
   RESULT: Pass.


3.2 PIM <-> IGMP interaction:

1. Pre-switchover:
   Backup: IGMP reports/leaves update (*,G) state on backup due to the PIM
   join/prune replication from the master:
   STEPS:
      - Enable NSR.
      - Enable PIM.
      - Bring up a directly connected multicast receiver.
      - Check "pim join extensive" state on backup.
      - Remove directly connected multicast receiver.
      - Check "pim join extensive" state on backup.

   CRITERIA:
      - Backup:
            + When the receiver comes up, pim join state should reflect it
              (by addition) in the oif list for the (*,g) entry.
            + When the receiver goes away, pim join state should reflect it
              (by deletion) in the oif list for the (*,g) entry.
   RESULT: Pass

2. Post-switchover:
   New-master: IGMP<->PIM interaction works correctly.
   STEPS:
      - Enable NSR.
      - Enable PIM.
      - Bring up a directly connected multicast receiver for G1.
      - Induce a RE switchover.
      - Bring up a directly connected multicast receiver for G2.
      - Remove directly connected multicast receiver for G1.
   CRITERIA:
      - Post-switchover:
            + When direct receiver for G1 goes away, the oif list for the
              (*,G) entry should remove the oif.
            + When the direct receiver for G2 comes up, the (*,g) pim join
              state should show the interface in the oif list.
   RESULT: Pass.

4.  BOUNDARY TEST CASES

{As necessary.  As with functional tests but for boundary/negative
tests.}

5.  REGRESSION TEST CASES

{As necessary.  As with functional tests but for regression tests.
Include references to regression requests, who is performing them,
etc.}

6.  INTEROP TEST CASES

{As necessary.  As with functional tests but for interoperability.
Include references to any specs or details regarding the interop
target.}

7.  MIGRATION & COMPATIBILITY TEST CASES

{As necessary.  As with functinoal tests but for migration and
compatibiilty tests (any tests needed to show forwards/backwards
compatibility, to show existing configs will not break, to verify
upgrades and downgrades, etc.}

8.  TEST COVERAGE REMAINING

{Describe all test coverage areas which will be needed on the feature
which are *not* covered by this document.  Identify test inputs for
systest or other groups to proceed with.}

9.  DEFECTS REMAINING

{List PRs filed at dev complete for test failures from this plan
which were not fixed by dev complete.}
